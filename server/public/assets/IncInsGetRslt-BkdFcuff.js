import{_ as w,c as b,a as e,w as _,v,F as L,r as D,g as j,o as p,t as i,i as k,j as I,b as u,f as N,l as x,e as f,m as V}from"./index-CxFk6QSJ.js";import{u as R}from"./useDates-UMs5Kxim.js";const P={props:{matList:{type:Array,default:()=>[]}},data(){return{search:""}},computed:{filteredLots(){return this.matList?this.matList.filter(s=>{var t;return(t=s.mat_nm)==null?void 0:t.includes(this.search)}):[]}},methods:{selectLot(s){this.$emit("select-lot",s),this.$emit("close")}}},S={class:"modal-dialog modal-lg"},C={class:"modal-content"},Q={class:"modal-header"},A={class:"modal-body"},O={class:"d-flex justify-content-between align-items-center mb-2"},G={class:"table table-sm table-bordered text-center"},T=["onClick"];function $(s,t,l,a,o,d){return p(),b("div",{class:"modal fade show d-block",style:{background:"rgba(0,0,0,0.5)","z-index":"1051"},onClick:t[2]||(t[2]=j(n=>s.$emit("close"),["self"]))},[e("div",S,[e("div",C,[e("div",Q,[t[3]||(t[3]=e("h5",{class:"modal-title"},"LOT/자재 선택",-1)),e("button",{type:"button",class:"btn-close",onClick:t[0]||(t[0]=n=>s.$emit("close"))})]),e("div",A,[e("div",O,[_(e("input",{type:"text",class:"form-control w-25",placeholder:"자재명 검색","onUpdate:modelValue":t[1]||(t[1]=n=>o.search=n)},null,512),[[v,o.search]])]),e("table",G,[t[4]||(t[4]=e("thead",{class:"table-light"},[e("tr",null,[e("th",null,"LOT번호"),e("th",null,"자재번호"),e("th",null,"자재명")])],-1)),e("tbody",null,[(p(!0),b(L,null,D(d.filteredLots,n=>(p(),b("tr",{key:n.lot_no+"-"+n.mat_no,onClick:c=>d.selectLot(n),style:{cursor:"pointer"}},[e("td",null,i(n.lot_no),1),e("td",null,i(n.mat_no),1),e("td",null,i(n.mat_nm),1)],8,T))),128))])])])])])])}const F=w(P,[["render",$],["__scopeId","data-v-e0ddc6fa"]]);V(!1);const B={components:{MatGetRsltSelModal:F},data(){return{searchQuery:"",selectedLineId:"",selectedProductName:"",selectedInsDate:"",newItemList:[],spmInsStdList:[],prodList:[],rsltMaster:null,rsltDetailList:[],showMatModal:!1,newItem:[],overallJdg:"",selectedRsltNo:"",matQualityViewdetail:[],matQualityViewall:[]}},created(){this.selectedInsDev=localStorage.getItem("username")||""},computed:{filteredLots(){return this.matList?this.matList.filter(s=>{var t;return(t=s.mat_nm)==null?void 0:t.includes(this.search)}):[]}},methods:{async downloadPdf(){var s,t,l,a,o,d;try{let c=(await f.get("/InsInsGetRslt.html")).data;const y=(this.rsltDetailList||[]).map(h=>`
  <tr>
    <td>${h.ins_itm}</td>
    <td>${h.ins_mthd}</td>
    <td>${h.mgr_rslt}</td>
    <td>${this.getJdgName(h.jdg)}</td>
    <td>${h.rmk||""}</td>
  </tr>
`).join("");let g="";((s=this.rsltMaster)==null?void 0:s.ovr_jdg)==="n1"?g='<button class="jdg-btn btn-green">합격</button>':((t=this.rsltMaster)==null?void 0:t.ovr_jdg)==="n2"&&(g='<button class="jdg-btn btn-red">불합격</button>'),c=c.replace("{{ mat_nm }}",this.selectedMatNm||this.searchQuery||"N/A").replace("{{ table_rows }}",y).replace("{{ mat_id }}",this.searchQuery||"N/A").replace("{{ lot_no }}",this.selectedLotNo||"N/A").replace("{{ quality_id }}",this.selectedRsltNo||"N/A").replace("{{ pur_ord_no }}",this.searchPurOrdNo||"N/A").replace("{{ vdr_nm }}",this.selectedVdrNm||"N/A").replace("{{ date }}",this.selectedInsDate||new Date().toLocaleDateString()).replace("{{ ins_dev }}",this.selectedInsDev||"N/A").replace("{{ mgr_count }}",((l=this.rsltMaster)==null?void 0:l.mgr_count)??"").replace("{{ succ_count }}",((a=this.rsltMaster)==null?void 0:a.succ_count)??"").replace("{{ dft_count }}",((o=this.rsltMaster)==null?void 0:o.dft_count)??"").replace("{{ ovr_jdg }}",((d=this.rsltMaster)==null?void 0:d.ovr_jdg)??"").replace("{{ table_rows }}",y).replace("{{ judge_button }}",g);const m=document.createElement("div");m.innerHTML=c,document.body.appendChild(m);const r={margin:.3,filename:`품질성적서_${new Date().toISOString().slice(0,10)}.pdf`,image:{type:"jpeg",quality:.98},html2canvas:{scale:2},jsPDF:{unit:"in",format:"a4",orientation:"portrait"}};await html2pdf().set(r).from(m).save(),document.body.removeChild(m)}catch(n){console.error("PDF 다운로드 실패:",n)}},async matQualityViewDropDown(){let s=await f.get("/api/matQualityViewDropDown").catch(t=>console.log(t));this.matQualityViewDropdown=s.data},getJdgName(s){return s==="o1"?"적합":s==="o2"?"부적합":s||""},getToday(){return new Date().toISOString().slice(0,10)},dateFormat(s,t){return R.dateFormat(s,t)},async fetchRsltDetail(s,t){var a;const l=await f.get("/api/spmInsGetRslt/detail",{params:{prd_no:s,ln_opr_no:t}});this.rsltMaster=l.data.master,this.rsltDetailList=l.data.detail,this.selectedRsltNo=((a=this.rsltMaster)==null?void 0:a.rslt_no)||"",console.log(this.rsltDetailList)},showModal(){this.showMatModal=!0},hideModal(){this.showMatModal=!1},openMatModal(){f.get("/api/incInsGetRslt/rsltMat").then(s=>{this.prodList=Array.isArray(s.data)?s.data:[],this.showMatModal=!0}).catch(()=>{this.prodList=[],alert("제품 목록 불러오기 실패")})},async handleSelectedProduct(s){try{const t=await f.get("/api/incInsGetRslt/rsltPrdDtl",{params:{lot_no:s.lot_no}});if(t.data&&t.data.length>0){const l=t.data[0];this.searchQuery=s.mat_no||"",this.selectedMatNm=s.mat_nm||"",this.selectedLotNo=l.lot_no||"",this.searchPurOrdNo=l.pur_ord_no||"",this.selectedVdrNm=l.vdr_nm||"",this.selectedInsDate=l.ins_dt?l.ins_dt.slice(0,10):"",this.selectedInsDev=l.mgr_nm||"",this.rsltMaster={mgr_count:l.mgr_count,succ_count:l.acpt_qty,dft_count:l.rjct_qty,ovr_jdg:l.ovr_jdg,rslt_no:l.rslt_no},this.selectedRsltNo=l.rslt_no||"",this.rsltDetailList=t.data.map(a=>({ins_itm:a.ins_itm,ins_mthd:a.ins_mthd,mgr_rslt:a.mgr_rslt,jdg:a.jdg,rmk:a.rmk}))}}catch{alert("상세정보 조회 실패"),this.searchQuery="",this.selectedMatNm="",this.selectedLotNo="",this.searchPurOrdNo="",this.selectedVdrNm="",this.selectedInsDate="",this.selectedInsDev="",this.rsltMaster=null,this.rsltDetailList=[]}}}},U={class:"container mt-4"},q={class:"d-flex justify-content-between align-items-center mb-4"},J={class:"center-button"},E={ref:"pdfarea"},z={class:"input"},H=["value"],K=["value"],W=["value"],X=["value"],Y=["value"],Z={class:"middle"},tt={class:"table table-bordered text-center",id:"table"},et={class:"rst"},st={class:"hstack gap-3"},lt={class:"table table-bordered text-center",ref:"resultTable"};function ot(s,t,l,a,o,d){var c,M,y,g,m;const n=x("MatGetRsltSelModal");return p(),b(L,null,[e("div",U,[e("div",q,[t[7]||(t[7]=e("h2",{class:"mb-4"},"자재검사성적서 조회",-1)),e("div",J,[e("button",{class:"btn btn-primary",onClick:t[0]||(t[0]=(...r)=>d.downloadPdf&&d.downloadPdf(...r)),style:{"margin-bottom":"-40px"}},"PDF 내보내기"),t[6]||(t[6]=e("div",{class:"d-flex gap-4"},null,-1))])]),e("div",E,[e("div",z,[t[8]||(t[8]=u(" 자재검색 ")),_(e("input",{"onUpdate:modelValue":t[1]||(t[1]=r=>o.searchQuery=r),class:"form-control",placeholder:"",readonly:""},null,512),[[v,o.searchQuery]]),e("button",{class:"btn btn-outline-secondary",onClick:t[2]||(t[2]=(...r)=>d.openMatModal&&d.openMatModal(...r)),style:{"margin-right":"501px"}},"🔍"),t[9]||(t[9]=u(" 성적서번호 ")),e("input",{value:o.selectedRsltNo,class:"form-control",readonly:"",style:{"background-color":"#eee"}},null,8,H),t[10]||(t[10]=e("hr",{style:{"margin-left":"-75px"}},null,-1)),t[11]||(t[11]=u(" LOTNo ")),e("input",{value:s.selectedLotNo,class:"form-control",readonly:"",style:{"background-color":"#eee","margin-right":"180px","margin-bottom":"10px"}},null,8,K),t[12]||(t[12]=u(" 발주번호 ")),_(e("input",{"onUpdate:modelValue":t[3]||(t[3]=r=>s.searchPurOrdNo=r),class:"form-control",readonly:"",style:{"background-color":"#eee","margin-right":"180px","margin-bottom":"10px"}},null,512),[[v,s.searchPurOrdNo]]),t[13]||(t[13]=u(" 납입업체 ")),_(e("input",{"onUpdate:modelValue":t[4]||(t[4]=r=>s.selectedVdrNm=r),class:"form-control",readonly:"",style:{"background-color":"#eee","margin-bottom":"10px"}},null,512),[[v,s.selectedVdrNm]]),t[14]||(t[14]=e("br",null,null,-1)),t[15]||(t[15]=u(" 자재명 ")),e("input",{value:s.selectedMatNm,class:"form-control",readonly:"",style:{"background-color":"#eee","margin-right":"180px"}},null,8,W),t[16]||(t[16]=u(" 작성일자 ")),e("input",{value:o.selectedInsDate,class:"form-control",readonly:"",style:{"background-color":"#eee","margin-right":"197px"}},null,8,X),t[17]||(t[17]=u(" 검사자 ")),e("input",{value:s.selectedInsDev,class:"form-control",readonly:"",style:{"background-color":"#eee"}},null,8,Y)]),t[23]||(t[23]=e("br",null,null,-1)),e("div",Z,[e("div",null,[e("table",tt,[t[19]||(t[19]=e("thead",{class:"table-light"},[e("tr",null,[e("th",null,"결점구분"),e("th",null,"검사량"),e("th",null,"합격량"),e("th",null,"불량량")])],-1)),e("tbody",null,[e("tr",null,[t[18]||(t[18]=e("td",null,"수량",-1)),e("td",null,i((c=o.rsltMaster)==null?void 0:c.mgr_count),1),e("td",null,i((M=o.rsltMaster)==null?void 0:M.succ_count),1),e("td",null,i((y=o.rsltMaster)==null?void 0:y.dft_count),1)])])])]),e("div",et,[e("div",st,[t[20]||(t[20]=e("div",{style:{"padding-left":"50px"}},"종합판정",-1)),t[21]||(t[21]=e("div",{class:"vr"},null,-1)),e("button",{class:N(["jdg-btn",((g=o.rsltMaster)==null?void 0:g.ovr_jdg)==="n1"?"btn-green":""]),style:{width:"150px",height:"100px","border-radius":"5px","border-color":"lightgray"}},"합격",2),e("button",{class:N(["jdg-btn",((m=o.rsltMaster)==null?void 0:m.ovr_jdg)==="n2"?"btn-red":""]),style:{width:"150px",height:"100px","border-radius":"5px","border-color":"lightgray"}},"불합격",2)])])]),t[24]||(t[24]=e("h5",null,"검사결과",-1)),e("table",lt,[t[22]||(t[22]=e("thead",{class:"table-light"},[e("tr",null,[e("th",null,"검사항목"),e("th",null,"검사기준"),e("th",null,"검사결과"),e("th",null,"판정"),e("th",null,"비고")])],-1)),e("tbody",null,[(p(!0),b(L,null,D(o.rsltDetailList,(r,h)=>(p(),b("tr",{key:h},[e("td",null,i(r.ins_itm),1),e("td",null,i(r.ins_mthd),1),e("td",null,i(r.mgr_rslt),1),e("td",null,i(d.getJdgName(r.jdg)),1),e("td",null,i(r.rmk),1)]))),128))])],512)],512)]),o.showMatModal?(p(),k(n,{key:0,matList:o.prodList,onSelectLot:d.handleSelectedProduct,onClose:t[5]||(t[5]=r=>o.showMatModal=!1)},null,8,["matList","onSelectLot"])):I("",!0)],64)}const at=w(B,[["render",ot]]);export{at as default};
//# sourceMappingURL=IncInsGetRslt-BkdFcuff.js.map
