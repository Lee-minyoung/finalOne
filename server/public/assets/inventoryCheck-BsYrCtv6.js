import{_ as P,c as o,a as l,F as p,r as g,e as y,o as a,j as _,b,t as r,g as f}from"./index-CxFk6QSJ.js";const m={name:"InventoryCheck",data(){return{inventoryStatus:[],allPurPlan:[],inventoryPurPlan:[],filteredPurPlan:[],min:"",rawData:[],expandedReqNos:[],proPlnData:[],reqClickedList:[],lotMinusDoneReqNo:[],plnToOrdNo:[]}},async created(){await this.fetchInventoryStatus(),await this.fetchInventoryPurPlan(),await this.filteredPurPlanList()},computed:{groupedInventory(){const s={};this.inventoryStatus.forEach(c=>{const u=c.계획ID;s[u]||(s[u]=[]),s[u].push(c)});const t={};for(const c in s){const u=s[c];u.every(n=>n.부족수량<0)||(t[c]=u)}return console.log(JSON.stringify(t,null,2)),t}},methods:{async fetchInventoryStatus(){try{const s=await y.get("/api/inventory/mtStatus");this.inventoryStatus=s.data,console.log("자재현황조회 성공",this.inventoryStatus)}catch(s){console.error("자재출고요청 실패",s)}},async fetchInventoryPurPlan(){try{const s=await y.get("/api/getPurPlnChecked");this.allPurPlan=s.data;const t=await y.get("/api/PlnToOrd");this.plnToOrdNo=t.data.map(c=>c.계획ID),console.log("allpurPlan",this.allPurPlan),console.log(this.plnToOrdNo),this.inventoryPurPlan=this.allPurPlan.filter(c=>!this.plnToOrdNo.includes(c.계획ID))}catch(s){console.log("자재구매계획 실패",s)}},async filteredPurPlanList(){const s=this.inventoryPurPlan;console.log("필터링전 rawdata",s);const t=[];for(const c of s){const u=c.자재ID;await this.getMinOrdqty(u)}this.filteredPurPlan=t},async getMinOrdqty(s){try{const t=await y.get("/api/inventory/minqty",{params:{matId:s}});return console.log("minqty",t.data[0]),t.data[0]}catch(t){console.log(t)}},async addPurOrdByPlnNo(s){try{const t=await y.post("/api/inventory/purOrd",{params:{purPlnNo:s}});return console.log("발주버튼클릭"),console.log(s),console.log("add",t),await this.fetchInventoryPurPlan(),t}catch(t){console.log(t)}},toggleAccordion(s){const t=this.expandedReqNos.indexOf(s);t>=0?this.expandedReqNos.splice(t,1):this.expandedReqNos.push(s)},isExpanded(s){return this.expandedReqNos.includes(s)},async minCheckAndPurOrd(s,t,c){const d=(await this.getMinOrdqty(s)).min_ord_qty;console.log("최소수량",d),t>=d?(await this.addPurOrdByPlnNo(c),alert("발주가 완료 되었습니다")):alert("최소수량을 넘기지 못해 주문할수 없습니다")},async fetchPrdPlanByMatId(s){try{const t=await y.get("/api/inventory/prdPlan",{params:{matId:s}});this.proPlnData=t.data,console.log("생산계획조회",this.proPlnData)}catch(t){console.log("생산계획조회 실패",t)}},async checkMat(s){const t=this.groupedInventory[s];console.log("matList",t);const c=t.filter(d=>d.부족수량<=0);try{const d=c.map(i=>({mat_no:i.자재ID,req_qty:i.총필요량,pln_id:i.계획ID}));console.log("payload",d);const n=await y.get("/api/MatStatus",{params:{reqId:d.pln_id,matId:d.mat_no}});console.log("matsts",n),await y.post("/api/inventory/lotMinusList",d)}catch(d){d.response&&d.response.status===400?alert(d.response.data.message):alert("서버오류가 부족합니다")}if(console.log("availableMats",c),!t.every(d=>{const n=parseFloat(d.총필요량);return parseFloat(d.현재재고)>=n})){alert("일부 자재의 재고가 부족합니다.");return}console.log("matList",t)},goToReqPage(s){console.log("자재요청item",s),this.$router.push({name:"MatReq",query:{matId:s.자재ID,matNm:s.자재명}})},async addPurOrd(s){console.log("자재요청item",s);try{const t=await y.post("/api/inventory/purOrdByClickButton",{matId:s.자재ID,vdrNo:s.대표거래처번호,vdrNm:s.거래처명,prc:s.단가,qty:s.부족수량,check:"check",reqId:s.계획ID});console.log("자재요청성공",t),this.reqClickedList.push(s.계획ID+s.자재명),alert("자재요청이 완료 되었습니다");const c=await y.get("/api/PlnToOrd");this.plnToOrdNo=c.data.map(u=>u.계획ID),console.log("allpurPlan",this.allPurPlan),console.log(this.plnToOrdNo),this.inventoryPurPlan=this.allPurPlan.filter(u=>!this.plnToOrdNo.includes(u.계획ID))}catch(t){console.log("자재요청실패",t)}},formatNumber(s){return s==null||isNaN(s)?"-":new Intl.NumberFormat().format(s)}}},k={class:"table-responsive",style:{"max-width":"1150px"}},x={class:"table table-bordered text-center"},v=["onClick"],N={colspan:"6",class:"text-start"},w={class:"d-flex justify-content-between align-items-center w-100"},I=["onClick"],D={class:"align-middle"},q={key:0,class:"align-middle"},O={key:1,class:"align-middle"},C={key:2,class:"align-middle"},L={key:3,class:"align-middle"},M={key:4,class:"align-middle"},A={key:5,class:"align-middle"},E={key:6,class:"align-middle"},T={key:7,class:"align-middle"},S={key:8,class:"align-middle"},B={key:9,class:"align-middle"},R={key:10,class:"align-middle"},F={key:11,class:"align-middle"},Q={class:"align-middle"},V={key:0,class:"btn btn-primary rounded-pill px-2 py-1",disabled:""},j={key:1,class:"btn btn-info rounded-pill px-2 py-1",disabled:""},G=["onClick"],J={class:"table table-bordered text-center",style:{"max-width":"1150px"}},z={class:"align-middle"},H={class:"text-end pe-4"},K={class:"text-end pe-4"},U=["onClick"];function W(s,t,c,u,d,n){return a(),o(p,null,[t[6]||(t[6]=l("h3",null,"자재현황파악",-1)),l("div",k,[l("table",x,[t[3]||(t[3]=l("colgroup",null,[l("col",{style:{width:"200px"}}),l("col",{style:{width:"200px"}}),l("col",{style:{width:"200px"}}),l("col",{style:{width:"200px"}}),l("col",{style:{width:"100px"}})],-1)),l("tbody",null,[(a(!0),o(p,null,g(n.groupedInventory,(i,h)=>(a(),o(p,{key:h},[l("tr",{class:"table-primary",style:{cursor:"pointer"},onClick:e=>n.toggleAccordion(h)},[l("td",N,[l("span",w,[l("span",null,[l("b",null,r(n.isExpanded(h)?"▼":"▶"),1),t[0]||(t[0]=b(" 출고요청번호: ")),l("b",null,r(h),1),b(" (자재 "+r(i.length)+"건) | 지시번호 : ",1),l("b",null,r(i[0].생산지시번호),1),t[1]||(t[1]=b(" | 제품명 : ")),l("b",null,r(i[0].제품명),1)]),l("button",{class:"btn btn-success rounded-pill px-2 py-1 me-2",onClick:f(e=>n.checkMat(h),["stop"]),type:"button"}," 자재출고 ",8,I)])])],8,v),n.isExpanded(h)?(a(),o(p,{key:0},[t[2]||(t[2]=l("tr",{class:"table-light"},[l("th",null,"자재명"),l("th",null,"총필요량"),l("th",null,"현재고"),l("th",null,"부족수량"),l("th",null,"자재출고")],-1)),(a(!0),o(p,null,g(i,e=>(a(),o("tr",{key:e.mat_req_no},[l("td",D,r(e.자재명),1),e.단위=="g"?(a(),o("td",q,r(n.formatNumber(e.총필요량/1e3))+"kg",1)):e.단위=="EA"?(a(),o("td",O,r(n.formatNumber(e.총필요량))+"EA",1)):e.단위=="ml"?(a(),o("td",C,r(n.formatNumber(e.총필요량/1e3))+"L",1)):(a(),o("td",L,r(n.formatNumber(e.총필요량)),1)),e.단위=="g"?(a(),o("td",M,r(n.formatNumber(e.현재재고/1e3))+"kg",1)):e.단위=="EA"?(a(),o("td",A,r(n.formatNumber(e.현재재고))+"EA",1)):e.단위=="ml"?(a(),o("td",E,r(n.formatNumber(e.현재재고/1e3))+"L",1)):(a(),o("td",T,r(n.formatNumber(e.현재재고)),1)),e.단위=="g"?(a(),o("td",S,r(n.formatNumber(e.부족수량>0?e.부족수량/1e3:0))+"kg",1)):e.단위=="EA"?(a(),o("td",B,r(n.formatNumber(e.부족수량>0?e.부족수량:0))+"EA",1)):e.단위=="ml"?(a(),o("td",R,r(n.formatNumber(e.부족수량>0?e.부족수량/1e3:0))+"L",1)):(a(),o("td",F,r(n.formatNumber(e.부족수량>0?e.부족수량:0)),1)),l("td",Q,[e.부족수량<=0?(a(),o("button",V,"출고완료")):e.자재처리결과=="c3"||d.reqClickedList.includes(e.계획ID+e.자재명)?(a(),o("button",j,"요청완료")):e.부족수량>0&&e.자재처리결과!="c3"&&!d.reqClickedList.includes(e.계획ID+e.자재명)?(a(),o("button",{key:2,class:"btn btn-success rounded-pill px-2 py-1",onClick:X=>n.addPurOrd(e),type:"button"},"자재요청",8,G)):_("",!0)])]))),128))],64)):_("",!0)],64))),128))])])]),t[7]||(t[7]=l("h3",null,"자재구매계획 ",-1)),l("table",J,[t[4]||(t[4]=l("colgroup",null,[l("col",{style:{width:"100px"}}),l("col",{style:{width:"190px"}}),l("col",{style:{width:"150px"}}),l("col",{style:{width:"180px"}}),l("col",{style:{width:"200px"}}),l("col",{style:{width:"100px"}})],-1)),t[5]||(t[5]=l("thead",null,[l("tr",null,[l("th",{scope:"col"},"자재ID"),l("th",{scope:"col"},"자재명"),l("th",{scope:"col"},"수량"),l("th",{scope:"col"},"총가격"),l("th",{scope:"col"},"거래처"),l("th",{scope:"col"},"발주")])],-1)),l("tbody",z,[(a(!0),o(p,null,g(d.inventoryPurPlan,(i,h)=>(a(),o("tr",{key:h},[l("td",null,r(i.자재번호),1),l("td",null,r(i.자재명),1),l("td",H,r(n.formatNumber(i.총합)),1),l("td",K,r(n.formatNumber(i.총가격))+"원",1),l("td",null,r(i.거래처명),1),l("td",null,[l("button",{class:"btn btn-success rounded-pill px-2 py-1",onClick:e=>n.minCheckAndPurOrd(i.자재번호,i.총합,i.계획ID),type:"button"},"발주하기",8,U)])]))),128))])])],64)}const Z=P(m,[["render",W]]);export{Z as default};
//# sourceMappingURL=inventoryCheck-BsYrCtv6.js.map
