import{_ as I,c as g,a as e,w as u,v as c,F as _,r as f,g as w,o as p,t as h,i as L,j as v,b as m,f as N,l as S,e as a,u as k}from"./index-CxFk6QSJ.js";const x={props:{lotList:{type:Array,default:()=>[]}},data(){return{search:""}},computed:{filteredLots(){return this.lotList?this.lotList.filter(s=>{var t;return(t=s.mat_nm)==null?void 0:t.includes(this.search)}):[]}},methods:{selectLot(s){this.$emit("select-lot",s),this.$emit("close")}}},R={class:"modal-dialog modal-lg"},J={class:"modal-content"},V={class:"modal-header"},M={class:"modal-body"},j={class:"d-flex justify-content-between align-items-center mb-2"},q={class:"table table-sm table-bordered text-center"},O=["onClick"];function U(s,t,n,d,l,r){return p(),g("div",{class:"modal fade show d-block",style:{background:"rgba(0,0,0,0.5)","z-index":"1051"},onClick:t[2]||(t[2]=w(i=>s.$emit("close"),["self"]))},[e("div",R,[e("div",J,[e("div",V,[t[3]||(t[3]=e("h5",{class:"modal-title"},"LOT/자재 선택",-1)),e("button",{type:"button",class:"btn-close",onClick:t[0]||(t[0]=i=>s.$emit("close"))})]),e("div",M,[e("div",j,[u(e("input",{type:"text",class:"form-control w-25",placeholder:"자재명 검색","onUpdate:modelValue":t[1]||(t[1]=i=>l.search=i)},null,512),[[c,l.search]])]),e("table",q,[t[4]||(t[4]=e("thead",{class:"table-light"},[e("tr",null,[e("th",null,"LOT번호"),e("th",null,"자재번호"),e("th",null,"자재명")])],-1)),e("tbody",null,[(p(!0),g(_,null,f(r.filteredLots,i=>(p(),g("tr",{key:i.lot_no+"-"+i.mat_no,onClick:o=>r.selectLot(i),style:{cursor:"pointer"}},[e("td",null,h(i.lot_no),1),e("td",null,h(i.mat_no),1),e("td",null,h(i.mat_nm),1)],8,O))),128))])])])])])])}const C=I(x,[["render",U],["__scopeId","data-v-8a6f80d7"]]),D={components:{MatRsltSelModal:C},data(){return{searchQuery:"",selectedLotNo:"",selectedMatNm:"",searchPurOrdNo:"",selectedVdrNm:"",selectedInsDate:this.getToday(),newItemList:[],incInsStdList:[],lotList:[],showLotModal:!1,newItem:{mgr_count:"",acpt_qty:"",rjct_qty:"",rmk:""},overallJdg:"",selectedRsltNo:"",empStore:k()}},computed:{employeeName(){return this.empStore.loginInfo.nm||""}},created(){this.selectedInsDev=localStorage.getItem("username")||""},watch:{newItemList:{handler(){this.updateOverallJdg()},deep:!0},"newItem.acpt_qty"(s){const t=Number(this.newItem.mgr_count),n=Number(s);!isNaN(t)&&!isNaN(n)&&(this.newItem.rjct_qty=t-n>=0?t-n:"")},"newItem.rjct_qty"(s){const t=Number(this.newItem.mgr_count),n=Number(s);!isNaN(t)&&!isNaN(n)&&(this.newItem.acpt_qty=t-n>=0?t-n:"")}},computed:{employeeName(){return this.empStore.loginInfo.nm||""}},methods:{async incInsRsltInsert(){if(!this.selectedRsltNo){alert("성적서 번호가 없습니다.");return}let s={rslt_no:this.selectedRsltNo,mgr_count:this.newItem.mgr_count,acpt_qty:this.newItem.acpt_qty,rjct_qty:this.newItem.rjct_qty,ovr_jdg:this.overallJdg,rmk:this.newItem.rmk,pur_ord_no:this.searchPurOrdNo,lot_no:this.selectedLotNo};try{let t=await a.post("/api/incInsRslt",s);if(t.data.isSuccessed){const n=await a.get("/api/incInsRslt/lastRsltNo");let d=Number(n.data.lastNo)||0;const l=this.incInsStdList.map((r,i)=>(d+=1,{inc_ins_rslt_dtl_no:`ISD-${String(d).padStart(3,"0")}`,mgr_date:this.selectedInsDate,inc_ins_std_no:r.inc_ins_std_no,mgr_rslt:this.newItemList[i].mgr_rslt,jdg:this.getJdg(r,this.newItemList[i].mgr_rslt),rmk:this.newItemList[i].rmk||"",cert_no:this.selectedRsltNo}));await a.post("/api/incInsRslt/dtl",l),alert("등록되었습니다.")}else alert("등록 실패: "+(t.data.message||""))}catch{alert("등록 중 오류가 발생했습니다.")}},updateOverallJdg(){const s=this.incInsStdList.map((t,n)=>{var d;return this.getJdg(t,(d=this.newItemList[n])==null?void 0:d.mgr_rslt)});if(s.every(t=>!t)){this.overallJdg="";return}this.overallJdg=s.every(t=>t==="o1")?"n1":"n2"},parseNumber(s){const t=String(s).match(/^(\d+(\.\d+)?)/);return t?Number(t[1]):NaN},getJdg(s,t){if(t===""||t===null||t===void 0)return"";const n=this.parseNumber(s.ins_mthd),d=this.parseNumber(s.ins_spc),l=this.parseNumber(t);if(!isNaN(n)&&!isNaN(d)&&!isNaN(l)){const r=n-d,i=n+d;return l>=r&&l<=i?"o1":"o2"}return t==="1"||t===1?"o1":t==="0"||t===0?"o2":""},getJdgName(s){return s==="o1"?"적합":s==="o2"?"부적합":""},getToday(){return new Date().toISOString().slice(0,10)},openLotModal(){a.get("/api/incInsRslt/lotList").then(s=>{this.lotList=Array.isArray(s.data)?s.data:[],this.showLotModal=!0}).catch(s=>{this.lotList=[]})},async handleSelectedLot(s){var t;if(this.selectedLotNo=s.lot_no,this.selectedMatNm=s.mat_nm,this.searchQuery=s.mat_no,this.searchPurOrdNo=s.pur_ord_no||"",this.newItem.mgr_count=s.prc_qty||"",s.lot_no)try{const n=await a.get("/api/incInsRslt/ord",{params:{lot_no:s.lot_no}});this.selectedVdrNm=((t=n.data)==null?void 0:t.cpy_nm)||"",this.searchPurOrdNo=s.pur_ord_no||""}catch{this.selectedVdrNm=""}else this.selectedVdrNm="";try{const d=(await a.get("/api/incInsRslt/lastRsltNo")).data.lastNo||0,l=String(Number(d)+1).padStart(3,"0");this.selectedRsltNo=`ISJ-${l}`}catch{this.selectedRsltNo="ISJ-001"}this.getIncInsStdList(s.mat_no)},async getIncInsStdList(s){try{const t=await a.get("/api/incInsStd",{params:{mat_no:s}});this.incInsStdList=t.data,this.newItemList=this.incInsStdList.map(()=>({mgr_rslt:"",rmk:""}))}catch{alert("기준서 목록을 가져오는 중 오류가 발생했습니다.")}},async getNextRsltNo(){let s=0,t="",n=!0;for(;n;){const d=await a.get("/api/incInsRslt/lastRsltNo");s=Number(d.data.lastNo)||s+1,t=`ISJ-${String(s+1).padStart(3,"0")}`,n=(await a.get("/api/incInsRslt/exists",{params:{rslt_no:t}})).data.exists,s++}return t}}},T={class:"container mt-4"},P={class:"d-flex justify-content-between align-items-center mb-4"},B={class:"center-button"},Q={class:"input"},A=["value"],z=["value"],E=["value"],F=["value"],G=["value"],H={class:"middle"},K={class:"table table-bordered text-center",id:"table"},W={class:"rst"},X={class:"hstack gap-3"},Y={class:"table table-bordered text-center"},Z=["onUpdate:modelValue"],$=["onUpdate:modelValue"];function tt(s,t,n,d,l,r){const i=S("MatRsltSelModal");return p(),g("div",T,[e("div",P,[t[11]||(t[11]=e("h2",{class:"mb-4"},"자재검사성적서 작성",-1)),e("div",B,[e("button",{class:"btn btn-primary",onClick:t[0]||(t[0]=(...o)=>r.incInsRsltInsert&&r.incInsRsltInsert(...o)),style:{"margin-bottom":"-40px"}},"성적서 반영"),t[10]||(t[10]=e("div",{class:"d-flex gap-4"},null,-1))])]),e("div",Q,[t[12]||(t[12]=m(" 자재검색 ")),u(e("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>l.searchQuery=o),class:"form-control",placeholder:"",readonly:""},null,512),[[c,l.searchQuery]]),e("button",{class:"btn btn-outline-secondary",onClick:t[2]||(t[2]=(...o)=>r.openLotModal&&r.openLotModal(...o)),style:{"margin-right":"501px"}},"🔍"),t[13]||(t[13]=m(" 성적서번호 ")),e("input",{value:l.selectedRsltNo,class:"form-control",readonly:"",style:{"background-color":"#eee"}},null,8,A),t[14]||(t[14]=e("hr",{style:{"margin-left":"-75px"}},null,-1)),t[15]||(t[15]=m(" LOTNo ")),e("input",{value:l.selectedLotNo,class:"form-control",id:"input",readonly:"",style:{"background-color":"#eee","margin-right":"180px"}},null,8,z),t[16]||(t[16]=m(" 발주번호 ")),u(e("input",{"onUpdate:modelValue":t[3]||(t[3]=o=>l.searchPurOrdNo=o),class:"form-control",id:"input",readonly:"",style:{"background-color":"#eee","margin-right":"180px"}},null,512),[[c,l.searchPurOrdNo]]),t[17]||(t[17]=m(" 거래처명 ")),u(e("input",{"onUpdate:modelValue":t[4]||(t[4]=o=>l.selectedVdrNm=o),class:"form-control",readonly:"",style:{"background-color":"#eee"}},null,512),[[c,l.selectedVdrNm]]),t[18]||(t[18]=e("br",null,null,-1)),t[19]||(t[19]=m(" 자재명 ")),e("input",{value:l.selectedMatNm,class:"form-control",id:"input",readonly:"",style:{"background-color":"#eee","margin-right":"180px"}},null,8,E),t[20]||(t[20]=m(" 작성일자 ")),e("input",{value:l.selectedInsDate,class:"form-control",id:"input",readonly:"",style:{"background-color":"#eee","margin-right":"197px"}},null,8,F),t[21]||(t[21]=m(" 검사자 ")),e("input",{value:r.employeeName,class:"form-control",id:"input",readonly:"",style:{"background-color":"#eee"}},null,8,G)]),t[27]||(t[27]=e("br",null,null,-1)),e("div",H,[e("table",K,[t[23]||(t[23]=e("thead",{class:"table-light"},[e("tr",null,[e("th",null,"결점구분"),e("th",null,"검사량"),e("th",null,"합격량"),e("th",null,"불합격량")])],-1)),e("tbody",null,[e("tr",null,[t[22]||(t[22]=e("td",null,"수량",-1)),e("td",null,[u(e("input",{"onUpdate:modelValue":t[5]||(t[5]=o=>l.newItem.mgr_count=o),class:"form-control",placeholder:"검사량",style:{"background-color":"#eee"},readonly:""},null,512),[[c,l.newItem.mgr_count]])]),e("td",null,[u(e("input",{"onUpdate:modelValue":t[6]||(t[6]=o=>l.newItem.acpt_qty=o),class:"form-control",placeholder:"합격량"},null,512),[[c,l.newItem.acpt_qty]])]),e("td",null,[u(e("input",{"onUpdate:modelValue":t[7]||(t[7]=o=>l.newItem.rjct_qty=o),class:"form-control",placeholder:"불량량"},null,512),[[c,l.newItem.rjct_qty]])])])])]),e("div",W,[e("div",X,[t[24]||(t[24]=e("div",{style:{"padding-left":"50px"}},"종합판정",-1)),t[25]||(t[25]=e("div",{class:"vr"},null,-1)),e("button",{class:N(["jdg-btn",l.overallJdg==="n1"?"btn-green":""]),disabled:"",style:{width:"150px",height:"100px","border-radius":"5px","border-color":"lightgray"}},"합격",2),e("button",{class:N(["jdg-btn",l.overallJdg==="n2"?"btn-red":""]),disabled:"",style:{width:"150px",height:"100px","border-radius":"5px","border-color":"lightgray"}},"불합격",2)])])]),t[28]||(t[28]=e("h5",null,"검사결과",-1)),e("table",Y,[t[26]||(t[26]=e("thead",{class:"table-light"},[e("tr",null,[e("th",null,"검사항목"),e("th",null,"검사기준"),e("th",null,"검사결과"),e("th",null,"판정"),e("th",null,"비고")])],-1)),e("tbody",null,[(p(!0),g(_,null,f(l.incInsStdList,(o,y)=>(p(),g("tr",{key:o.inc_ins_std_no},[e("td",null,h(o.ins_itm),1),e("td",null,h(o.ins_mthd),1),e("td",null,[u(e("input",{"onUpdate:modelValue":b=>l.newItemList[y].mgr_rslt=b,class:"form-control",placeholder:"검사결과",onInput:t[8]||(t[8]=(...b)=>r.updateOverallJdg&&r.updateOverallJdg(...b))},null,40,Z),[[c,l.newItemList[y].mgr_rslt]])]),e("td",null,h(r.getJdgName(r.getJdg(o,l.newItemList[y].mgr_rslt))),1),e("td",null,[u(e("input",{"onUpdate:modelValue":b=>l.newItemList[y].rmk=b,class:"form-control",placeholder:"비고"},null,8,$),[[c,l.newItemList[y].rmk]])])]))),128))])]),l.showLotModal?(p(),L(i,{key:0,lotList:l.lotList,onSelectLot:r.handleSelectedLot,onClose:t[9]||(t[9]=o=>l.showLotModal=!1)},null,8,["lotList","onSelectLot"])):v("",!0)])}const st=I(D,[["render",tt]]);export{st as default};
//# sourceMappingURL=IncInsRslt-DjBJRxSF.js.map
