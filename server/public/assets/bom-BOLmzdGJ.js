import{d as I}from"./useCommonCode-DKmraWxZ.js";import{_ as v,e as h,c as b,a as t,i as f,j as M,w as r,v as c,k,F as g,r as B,l as y,o as i,f as R,t as w}from"./index-CxFk6QSJ.js";import{m as x}from"./matSelectModal-CgqU8bBh.js";import{p as S}from"./prdSelectModal-YbYj2m-j.js";const V={props:{bom:Object},components:{matSelectModal:x},data(){return{bom_no:"",prd_no:"",prd_nm:"",use_yn:"",bomMatInfo:[],showMatModal:!1,matList:[]}},watch:{bom:{handler(o){o?this.getBomMatInfo(o.bom_no):(this.bomMatInfo=[],this.bom_no="",this.prd_no="",this.prd_nm="",this.use_yn="")},immediate:!0}},methods:{async getBomMatInfo(o){let e=await h.get(`/api/bomMat/${o}`).catch(d=>console.log(d));this.bomMatInfo=e.data,this.bom_no=e.data[0].bom_no,this.prd_no=e.data[0].prd_no,this.prd_nm=e.data[0].prd_nm,this.use_yn=e.data[0].use_yn},async bomUpdate(){if(this.bomMatInfo.length===0){alert("자재를 추가해주세요.");return}for(const l of this.bomMatInfo)if(!l.cap||l.cap<=0){alert(`${l.mat_nm}의 용량을 입력해주세요.`);return}if(!this.use_yn){alert("사용여부를 선택해주세요.");return}let o={use_yn:this.use_yn},e=[];for(let l=0;l<this.bomMatInfo.length;l++)e[l]={bom_no:this.bom_no,mat_no:this.bomMatInfo[l].mat_no,cap:this.bomMatInfo[l].cap,unit:this.bomMatInfo[l].unit,rmk:this.bomMatInfo[l].rmk};(await h.put(`/api/bomAndBomMat/${this.bom_no}`,[o,e]).catch(l=>console.log(l))).data.message=="수정 완료"?(alert("수정되었습니다."),this.$emit("bom-reload"),this.getBomMatInfo(this.bomMatInfo[0].bom_no)):alert(`수정되지 않았습니다.
데이터를 확인해보세요.`)},saveBom(){confirm(`정말로 수정하시겠습니까?
변경된 내용은 즉시 적용됩니다.`)&&this.bomUpdate()},addBom(){this.$emit("goToForm",!1)},async deleteBom(o){o>0?confirm(`정말로 삭제하시겠습니까?
삭제된 데이터는 복구할 수 없습니다.`)&&((await h.delete(`/api/bom/${o}`).catch(s=>console.log(s))).data.affectedRows>0?(alert("정상적으로 삭제되었습니다."),this.$emit("bom-reload"),this.bomMatInfo=[],this.bom_no="",this.prd_no="",this.prd_nm="",this.use_yn="",this.$emit("clear-selection")):alert("삭제되지 않았습니다.")):alert("삭제할 BOM을 선택하세요")},resetForm(){this.getBomMatInfo(this.bomMatInfo[0].bom_no)},removeMatRow(o){this.bomMatInfo.splice(o,1)},openMatModal(){h.get("/api/mat").then(o=>{this.matList=o.data,this.showMatModal=!0}).catch(o=>{console.error("자재 목록 불러오기 실패",o)})},handleSelectedMats(o){let e=[...this.bomMatInfo];const d=new Set(e.map(l=>l.mat_no));e=this.appendSelectedMats(e,o,d),this.bomMatInfo=this.filterOnlySelectedRows(e,o),this.showMatModal=!1},appendSelectedMats(o,e,d){for(const l of e)d.has(l.mat_no)||(o.push({mat_no:l.mat_no,mat_nm:l.mat_nm,cap:"",unit:l.unit,rmk:""}),d.add(l.mat_no));return o},filterOnlySelectedRows(o,e){return o.filter(d=>d.mat_no&&e.some(l=>l.mat_no===d.mat_no))}}},C={class:"col-md-7"},U={class:"d-flex justify-content-between mb-3"},L={class:"card p-3"},F={key:0},N={class:"row mb-4"},O={class:"col-md-6 mb-3"},P={class:"d-flex align-items-center"},T={class:"col-md-6 mb-3"},j={class:"d-flex align-items-center"},q={class:"col-md-12 mb-3"},G={class:"d-flex align-items-center"},Q={class:"d-flex align-items-center"},X={class:"table table-bordered text-center"},Y=["onUpdate:modelValue"],A=["onUpdate:modelValue"],D=["onUpdate:modelValue"],z=["onUpdate:modelValue"],E=["onUpdate:modelValue"],H=["onClick"],J={key:1},K={key:1};function W(o,e,d,l,s,a){const _=y("matSelectModal");return i(),b("div",C,[t("div",U,[t("div",null,[t("button",{class:"btn btn-primary me-2",onClick:e[0]||(e[0]=(...m)=>a.addBom&&a.addBom(...m))},"등록"),t("button",{class:"btn btn-danger",onClick:e[1]||(e[1]=m=>a.deleteBom(s.bomMatInfo[0].bom_no))},"삭제")]),t("div",null,[t("button",{class:"btn btn-warning me-2",onClick:e[2]||(e[2]=(...m)=>a.resetForm&&a.resetForm(...m))},"초기화"),t("button",{class:"btn btn-success",onClick:e[3]||(e[3]=(...m)=>a.saveBom&&a.saveBom(...m))},"저장")])]),t("div",L,[e[16]||(e[16]=t("h4",null,"상세 보기",-1)),d.bom?(i(),b("div",F,[t("div",null,[t("div",N,[t("div",O,[t("div",P,[e[9]||(e[9]=t("label",{for:"bomNo",class:"form-label me-3",style:{"min-width":"100px"}},"BOM번호",-1)),r(t("input",{id:"bomNo",type:"text",class:"form-control","onUpdate:modelValue":e[4]||(e[4]=m=>s.bom_no=m),readonly:"",disabled:""},null,512),[[c,s.bom_no]])])]),t("div",T,[t("div",j,[e[11]||(e[11]=t("label",{for:"useYn",class:"form-label me-3",style:{"min-width":"100px"}},"사용여부",-1)),r(t("select",{id:"useYn",class:"form-select form-control","onUpdate:modelValue":e[5]||(e[5]=m=>s.use_yn=m)},e[10]||(e[10]=[t("option",{value:"f1"},"여",-1),t("option",{value:"f2"},"부",-1)]),512),[[k,s.use_yn]])])]),t("div",q,[t("div",G,[e[12]||(e[12]=t("label",{for:"prdNm",class:"form-label me-3",style:{"min-width":"100px"}},"제품명",-1)),r(t("input",{id:"prdNm",type:"text",class:"form-control","onUpdate:modelValue":e[6]||(e[6]=m=>s.prd_nm=m),readonly:"",disabled:""},null,512),[[c,s.prd_nm]])])]),t("div",Q,[t("button",{class:"btn btn-outline-secondary align-items-center",style:{width:"100%"},onClick:e[7]||(e[7]=(...m)=>a.openMatModal&&a.openMatModal(...m))},"자재추가")])]),t("table",X,[e[14]||(e[14]=t("thead",{class:"table-light"},[t("tr",null,[t("th",{style:{"font-weight":"normal"}},"자재번호"),t("th",{style:{"font-weight":"normal"}},"자재명"),t("th",{style:{"font-weight":"normal"}},"용량"),t("th",{style:{"font-weight":"normal"}},"단위"),t("th",{style:{"font-weight":"normal"}},"비고"),t("th",{style:{"font-weight":"normal"}},"X")])],-1)),t("tbody",null,[s.bomMatInfo.length>0?(i(!0),b(g,{key:0},B(s.bomMatInfo,(m,n)=>(i(),b("tr",{key:"new-"+n},[t("td",null,[r(t("input",{"onUpdate:modelValue":u=>m.mat_no=u,type:"text",class:"form-control text-center",readonly:"",disabled:""},null,8,Y),[[c,m.mat_no]])]),t("td",null,[r(t("input",{"onUpdate:modelValue":u=>m.mat_nm=u,type:"text",class:"form-control",readonly:"",disabled:""},null,8,A),[[c,m.mat_nm]])]),t("td",null,[r(t("input",{"onUpdate:modelValue":u=>m.cap=u,type:"number",class:"form-control text-end"},null,8,D),[[c,m.cap,void 0,{number:!0}]])]),t("td",null,[r(t("input",{"onUpdate:modelValue":u=>m.unit=u,type:"text",class:"form-control",readonly:"",disabled:""},null,8,z),[[c,m.unit]])]),t("td",null,[r(t("input",{"onUpdate:modelValue":u=>m.rmk=u,type:"text",class:"form-control"},null,8,E),[[c,m.rmk]])]),t("td",null,[t("button",{class:"btn btn-outline-danger me-1",onClick:u=>a.removeMatRow(n)}," X ",8,H)])]))),128)):(i(),b("tr",J,e[13]||(e[13]=[t("td",{colspan:"6"},"자재추가 버튼을 눌러 자재를 추가해주세요.",-1)])))])]),s.showMatModal?(i(),f(_,{key:0,matList:s.matList,selected:s.bomMatInfo,onSelectMat:a.handleSelectedMats,onClose:e[8]||(e[8]=m=>s.showMatModal=!1)},null,8,["matList","selected","onSelectMat"])):M("",!0)])])):(i(),b("div",K,e[15]||(e[15]=[t("p",null,"BOM을 선택하세요!",-1)])))])])}const Z=v(V,[["render",W],["__scopeId","data-v-25171c78"]]),$={components:{matSelectModal:x,prdSelectModal:S},data(){return{bom_No:"",prd_no:"",prd_nm:"",bomRows:[{mat_no:"",mat_nm:"",cap:"",unit:"",rmk:""}],showMatModal:!1,showPrdModal:!1,matList:[],prdList:[]}},created(){this.getBomNo()},methods:{async getBomNo(){let o=await h.get("/api/bomNo").catch(e=>console.log(e));this.bom_No=o.data[0].addBomNo},resetForm(){this.bomRows=[{mat_no:"",mat_nm:"",cap:"",unit:"",rmk:""}],this.prd_no="",this.prd_nm=""},async bomInsert(){if(!this.prd_no){alert("제품을 선택해주세요.");return}if(!this.bomRows||this.bomRows.length===0||this.bomRows[0].mat_no===""){alert("자재를 추가해주세요.");return}for(let l=0;l<this.bomRows.length;l++){const s=this.bomRows[l];if(!s.cap||s.cap<=0){alert(`${s.mat_nm}의 용량을 입력해주세요.`);return}}this.bomRows=this.bomRows.map(l=>{var s;return{...l,rmk:((s=l.rmk)==null?void 0:s.trim())||""}});let o={prd_no:this.prd_no},e=[];for(let l=0;l<this.bomRows.length;l++)e[l]={bom_no:this.bom_No,mat_no:this.bomRows[l].mat_no,cap:this.bomRows[l].cap,unit:this.bomRows[l].unit,rmk:this.bomRows[l].rmk};(await h.post("/api/bomAndBomMat",[o,e]).catch(l=>console.log(l))).data.message=="등록 완료"?(alert("등록되었습니다."),this.$emit("bom-reload")):alert(`등록되지 않았습니다.
데이터를 확인해보세요.`),this.$emit("goToInfo",!0)},removeMatRow(o){this.bomRows.splice(o,1)},openMatModal(){h.get("/api/mat").then(o=>{this.matList=o.data,this.showMatModal=!0}).catch(o=>{console.error("자재 목록 불러오기 실패",o)})},handleSelectedMats(o){let e=[...this.bomRows];const d=new Set(e.map(l=>l.mat_no));e=this.appendSelectedMats(e,o,d),this.bomRows=this.filterOnlySelectedRows(e,o),this.showMatModal=!1},appendSelectedMats(o,e,d){for(const l of e)d.has(l.mat_no)||(o.push({mat_no:l.mat_no,mat_nm:l.mat_nm,cap:"",unit:l.unit,rmk:""}),d.add(l.mat_no));return o},filterOnlySelectedRows(o,e){return o.filter(d=>d.mat_no&&e.some(l=>l.mat_no===d.mat_no))},openPrdModal(){h.get("/api/prd").then(o=>{this.prdList=o.data,this.showPrdModal=!0}).catch(o=>{console.error("제품 목록 불러오기 실패",o)})},handleSelectedPrd(o){this.prd_no=o.prd_no,this.prd_nm=o.prd_nm,this.showPrdModal=!1}}},tt={class:"col-md-7"},et={class:"d-flex justify-content-between mb-3"},ot={class:"card p-3"},lt={class:"row mb-4"},st={class:"col-md-6 mb-3"},nt={class:"d-flex align-items-center"},at={class:"col-md-12 mb-3"},mt={class:"d-flex align-items-center"},dt={class:"input-group"},it={class:"d-flex align-items-center"},rt={class:"table table-bordered text-center"},ct={key:0},ut=["onUpdate:modelValue"],bt=["onUpdate:modelValue"],pt=["onUpdate:modelValue"],ht=["onUpdate:modelValue"],_t=["onUpdate:modelValue"],ft=["onClick"];function Mt(o,e,d,l,s,a){const _=y("matSelectModal"),m=y("prdSelectModal");return i(),b("div",tt,[t("div",et,[e[8]||(e[8]=t("div",null,null,-1)),t("div",null,[t("button",{class:"btn btn-warning me-2",onClick:e[0]||(e[0]=(...n)=>a.resetForm&&a.resetForm(...n))},"초기화"),t("button",{class:"btn btn-success",onClick:e[1]||(e[1]=(...n)=>a.bomInsert&&a.bomInsert(...n))},"저장")])]),t("div",ot,[e[14]||(e[14]=t("h4",null,"BOM 등록",-1)),t("div",null,[t("div",null,[t("div",lt,[t("div",st,[t("div",nt,[e[9]||(e[9]=t("label",{for:"bomNo",class:"form-label me-3",style:{"min-width":"100px"}},"BOM번호",-1)),r(t("input",{id:"bomNo",type:"text",class:"form-control","onUpdate:modelValue":e[2]||(e[2]=n=>s.bom_No=n),readonly:"",disabled:""},null,512),[[c,s.bom_No]])])]),e[11]||(e[11]=t("div",{class:"col-md-6 mb-3"},[t("div",{class:"d-flex align-items-center"},[t("label",{for:"useYn",class:"form-label me-3",style:{"min-width":"100px"}},"사용여부"),t("input",{id:"useYn",type:"text",class:"form-control",value:"여",readonly:"",disabled:""})])],-1)),t("div",at,[t("div",mt,[e[10]||(e[10]=t("label",{for:"prdNm",class:"form-label me-3",style:{"min-width":"100px"}},"제품명",-1)),t("div",dt,[r(t("input",{id:"prdNm",type:"text",class:"form-control","onUpdate:modelValue":e[3]||(e[3]=n=>s.prd_nm=n),placeholder:"제품을 선택해주세요.",readonly:""},null,512),[[c,s.prd_nm]]),t("button",{class:"btn btn-outline-secondary",onClick:e[4]||(e[4]=(...n)=>a.openPrdModal&&a.openPrdModal(...n))},"제품검색")])])]),t("div",it,[t("button",{class:"btn btn-outline-secondary align-items-center",style:{width:"100%"},onClick:e[5]||(e[5]=(...n)=>a.openMatModal&&a.openMatModal(...n))},"자재추가")])]),t("table",rt,[e[13]||(e[13]=t("thead",{class:"table-light"},[t("tr",null,[t("th",{style:{"font-weight":"normal"}},"자재번호"),t("th",{style:{"font-weight":"normal"}},"자재명"),t("th",{style:{"font-weight":"normal"}},"용량"),t("th",{style:{"font-weight":"normal"}},"단위"),t("th",{style:{"font-weight":"normal"}},"비고"),t("th",{style:{"font-weight":"normal"}},"X")])],-1)),t("tbody",null,[s.bomRows[0].mat_no===""?(i(),b("tr",ct,e[12]||(e[12]=[t("td",{colspan:"6"},"자재추가 버튼을 눌러 자재를 추가해주세요.",-1)]))):(i(!0),b(g,{key:1},B(s.bomRows,(n,u)=>(i(),b("tr",{key:"new-"+u},[t("td",null,[r(t("input",{"onUpdate:modelValue":p=>n.mat_no=p,type:"text",class:"form-control text-center",readonly:"",disabled:""},null,8,ut),[[c,n.mat_no]])]),t("td",null,[r(t("input",{"onUpdate:modelValue":p=>n.mat_nm=p,type:"text",class:"form-control",readonly:"",disabled:""},null,8,bt),[[c,n.mat_nm]])]),t("td",null,[r(t("input",{"onUpdate:modelValue":p=>n.cap=p,type:"number",class:"form-control text-end"},null,8,pt),[[c,n.cap,void 0,{number:!0}]])]),t("td",null,[r(t("input",{"onUpdate:modelValue":p=>n.unit=p,type:"text",class:"form-control",readonly:"",disabled:""},null,8,ht),[[c,n.unit]])]),t("td",null,[r(t("input",{"onUpdate:modelValue":p=>n.rmk=p,type:"text",class:"form-control"},null,8,_t),[[c,n.rmk]])]),t("td",null,[t("button",{class:"btn btn-outline-danger me-1",onClick:p=>a.removeMatRow(u)}," X ",8,ft)])]))),128))])]),s.showMatModal?(i(),f(_,{key:0,matList:s.matList,selected:s.bomRows,onSelectMat:a.handleSelectedMats,onClose:e[6]||(e[6]=n=>s.showMatModal=!1)},null,8,["matList","selected","onSelectMat"])):M("",!0),s.showPrdModal?(i(),f(m,{key:1,prdList:s.prdList,selected:s.prd_no,onSelectPrd:a.handleSelectedPrd,onClose:e[7]||(e[7]=n=>s.showPrdModal=!1)},null,8,["prdList","selected","onSelectPrd"])):M("",!0)])])])])}const yt=v($,[["render",Mt],["__scopeId","data-v-887538c9"]]),wt={components:{bomInfo:Z,bomForm:yt},data(){return{searchQuery:"",selectedFilter:"",selectedBom:null,bomList:[],InfoView:!0}},computed:{filteredBomList(){return this.bomList.filter(o=>o.prd_nm.toLowerCase().includes(this.searchQuery.toLowerCase())&&(this.selectedFilter===""||o.use_yn===this.selectedFilter))}},created(){this.getBomList()},methods:{CommonCodeFormat(o){return I.CommonCodeFormat(o)},async getBomList(){let o=await h.get("/api/bom").catch(e=>console.log(e));this.bomList=o.data},async selectBom(o){try{const e=this.bomList.find(d=>d.bom_no===o);this.InfoView=!0,await this.$nextTick(),this.selectedBom=e}catch(e){console.error("BOM 선택 중 오류 발생:",e)}},msg(o){this.InfoView=o,o||(this.selectedBom=null)},clearSelection(){this.selectedBom=null}}},vt={class:"container mt-4"},gt={class:"row"},Bt={class:"col-md-5"},kt={class:"d-flex justify-content-between mb-3"},xt={class:"card p-3"},It={class:"table-container"},Rt={class:"table table-bordered"},St=["onClick"],Vt={class:"w-10"},Ct={class:"w-30"},Ut={class:"w-10"};function Lt(o,e,d,l,s,a){const _=y("bomInfo"),m=y("bomForm");return i(),b("div",vt,[t("div",gt,[e[5]||(e[5]=t("h1",null,"BOM관리",-1)),t("div",Bt,[t("div",kt,[r(t("input",{type:"text",class:"form-control w-50",placeholder:"제품명 검색...","onUpdate:modelValue":e[0]||(e[0]=n=>s.searchQuery=n)},null,512),[[c,s.searchQuery]]),r(t("select",{class:"form-select w-25","onUpdate:modelValue":e[1]||(e[1]=n=>s.selectedFilter=n)},e[2]||(e[2]=[t("option",{value:""},"전체",-1),t("option",{value:"f1"},"여",-1),t("option",{value:"f2"},"부",-1)]),512),[[k,s.selectedFilter]])]),t("div",xt,[e[4]||(e[4]=t("h4",null,"BOM 목록",-1)),t("div",It,[t("table",Rt,[e[3]||(e[3]=t("thead",null,[t("tr",null,[t("th",{class:"w-10"},"BOM번호"),t("th",{class:"w-30"},"제품명 "),t("th",{class:"w-10"},"사용여부")])],-1)),t("tbody",null,[(i(!0),b(g,null,B(a.filteredBomList,n=>(i(),b("tr",{key:n.bom_no,onClick:u=>a.selectBom(n.bom_no),class:R([{"table-primary":s.selectedBom&&s.selectedBom.bom_no===n.bom_no},"table-hover"])},[t("td",Vt,w(n.bom_no),1),t("td",Ct,w(n.prd_nm),1),t("td",Ut,w(a.CommonCodeFormat(n.use_yn)),1)],10,St))),128))])])])])]),s.InfoView?(i(),f(_,{key:0,bom:s.selectedBom,onGoToForm:a.msg,onBomReload:a.getBomList,onClearSelection:a.clearSelection},null,8,["bom","onGoToForm","onBomReload","onClearSelection"])):M("",!0),s.InfoView?M("",!0):(i(),f(m,{key:1,onGoToInfo:a.msg,onBomReload:a.getBomList},null,8,["onGoToInfo","onBomReload"]))])])}const Tt=v(wt,[["render",Lt],["__scopeId","data-v-651914fe"]]);export{Tt as default};
//# sourceMappingURL=bom-BOLmzdGJ.js.map
