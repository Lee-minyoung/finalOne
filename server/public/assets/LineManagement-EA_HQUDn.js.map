{"version":3,"file":"LineManagement-EA_HQUDn.js","sources":["../../../client/src/views/production/line/LineManagement.vue"],"sourcesContent":["<template>\n  <div class=\"container mt-4\">\n    <h2 class=\"mb-4\">라인 관리</h2>\n    <div class=\"mb-１ d-flex justify-content-end\">\n      <select v-model=\"statusFilter\" class=\"form-select w-auto\">\n          <option value=\"전체\">전체</option>\n          <option value=\"진행중\">진행중</option>\n          <option value=\"대기중\">대기중</option>\n          <option value=\"공정지시\">공정지시</option>\n          <option value=\"공정현황\">공정현황</option>\n          <option value=\"공정완료\">공정완료</option>\n          <option value=\"설비점검중\">설비점검중</option>\n      </select>\n    </div>\n    <table class=\"table table-bordered text-center\">\n      <thead class=\"table-light\">\n        <tr>\n          <th>라인번호</th>\n          <th>라인명</th>\n          <th>생산제품명</th>\n          <th>시작시간</th>\n          <th>종료시간</th>\n          <th>투입량</th>\n          <th>불량량</th>\n          <th>생산량</th>\n          <th>상태</th>\n        </tr>\n      </thead>\n      <tbody>\n        <tr v-for=\"item in filteredLineList\" :key=\"item.ln_no\">\n          <td>{{ item.ln_no }}</td>\n          <td>{{ item.ln_nm }}</td>\n          <td>{{ item.prd_nm }}</td>\n          <td>{{ dateFormat(item.st_tm, 'hh시 mm분 ss초') }}</td>\n          <td>{{ dateFormat(item.end_tm, 'hh시 mm분 ss초') }}</td>\n          <td>{{ formatNumber(item.ord_qty) }}</td>\n          <td>{{ formatNumber(item.pdn_qty) }}</td>\n          <td>{{ formatNumber(item.dft_qty) }}</td>\n          <td>\n            <button v-if=\"item.ln_sts === 'l1'\" class=\"btn btn-sm btn-secondary\" disabled>대기중</button>\n            <button v-else-if=\"item.ln_sts === 'l2'\" class=\"btn btn-sm btn-primary\"\n              @click=\"startLine(item)\">공정실행</button>\n            <button v-else-if=\"item.ln_sts === 'l3'\" class=\"btn btn-sm btn-warning\"\n              @click=\"showStatus(item)\">공정현황</button>\n            <button v-else-if=\"item.ln_sts === 'l4'\" class=\"btn btn-sm btn-success\"\n              @click=\"confirmReleaseToWarehouse(item)\">공정완료</button>\n            <button v-else-if=\"item.ln_sts === 'l5'\" class=\"btn btn-sm btn-danger\">수리중</button>\n            <button v-else-if=\"item.ln_sts === 'l6'\" class=\"btn btn-sm btn-info\">점검중</button>\n          </td>\n        </tr>\n      </tbody>\n    </table>\n\n    <LineManagementDtl v-if=\"showLineModal\" :details=\"processDetailList\" :line-no=\"selectedLineNo\"\n      :line-info=\"selectedLineInfo\" @reload=\"handleReload\" @close=\"showLineModal = false\" />\n  </div>\n</template>\n\n\n<script>\nimport axios from 'axios';\nimport useDateUtils from '@/utils/useDates.js'\nimport { useEmpStore } from '@/stores/empStore.js';\nimport LineManagementDtl from './LineManagementDtl.vue'\nimport Swal from 'sweetalert2'\n\nexport default {\n  components: { LineManagementDtl },\n\n  data() {\n    return {\n      LineList: [],\n      empStore: useEmpStore(),\n      showLineModal: false,\n      selectedLineNo: '',\n      selectedLineInfo: {},\n      processDetailList: [],\n      statusFilter: '진행중',  // 초기값은 진행중 상태만 보기\n    }\n  },\n\n  computed: {\n    employeeName() {\n      return this.empStore.loginInfo.nm || ''\n    },\n    employeeNo() {\n      return this.empStore.loginInfo.emp_no || ''\n    },\n    filteredLineList() {\n      const filterConditions = {\n        '전체': () => true,\n        '진행중': item => ['l2', 'l3', 'l4'].includes(item.ln_sts),\n        '대기중': item => item.ln_sts === 'l1',\n        '공정지시': item => item.ln_sts === 'l2',\n        '공정현황': item => item.ln_sts === 'l3',\n        '공정완료': item => item.ln_sts === 'l4',\n        '설비점검중': item => ['l5', 'l6'].includes(item.ln_sts),\n      };\n\n      const condition = filterConditions[this.statusFilter] || (() => true);\n      return this.LineList.filter(condition);\n    }\n  },\n\n  created() {\n    this.fetchLineList()\n  },\n\n  methods: {\n    async fetchLineList() {\n      const res = await axios.get('/api/lineList');\n      this.LineList = res.data;\n    },\n\n    dateFormat(value, format) {\n      return useDateUtils.dateFormat(value, format)\n    },\n\n    async startLine(item) {\n      const payload = {\n        ln_no: item.ln_no,\n        mgr: this.empStore.loginInfo.emp_no\n      }\n\n      try {\n        await axios.post('/api/startLine', payload)\n        await Swal.fire('지시 완료!', `${item.ln_nm} 라인이 시작되었습니다.`, 'success')\n        this.fetchLineList()\n      } catch (err) {\n        console.error(\"❌ 지시 실패:\", err)\n        Swal.fire('오류', '지시 중 오류가 발생했습니다.', 'error')\n      }\n    },\n\n    async showStatus(item) {\n      this.selectedLineNo = item.ln_no\n      this.selectedLineInfo = item\n      this.showLineModal = true\n\n      try {\n        const res = await axios.get(`/api/lineDetail/${item.pdn_ord_dtl_no}`)\n        this.processDetailList = res.data\n      } catch (err) {\n        console.error(\"❌ 라인 상세 조회 실패:\", err)\n        Swal.fire('오류', '라인 상세 정보를 불러오지 못했습니다.', 'error')\n      }\n    },\n\n    async handleReload({ line_no, pdn_ord_dtl_no }) {\n      try {\n        const res = await axios.get('/api/lineList');\n        this.LineList = res.data;\n\n        const updated = this.LineList.find(l => l.ln_no === line_no);\n        if (updated) {\n          this.selectedLineInfo = updated;\n        }\n\n        if (pdn_ord_dtl_no) {\n          const detailRes = await axios.get(`/api/lineDetail/${pdn_ord_dtl_no}`);\n          this.processDetailList = detailRes.data;\n        }\n\n      } catch (err) {\n        console.error('❌ 라인 정보 갱신 실패:', err);\n      }\n    },\n\n    async confirmReleaseToWarehouse(item) {\n      const result = await Swal.fire({\n        title: '공정이 완료되었습니다.',\n        html: `\n          <div style=\"text-align:left; line-height:1.8;\">\n            <strong>제품명:</strong> ${item.prd_nm}<br>\n            <strong>지시수량:</strong> ${item.ord_qty}개<br>\n            <strong>완료수량:</strong> ${item.pdn_qty}개<br>\n            <strong>불량수량:</strong> ${item.dft_qty}개\n          </div>\n        `,\n        icon: 'success',\n        showCancelButton: true,\n        confirmButtonText: '출고',\n        cancelButtonText: '취소',\n        reverseButtons: true\n      });\n\n      if (!result.isConfirmed) return;\n\n      try {\n        await axios.post('/api/finalOper', {\n          p_ln_opr_no: item.ln_opr_no,\n          p_ln_no: item.ln_no,\n          p_pdn_ord_dtl_no: item.pdn_ord_dtl_no\n        });\n\n        await Swal.fire('출고 완료!', '창고로 이동 및 상태 초기화 완료', 'success')\n        this.fetchLineList()\n      } catch (err) {\n        console.error('❌ 출고 실패:', err)\n        Swal.fire('처리 실패', '출고 또는 상태 초기화 중 오류 발생', 'error')\n      }\n    },\n    formatNumber(n) {\n      if (n == null || isNaN(n)) return '-'\n      return new Intl.NumberFormat().format(n)\n    },\n  }\n}\n</script>\n\n\n<style scoped>\nh2 {\n  font-weight: bold;\n  text-align: left;\n}\n\n.table td,\n.table th {\n  vertical-align: middle;\n}\n\n.table-primary {\n  background-color: #cce5ff !important;\n}\n</style>"],"names":["_sfc_main","LineManagementDtl","useEmpStore","condition","item","res","axios","value","format","useDateUtils","payload","Swal","err","line_no","pdn_ord_dtl_no","updated","detailRes","n","_hoisted_1","_hoisted_2","_hoisted_3","_hoisted_5","_hoisted_6","_hoisted_7","_openBlock","_createElementBlock","_cache","_createElementVNode","$event","$data","_createStaticVNode","_Fragment","_renderList","$options","_toDisplayString","_hoisted_4","_hoisted_8","_hoisted_9","_createCommentVNode","_createBlock","_component_LineManagementDtl"],"mappings":"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"}