import{m as k}from"./matSelectModal-Cbvtm36d.js";import{v as g}from"./vdrSelectModal-BGAdh289.js";import{_ as P,c as i,j as c,a as t,i as f,w as n,v as d,l as h,F as M,r as w,e as u,o as a,T as C,t as p}from"./index-DRp0-N0C.js";const D={components:{matSelectModal:k,vdrSelectModal:g},data(){return{showModal:!1,showVdrModal:!1,mat:[],selectMats:[],vdr:[],selectVdr:null,qty:0,purDt:"",crtDt:new Date().toISOString().slice(0,10),matPurPlanChecked:[],checkedMatPln:[],mode:"basic"}},async created(){const o=await u.get("/api/inventory/mat");this.mat=o.data;const l=await u.get("/api/vdr");this.vdr=l.data,await this.fetchInventoryPurPlan()},computed:{totalPrc(){return this.qty&&this.selectMats.length?this.qty*this.selectMats[0].prc:0}},methods:{gotoOrdView(){this.$router.push({name:"OrdView"})},handleMaterialSelect(o){this.selectMats=o,this.showModal=!1},handleVdrSelect(o){this.selectVdr=o,this.showVdrModal=!1},async saveOrder(){var l,b,y;const o={vdr_no:((l=this.selectVdr)==null?void 0:l.vdr_no)??1e3,crt_dt:this.crtDt,pur_dt:this.purDt,mat_no:(b=this.selectMats[0])==null?void 0:b.mat_no,qty:this.qty,prc:(y=this.selectMats[0])==null?void 0:y.prc,total:this.totalPrc};try{await u.post("/api/addPurOrd",o),alert("발주 저장 완료!");const e=await u.get("/api/PlnToOrd");console.log("Nos",e.data);const r=e.data.map(m=>m.계획ID);console.log("plnToOrdNo",r),this.matPurPlanChecked=this.matPurPlanChecked.filter(m=>!r.includes(m.계획ID)),console.log("발주버튼누른후자재구매계획",this.matPurPlanChecked),console.log("matPurPlanChecked 샘플",this.matPurPlanChecked[0])}catch(e){console.error("저장 실패:",e),alert("에러발생"),console.log("payLoad",o)}},async fetchInventoryPurPlan(){try{const o=await u.get("/api/getPurPlnChecked");this.matPurPlanChecked=o.data,console.log("matPurPlanChecked",this.matPurPlanChecked)}catch(o){console.log("자재구매계획 실패",o)}},infoPlntoOrd(o){this.mode="checked",this.checkedMatPln=[o],this.qty=o.총합,this.purDt=new Date().toISOString.slice(0,10),this.selectMats=[{mat_no:o.자재번호,mat_nm:o.자재명,prc:Number(o.총합)/Number(o.총합)||0}],o.거래처코드?this.selectVdr={vdr_no:o.거래처코드,cpy_nm:o.거래처명}:this.selectVdr=null,console.log("this.selectMats",this.selectMats)},handleCheckChange(){if(this.checkedMatPln.length===1){const o=this.checkedMatPln[0];this.mode="checked",this.qty=o.총합,this.purDt=new Date().toISOString().slice(0,10),this.selectMats=[{mat_no:o.자재번호,mat_nm:o.자재명,prc:Number(o.총가격)/Number(o.총합)||0}],o.거래처코드?this.selectVdr={vdr_no:o.거래처코드,cpy_nm:o.거래처명}:this.selectVdr=null}else this.mode="basic",this.selectMats=[],this.selectVdr=null,this.qty=0,alert("하나의 자재만 선택하세요")}}},x={key:0,class:"container py-4"},O={class:"d-flex justify-content-end mb-3 gap-2"},U={class:"card p-4 shadow-sm rounded-3 mb-4"},_={class:"row g-3"},S={class:"col-md-4"},N={class:"col-md-4"},q={class:"col-md-4"},I={class:"col-md-4"},T={class:"col-md-4 d-flex align-items-end"},z={class:"col-md-4 d-flex align-items-end"},B={key:0,class:"col-12"},j={class:"row g-3 mt-2"},F={class:"col-md-3"},L={class:"col-md-3"},E={class:"col-md-3"},A={class:"col-md-3"},G=["value"],H={key:1,class:"col-12 mt-4"},J={class:"row g-3"},K={class:"col-md-6"},Q={class:"col-md-6"},R={key:1,class:"container py-4"},W={class:"d-flex justify-content-end mb-3 gap-2"},X={class:"card p-4 shadow-sm rounded-3 mb-4"},Y={class:"row g-3"},Z={class:"col-md-4"},$={class:"col-md-4"},ll={class:"col-md-4"},tl={class:"col-md-4"},sl={class:"col-12"},el={class:"row g-3 mt-2"},ol={class:"col-md-3"},nl={class:"col-md-3"},dl={class:"col-md-3"},rl={class:"col-md-3"},al=["value"],il={class:"col-md-3"},ml={class:"col-md-3"},cl={class:"table"},ul=["value"],pl={key:0},bl={key:1};function yl(o,l,b,y,e,r){const m=h("mat-select-modal"),V=h("vdr-select-modal");return a(),i(M,null,[e.checkedMatPln.length===0?(a(),i("div",x,[l[38]||(l[38]=t("h2",{class:"mb-4 fw-bold"},"발주서입력",-1)),t("div",O,[t("button",{class:"btn btn-primary",onClick:l[0]||(l[0]=(...s)=>r.saveOrder&&r.saveOrder(...s))},"발주 등록"),t("button",{class:"btn btn-outline-primary",onClick:l[1]||(l[1]=(...s)=>r.gotoOrdView&&r.gotoOrdView(...s))},"발주 조회")]),t("div",U,[t("div",_,[t("div",S,[l[28]||(l[28]=t("label",{class:"form-label"},"발주일자",-1)),n(t("input",{type:"date",class:"form-control","onUpdate:modelValue":l[2]||(l[2]=s=>e.purDt=s)},null,512),[[d,e.purDt]])]),t("div",N,[l[29]||(l[29]=t("label",{class:"form-label"},"수령인",-1)),n(t("input",{type:"text",class:"form-control","onUpdate:modelValue":l[3]||(l[3]=s=>o.bizNo=s)},null,512),[[d,o.bizNo]])]),t("div",q,[l[30]||(l[30]=t("label",{class:"form-label"},"수령방법",-1)),n(t("input",{type:"text",class:"form-control","onUpdate:modelValue":l[4]||(l[4]=s=>o.dueDt=s)},null,512),[[d,o.dueDt]])]),t("div",I,[l[31]||(l[31]=t("label",{class:"form-label"},"수량",-1)),n(t("input",{type:"number",class:"form-control","onUpdate:modelValue":l[5]||(l[5]=s=>e.qty=s)},null,512),[[d,e.qty]])]),t("div",T,[t("button",{class:"btn btn-outline-secondary w-100",onClick:l[6]||(l[6]=s=>e.showModal=!0)},"자재 선택")]),t("div",z,[t("button",{class:"btn btn-outline-secondary w-100",onClick:l[7]||(l[7]=s=>e.showVdrModal=!0)},"거래처 선택")]),e.selectMats.length?(a(),i("div",B,[t("div",j,[t("div",F,[l[32]||(l[32]=t("label",{class:"form-label"},"자재번호",-1)),n(t("input",{"onUpdate:modelValue":l[8]||(l[8]=s=>e.selectMats[0].mat_no=s),type:"text",class:"form-control",readonly:""},null,512),[[d,e.selectMats[0].mat_no]])]),t("div",L,[l[33]||(l[33]=t("label",{class:"form-label"},"자재명",-1)),n(t("input",{"onUpdate:modelValue":l[9]||(l[9]=s=>e.selectMats[0].mat_nm=s),type:"text",class:"form-control",readonly:""},null,512),[[d,e.selectMats[0].mat_nm]])]),t("div",E,[l[34]||(l[34]=t("label",{class:"form-label"},"자재단가",-1)),n(t("input",{"onUpdate:modelValue":l[10]||(l[10]=s=>e.selectMats[0].prc=s),type:"text",class:"form-control",readonly:""},null,512),[[d,e.selectMats[0].prc]])]),t("div",A,[l[35]||(l[35]=t("label",{class:"form-label"},"금액",-1)),t("input",{value:r.totalPrc,type:"text",class:"form-control",readonly:""},null,8,G)])])])):c("",!0),e.selectVdr?(a(),i("div",H,[t("div",J,[t("div",K,[l[36]||(l[36]=t("label",{class:"form-label"},"거래처코드",-1)),n(t("input",{"onUpdate:modelValue":l[11]||(l[11]=s=>e.selectVdr.vdr_no=s),type:"text",class:"form-control",readonly:""},null,512),[[d,e.selectVdr.vdr_no]])]),t("div",Q,[l[37]||(l[37]=t("label",{class:"form-label"},"거래처명",-1)),n(t("input",{"onUpdate:modelValue":l[12]||(l[12]=s=>e.selectVdr.cpy_nm=s),type:"text",class:"form-control",readonly:""},null,512),[[d,e.selectVdr.cpy_nm]])])])])):c("",!0)])]),e.showModal?(a(),f(m,{key:0,"mat-list":e.mat,selected:e.selectMats,onSelectMat:r.handleMaterialSelect,onClose:l[13]||(l[13]=s=>e.showModal=!1)},null,8,["mat-list","selected","onSelectMat"])):c("",!0),e.showVdrModal?(a(),f(V,{key:1,"vdr-list":e.vdr,selected:e.selectVdr,onSelectVdr:r.handleVdrSelect,onClose:l[14]||(l[14]=s=>e.showVdrModal=!1)},null,8,["vdr-list","selected","onSelectVdr"])):c("",!0)])):e.checkedMatPln.length>0?(a(),i("div",R,[l[49]||(l[49]=t("h2",{class:"mb-4 fw-bold"},"발주서입력",-1)),t("div",W,[t("button",{class:"btn btn-primary",onClick:l[15]||(l[15]=(...s)=>r.saveOrder&&r.saveOrder(...s))},"발주 등록"),t("button",{class:"btn btn-outline-primary",onClick:l[16]||(l[16]=(...s)=>r.gotoOrdView&&r.gotoOrdView(...s))},"발주 조회")]),t("div",X,[t("div",Y,[t("div",Z,[l[39]||(l[39]=t("label",{class:"form-label"},"발주일자",-1)),n(t("input",{type:"date",class:"form-control","onUpdate:modelValue":l[17]||(l[17]=s=>e.purDt=s)},null,512),[[d,e.purDt]])]),t("div",$,[l[40]||(l[40]=t("label",{class:"form-label"},"수령인",-1)),n(t("input",{type:"text",class:"form-control","onUpdate:modelValue":l[18]||(l[18]=s=>o.bizNo=s)},null,512),[[d,o.bizNo]])]),t("div",ll,[l[41]||(l[41]=t("label",{class:"form-label"},"수령방법",-1)),n(t("input",{type:"text",class:"form-control","onUpdate:modelValue":l[19]||(l[19]=s=>o.dueDt=s)},null,512),[[d,o.dueDt]])]),t("div",tl,[l[42]||(l[42]=t("label",{class:"form-label"},"수량",-1)),n(t("input",{type:"number",class:"form-control","onUpdate:modelValue":l[20]||(l[20]=s=>e.qty=s)},null,512),[[d,e.qty]])]),t("div",sl,[t("div",el,[t("div",ol,[l[43]||(l[43]=t("label",{class:"form-label"},"자재번호",-1)),n(t("input",{"onUpdate:modelValue":l[21]||(l[21]=s=>e.selectMats[0].mat_no=s),type:"text",class:"form-control",readonly:""},null,512),[[d,e.selectMats[0].mat_no]])]),t("div",nl,[l[44]||(l[44]=t("label",{class:"form-label"},"자재명",-1)),n(t("input",{"onUpdate:modelValue":l[22]||(l[22]=s=>e.selectMats[0].mat_nm=s),type:"text",class:"form-control",readonly:""},null,512),[[d,e.selectMats[0].mat_nm]])]),t("div",dl,[l[45]||(l[45]=t("label",{class:"form-label"},"자재단가",-1)),n(t("input",{"onUpdate:modelValue":l[23]||(l[23]=s=>e.selectMats[0].prc=s),type:"text",class:"form-control",readonly:""},null,512),[[d,e.selectMats[0].prc]])]),t("div",rl,[l[46]||(l[46]=t("label",{class:"form-label"},"금액",-1)),t("input",{value:r.totalPrc,type:"text",class:"form-control",readonly:""},null,8,al)]),t("div",il,[l[47]||(l[47]=t("label",{class:"form-label"},"거래처코드",-1)),n(t("input",{"onUpdate:modelValue":l[24]||(l[24]=s=>e.selectMats[0].vdr_no=s),type:"text",class:"form-control",readonly:""},null,512),[[d,e.selectMats[0].vdr_no]])]),t("div",ml,[l[48]||(l[48]=t("label",{class:"form-label"},"거래처명",-1)),n(t("input",{"onUpdate:modelValue":l[25]||(l[25]=s=>e.selectMats[0].cpy_nm=s),type:"text",class:"form-control",readonly:""},null,512),[[d,e.selectMats[0].cpy_nm]])])])])])])])):c("",!0),l[51]||(l[51]=t("h3",null,"자재구매계획",-1)),t("table",cl,[l[50]||(l[50]=t("thead",null,[t("tr",null,[t("th",{scope:"col"},"선택"),t("th",{scope:"col"},"자재ID"),t("th",{scope:"col"},"자재명"),t("th",{scope:"col"},"수량"),t("th",{scope:"col"},"총가격"),t("th",{scope:"col"},"거래처")])],-1)),t("tbody",null,[(a(!0),i(M,null,w(e.matPurPlanChecked,(s,vl)=>(a(),i("tr",{key:s.자재번호},[t("td",null,[n(t("input",{type:"checkbox",value:s,"onUpdate:modelValue":l[26]||(l[26]=v=>e.checkedMatPln=v),onChange:l[27]||(l[27]=(...v)=>r.handleCheckChange&&r.handleCheckChange(...v))},null,40,ul),[[C,e.checkedMatPln]])]),t("td",null,p(s.자재번호),1),t("td",null,p(s.자재명),1),t("td",null,p(s.총합),1),t("td",null,p(s.총가격),1),s.거래처코드?(a(),i("td",bl,p(s.거래처명),1)):(a(),i("td",pl,"거래처x"))]))),128))])])],64)}const Vl=P(D,[["render",yl]]);export{Vl as default};
//# sourceMappingURL=orderForm-flgOE2xW.js.map
