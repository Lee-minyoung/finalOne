import{_ as g,c as r,a as t,t as d,j as m,F as _,r as y,g as k,o as i,f as h,i as x,w as v,k as C,d as M,l as f,e as p,U as I,S as $,b as q}from"./index-CxFk6QSJ.js";import{u as F}from"./useDates-UMs5Kxim.js";import{S as c}from"./sweetalert2.esm.all-DV3w3JmD.js";const N={전체:()=>!0,진행중:e=>["l2","l3","l4"].includes(e.ln_sts),대기중:e=>e.ln_sts==="l1",공정지시:e=>e.ln_sts==="l2",공정현황:e=>e.ln_sts==="l3",공정완료:e=>e.ln_sts==="l4",설비점검중:e=>["l5","l6"].includes(e.ln_sts)},S={props:{item:Object,usedLines:Array},data(){return{selectedLine:this.item.selected_line||""}},computed:{filteredLineList(){const e=N[this.statusFilter]||(()=>!0);return this.LineList.filter(e)}}},B={class:"modal-dialog modal-lg"},V={class:"modal-content"},D={class:"modal-header"},j={class:"modal-title mb-0 fw-bold"},z={class:"modal-body"},T={class:"table table-sm table-bordered table-hover text-center align-middle"},U=["disabled","onClick"],A={key:0},E={key:1};function O(e,s,o,L,u,a){return i(),r("div",{class:"modal fade show d-block",id:"lineModal",style:{background:"rgba(0,0,0,0.5)","z-index":"1051"},onClick:s[1]||(s[1]=k(n=>e.$emit("close"),["self"]))},[t("div",B,[t("div",V,[t("div",D,[t("h5",j,"라인 선택 - "+d(o.item.pdn_ord_no),1),t("button",{type:"button",class:"btn-close",onClick:s[0]||(s[0]=n=>e.$emit("close"))})]),t("div",z,[t("table",T,[s[4]||(s[4]=t("thead",{class:"table-light"},[t("tr",null,[t("th",null,"라인번호"),t("th",null,"라인명"),t("th",null,"상태"),t("th",null,"선택")])],-1)),t("tbody",null,[(i(!0),r(_,null,y(o.item.lineList.filter(n=>!o.usedLines.includes(n.ln_no)),n=>(i(),r("tr",{key:n.ln_no,class:h({"table-primary":u.selectedLine===n.ln_no})},[t("td",null,d(n.ln_no),1),t("td",null,d(n.ln_nm),1),t("td",null,[t("span",{class:h(["badge",{"bg-secondary":n.ln_sts==="l1","bg-info":n.ln_sts==="l2","bg-primary":n.ln_sts==="l3","bg-success":n.ln_sts==="l4","bg-danger":n.ln_sts==="l5","bg-warning text-dark":n.ln_sts==="l6","bg-dark":!["l1","l2","l3","l4","l5","l6"].includes(n.ln_sts)}])},d(n.ln_sts==="l1"?"비가동":n.ln_sts==="l2"?"대기중":n.ln_sts==="l3"?"공정중":n.ln_sts==="l4"?"준비중":n.ln_sts==="l5"?"수리중":n.ln_sts==="l6"?"점검중":"오류"),3)]),t("td",null,[t("button",{class:"btn btn-sm btn-outline-primary",disabled:n.ln_sts!=="l1",onClick:()=>{e.$emit("set-line",{...o.item,selected_line:n.ln_no}),e.$emit("close")}}," 선택 ",8,U)])],2))),128)),!o.item.lineList||o.item.lineList.length===0?(i(),r("tr",A,s[2]||(s[2]=[t("td",{colspan:"4",class:"text-center text-secondary"},"라인 정보가 없습니다.",-1)]))):o.item.lineList.filter(n=>!o.usedLines.includes(n.ln_no)).length===0?(i(),r("tr",E,s[3]||(s[3]=[t("td",{colspan:"4",class:"text-center text-danger"},"선택 가능한 라인이 없습니다.",-1)]))):m("",!0)])])])])])])}const G=g(S,[["render",O],["__scopeId","data-v-5acc0ac6"]]),H={components:{LineInstructionModal:G},data(){return{instructionList:[],selectedItem:null,showLineModal:!1,statusFilter:"r1+q2"}},computed:{dateFormat(){return F.dateFormat},usedLines(){return this.instructionList.filter(e=>e.selected_line).map(e=>e.selected_line)},filteredList(){return this.instructionList.filter(e=>{if(this.statusFilter==="전체")return!0;const[s,o]=this.statusFilter.split("+");return!(s&&e.ord_sts!==s||o&&e.mat_ins_sts!==o)})}},created(){this.fetchInstructions()},methods:{async fetchInstructions(){const e=await p.get("/api/prodinst");this.instructionList=e.data.map(s=>({...s,selected_line:""}))},openModal(e){this.selectedItem={...e},this.selectedItem.lineList=[],p.get("/api/lineDrop",{params:{pdn_ord_dtl_no:e.pdn_ord_dtl_no}}).then(s=>{this.selectedItem.lineList=s.data,this.showLineModal=!0})},setLine(e){const s=this.instructionList.findIndex(o=>o.pdn_ord_dtl_no===e.pdn_ord_dtl_no);s!==-1&&(this.instructionList[s].selected_line=e.selected_line)},async assignLine(e){if(!e.selected_line)return c.fire("❗ 알림","라인을 먼저 지정하세요.","warning");if(e.mat_ins_sts!=="q2")return c.fire("❗ 알림","입고완료 상태에서만 지시 가능합니다.","info");try{await p.post("/api/preparingLine",{pdn_ord_dtl_no:e.pdn_ord_dtl_no,ln_no:e.selected_line}),await c.fire("✅ 성공","지시 완료!","success"),this.fetchInstructions(),this.showLineModal=!1}catch(s){console.error(s),c.fire("오류","지시 중 문제가 발생했습니다.","error")}},async stopLine(e){if((await c.fire({title:"지시를 취소하시겠습니까?",text:`제품명: ${e.prd_nm}`,icon:"question",showCancelButton:!0,confirmButtonText:"예",cancelButtonText:"아니오"})).isConfirmed)try{await p.post("/api/stopLine",{pdn_ord_dtl_no:e.pdn_ord_dtl_no,ln_no:e.selected_line}),await c.fire("완료","지시가 취소되었습니다.","success"),this.fetchInstructions(),this.showLineModal=!1}catch(o){console.error(o),c.fire("오류","취소 중 문제가 발생했습니다.","error")}},viewCompleteStatus(e){c.fire({title:"✅ 완료현황",html:`
        <div style="text-align:left; line-height:1.7">
          <strong>지시ID:</strong> ${e.pdn_ord_no}<br>
          <strong>제품명:</strong> ${e.prd_nm}<br>
          <strong>지시수량:</strong> ${e.lo_ord_qty}개<br>
          <strong>불량수량:</strong> ${e.dft_qty}개<br>
          <strong>생산수량:</strong> ${e.pdn_qty}개<br>
          <strong>지시자:</strong> ${e.mgr}<br>
          <strong>완료일자:</strong> ${this.dateFormat(e.end_tm,"yyyy-MM-dd   hh시 mm분")}<br>

        </div>
      `,icon:"info"})},formatNumber(e){return e==null||isNaN(e)?"-":new Intl.NumberFormat().format(e)}}},J={class:"container mt-4"},K={class:"d-flex justify-content-end mb-3"},P={class:"table table-bordered text-center",style:{"min-width":"1200px"}},Q={class:"d-flex align-items-center justify-content-center gap-2"},R={key:0},W={key:1,class:"text-muted"},X=["onClick"],Y=["onClick"],Z={colspan:"1"},tt=["onClick"],et=["onClick"];function st(e,s,o,L,u,a){const n=f("router-link"),w=f("LineInstructionModal");return i(),r("div",J,[s[7]||(s[7]=t("h2",{class:"mb-4"},"생산지시현황",-1)),t("div",K,[v(t("select",{"onUpdate:modelValue":s[0]||(s[0]=l=>u.statusFilter=l),class:"form-select w-auto"},s[2]||(s[2]=[M('<option value="전체" data-v-886d0620>전체</option><option value="r1+q2" data-v-886d0620>지시 가능</option><option value="r1+q1" data-v-886d0620>지시 대기</option><option value="r2" data-v-886d0620>지시 완료</option><option value="r3" data-v-886d0620>생산 완료</option>',5)]),512),[[C,u.statusFilter]])]),t("table",P,[s[5]||(s[5]=t("colgroup",null,[t("col",{style:{width:"120px"}}),t("col",{style:{width:"180px"}}),t("col",{style:{width:"120px"}}),t("col",{style:{width:"140px"}}),t("col",{style:{width:"120px"}}),t("col",{style:{width:"120px"}}),t("col",{style:{width:"120px"}}),t("col",{style:{width:"100px"}})],-1)),s[6]||(s[6]=t("thead",{class:"table-light"},[t("tr",null,[t("th",null,"지시번호"),t("th",null,"제품명"),t("th",null,"지시수량"),t("th",null,"지시일자"),t("th",null,"지시자"),t("th",null,"재료 입고"),t("th",null,"라인 지정"),t("th",null,"현황")])],-1)),t("tbody",null,[(i(!0),r(_,null,y(a.filteredList,l=>(i(),r("tr",{key:l.pdn_ord_dtl_no},[t("td",null,d(l.pdn_ord_no),1),t("td",null,d(l.prd_nm),1),t("td",null,d(a.formatNumber(l.ord_qty)),1),t("td",null,d(a.dateFormat(l.pdn_ord_dt,"yyyy-MM-dd")),1),t("td",null,d(l.crt_by),1),l.ord_sts==="r1"?(i(),r(_,{key:0},[t("td",null,[t("span",{class:h(["badge",{"bg-warning text-dark":l.mat_ins_sts==="q1","bg-success":l.mat_ins_sts==="q2"}])},d(l.mat_ins_sts==="q1"?"입고대기":l.mat_ins_sts==="q2"?"입고완료":"오류"),3)]),t("td",null,[t("div",Q,[l.selected_line?(i(),r("span",R,d(l.selected_line),1)):(i(),r("span",W,"미지정")),t("button",{class:"btn btn-outline-secondary",onClick:b=>a.openModal(l)}," 🔍 ",8,X)])]),t("td",null,[t("button",{class:"btn btn-sm btn-primary",onClick:b=>a.assignLine(l)},"지시",8,Y)])],64)):l.ord_sts==="r2"?(i(),r(_,{key:1},[t("td",Z,[I(n,{to:"/LineMang",class:"badge text-dark text-decoration-none",style:{"background-color":"#aee2f8","font-size":"0.95rem",padding:"0.5rem 1.2rem",display:"inline-block","min-width":"110px","text-align":"center"}},{default:$(()=>s[3]||(s[3]=[q(" 생산지시완료 ")])),_:1,__:[3]})]),t("td",null,[t("span",null,d(l.ln_no),1)]),t("td",null,[t("button",{class:"btn btn-sm btn-danger",onClick:b=>a.stopLine(l)},"취소",8,tt)])],64)):l.ord_sts==="r3"?(i(),r(_,{key:2},[s[4]||(s[4]=t("td",{colspan:"2"},[t("span",{class:"badge text-white",style:{"background-color":"#6c757d","font-size":"0.95rem",padding:"0.5rem 1.2rem",display:"inline-block","min-width":"110px","text-align":"center"}}," 생산공정완료 ")],-1)),t("td",null,[t("button",{class:"btn btn-sm btn-outline-info",onClick:b=>a.viewCompleteStatus(l)}," 완료현황 ",8,et)])],64)):m("",!0)]))),128))])]),u.showLineModal?(i(),x(w,{key:0,item:u.selectedItem,"used-lines":a.usedLines,onSetLine:a.setLine,onClose:s[1]||(s[1]=l=>u.showLineModal=!1)},null,8,["item","used-lines","onSetLine"])):m("",!0)])}const it=g(H,[["render",st],["__scopeId","data-v-886d0620"]]);export{it as default};
//# sourceMappingURL=productionManagement-DC0a36rp.js.map
