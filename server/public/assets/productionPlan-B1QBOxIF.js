<<<<<<< HEAD
<<<<<<<< HEAD:server/public/assets/productionPlan-BLe1ioKA.js
import{_ as v,c,a as e,w as m,v as _,F as f,r as g,g as w,o as a,f as q,t as u,h as N,i as k,j as S,k as C,l as x,e as h,u as R,n as I}from"./index-CxFk6QSJ.js";import{u as F}from"./useDates-UMs5Kxim.js";import{S as b}from"./sweetalert2.esm.all-DV3w3JmD.js";const L={props:{prodList:Array,selected:Array},data(){return{search:"",selectedProd:[]}},computed:{filteredProducts(){return this.prodList.filter(n=>{var t;return(t=n.prd_nm)==null?void 0:t.includes(this.search)})}},created(){this.selectedProd=[...this.selected]},methods:{toggleProdSelection(n){const t=this.selectedProd.findIndex(l=>l.prd_no===n.prd_no);t>=0?this.selectedProd.splice(t,1):this.selectedProd.push(n)},isSelected(n){return this.selectedProd.some(t=>t.prd_no===n.prd_no)}}},V={class:"modal-dialog modal-lg"},U={class:"modal-content"},$={class:"modal-header"},j={class:"modal-body"},D={class:"d-flex justify-content-between align-items-center mb-3"},B={class:"table table-sm table-bordered text-center",style:{"min-width":"600px"}},T=["onClick"];function A(n,t,l,r,d,o){return a(),c("div",{class:"modal fade show d-block",style:{background:"rgba(0,0,0,0.5)","z-index":"1051"},onClick:t[3]||(t[3]=w(i=>n.$emit("close"),["self"]))},[e("div",V,[e("div",U,[e("div",$,[t[4]||(t[4]=e("h5",{class:"modal-title mb-0 fw-bold"},"ì œí’ˆ ì„ íƒ",-1)),e("button",{type:"button",class:"btn-close",onClick:t[0]||(t[0]=i=>n.$emit("close"))})]),e("div",j,[e("div",D,[m(e("input",{type:"text",class:"form-control w-25",placeholder:"ì œí’ˆëª… ê²€ìƒ‰","onUpdate:modelValue":t[1]||(t[1]=i=>d.search=i)},null,512),[[_,d.search]]),e("button",{class:"btn btn-outline-secondary text-dark",onClick:t[2]||(t[2]=i=>n.$emit("select-product",d.selectedProd))}," ì œí’ˆ ë“±ë¡ ")]),e("table",B,[t[5]||(t[5]=e("thead",{class:"table-light"},[e("tr",null,[e("th",null,"ì œí’ˆë²ˆí˜¸"),e("th",null,"ì œí’ˆëª…"),e("th",null,"í˜„ì¬ê³ ëŸ‰"),e("th",null,"ìƒì‚°í•„ìš”ìˆ˜ëŸ‰")])],-1)),e("tbody",null,[(a(!0),c(f,null,g(o.filteredProducts,i=>(a(),c("tr",{key:i.prd_no,onClick:y=>o.toggleProdSelection(i),class:q({"table-primary":o.isSelected(i)}),style:{cursor:"pointer"}},[e("td",null,u(i.prd_no),1),e("td",null,u(i.prd_nm),1),e("td",null,u(i.í˜„ì¬ê³ ëŸ‰),1),e("td",null,u(i.ìƒì‚°í•„ìš”ìˆ˜ëŸ‰),1)],10,T))),128))])])])])])])}const z=v(L,[["render",A],["__scopeId","data-v-bb02b97a"]]),M=N("instruction",{state:()=>({selectedPlans:[],instructionRows:[]}),actions:{setSelectedPlans(n){this.selectedPlans=n},generateInstructionRows(){console.log("selectedPlans for instruction:",this.selectedPlans),this.instructionRows=this.selectedPlans.filter(n=>Number(n.qty)>0).map(n=>{const t={pdn_pln_no:n.pdn_pln_no,pdn_pln_dtl_no:n.pdn_pln_dtl_no,prd_no:n.prd_no,prd_nm:n.prd_nm,qty:n.qty,instruction_qty:n.instruction_qty||n.qty-n.ord_qty||0,ord_qty:n.ord_qty||0,rmk:n.rmk||""};return console.log("instructionRow ìƒì„±:",t),t})},reset(){this.selectedPlans=[],this.instructionRows=[]}}}),E={name:"InstructionModal",emits:["submit","close"],computed:{instructionStore(){return M()},rows(){return this.instructionStore.instructionRows}},methods:{handleInput(n){const t=this.instructionStore.instructionRows[n];t.instruction_qty>t.qty?t.instruction_qty=t.qty:(t.instruction_qty<0||isNaN(t.instruction_qty))&&(t.instruction_qty=0)},submit(){const n=this.instructionStore.instructionRows;console.log("ğŸ”¥ ì§€ì‹œ ë“±ë¡ emit ì‹¤í–‰ë¨!"),console.log("ì „ì†¡í•  rows:",n),this.$emit("submit")},formatNumber(n){return n==null||isNaN(n)?"-":new Intl.NumberFormat().format(n)}}},Q={class:"modal-dialog modal-lg"},O={class:"modal-content"},Y={class:"modal-header"},G={class:"modal-body"},H={class:"table table-sm table-bordered text-center"},J={style:{width:"100px"}},K=["onUpdate:modelValue","max","onInput"],W=["onUpdate:modelValue"],X={class:"modal-footer"};function Z(n,t,l,r,d,o){return a(),c("div",{class:"modal fade show d-block",style:{background:"rgba(0,0,0,0.5)","z-index":"1051"},onClick:t[3]||(t[3]=w(i=>n.$emit("close"),["self"]))},[e("div",Q,[e("div",O,[e("div",Y,[t[4]||(t[4]=e("h5",{class:"modal-title mb-0 fw-bold"},"ê³„íš ì§€ì‹œ",-1)),e("button",{type:"button",class:"btn-close",onClick:t[0]||(t[0]=i=>n.$emit("close"))})]),e("div",G,[t[7]||(t[7]=e("h6",{class:"fw-bold mb-2"},"ì§€ì‹œ ìƒì„¸ ì…ë ¥",-1)),e("table",H,[t[6]||(t[6]=e("thead",{class:"table-light"},[e("tr",null,[e("th",null,"ì œí’ˆëª…"),e("th",null,"ê³„íšìˆ˜ëŸ‰"),e("th",null,"ëˆ„ì ì§€ì‹œìˆ˜ëŸ‰"),e("th",null,"ë¯¸ì§€ì‹œìˆ˜ëŸ‰"),e("th",null,"ì§€ì‹œìˆ˜ëŸ‰"),e("th",null,"ì™„ë£Œìˆ˜ëŸ‰"),e("th",null,"ë¹„ê³ ")])],-1)),e("tbody",null,[(a(!0),c(f,null,g(o.instructionStore.instructionRows,(i,y)=>(a(),c("tr",{key:i.pdn_pln_dtl_no},[e("td",null,u(i.prd_nm),1),e("td",null,u(o.formatNumber(i.qty)),1),e("td",null,u(o.formatNumber(i.ord_qty)),1),e("td",null,u(o.formatNumber(i.qty-i.ord_qty-i.instruction_qty||0)),1),e("td",J,[m(e("input",{type:"number",class:"form-control","onUpdate:modelValue":s=>i.instruction_qty=s,min:"0",max:i.qty-i.ord_qty,onInput:s=>o.handleInput(y)},null,40,K),[[_,i.instruction_qty,void 0,{number:!0}]])]),t[5]||(t[5]=e("td",null,null,-1)),e("td",null,[m(e("input",{class:"form-control","onUpdate:modelValue":s=>i.rmk=s},null,8,W),[[_,i.rmk]])])]))),128))])])]),e("div",X,[e("button",{class:"btn btn-primary",onClick:t[1]||(t[1]=(...i)=>o.submit&&o.submit(...i))},"ì§€ì‹œ ë“±ë¡"),e("button",{class:"btn btn-outline-secondary text-dark",onClick:t[2]||(t[2]=i=>n.$emit("close"))},"ì·¨ì†Œ")])])])])}const tt=v(E,[["render",Z],["__scopeId","data-v-0241b949"]]),et={name:"ProductionPlan",components:{ProductSelectModal:z,InstructionModal:tt},data(){return{prodPlanList:[],planRows:[],showProductModal:!1,showInstructionModal:!1,prodList:[],empStore:R(),statusFilter:"ë¯¸ì§€ì‹œ/ë¶€ë¶„ì§€ì‹œ",today:this.getTodayDate()}},computed:{instructionStore(){return M()},employeeName(){return this.empStore.loginInfo.nm||""},employeeNo(){return this.empStore.loginInfo.emp_no||""},sortedProdPlanList(){return[...this.prodPlanList.filter(t=>{const l=this.getProgress(t.qty,t.ord_qty,t.sts),r=t.sts;return this.statusFilter==="ì „ì²´"?!0:this.statusFilter==="ë¯¸ì§€ì‹œ/ë¶€ë¶„ì§€ì‹œ"?l<100:this.statusFilter==="ì§€ì‹œì™„ë£Œ"?l>=100&&r!=="s3":this.statusFilter==="ìƒì‚°ì™„ë£Œ"?l>=100&&r==="s3":!0})].sort((t,l)=>{const r=Number(t.ord_qty||0)>=Number(t.qty||0),d=Number(l.ord_qty||0)>=Number(l.qty||0);return r-d})}},mounted(){this.getProdPlanList()},methods:{async getProdPlanList(){try{const n=await h.get("/api/prodpln");this.prodPlanList=n.data}catch(n){console.error("ê³„íš ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨",n)}},dateFormat(n,t){return F.dateFormat(n,t)},isFullyInstructed(n){return Number(n.ord_qty||0)>=Number(n.qty||0)},isSelected(n){return this.instructionStore.selectedPlans.some(t=>t.pdn_pln_dtl_no===n.pdn_pln_dtl_no)},getProgress(n,t){const l=Number(n||0),r=Number(t||0);return l===0?0:Math.round(r/l*100)},getStatus(n,t,l){const r=this.getProgress(n,t);return r===0?"ê³„íšì™„ë£Œ":r<100?"ë¶€ë¶„ì§€ì‹œ":r>=100?l==="s3"?"ìƒì‚°ì™„ë£Œ":"ì§€ì‹œì™„ë£Œ":"ì˜¤ë¥˜"},getProgressBarClass(n,t,l){const r=this.getProgress(n,t);return r===0?"bg-secondary":r<100?"bg-warning text-dark":l==="s3"?"bg-primary":"bg-success"},removePlanRow(n){this.planRows.splice(n,1)},resetAll(){confirm("ì •ë§ ì´ˆê¸°í™” í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì…ë ¥ê°’ì´ ëª¨ë‘ ì‚¬ë¼ì§‘ë‹ˆë‹¤.")&&(this.planRows=[{prd_no:"",prd_nm:"",qty:"",st_dt:"",end_dt:"",rmk:"",sts:"ê³„íšì™„ë£Œ"}],this.instructionStore.selectedPlans=[],this.instructionStore.generateInstructionRows(),this.showInstructionModal=!1)},async addPlan(){try{const n=[];for(let l of this.planRows){if(!l.prd_no||l.qty<=0||!l.st_dt||!l.end_dt){alert("ëª¨ë“  í•­ëª©ì„ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•˜ì„¸ìš”.");return}await h.post("/api/prodpln",{...l,crt_by:this.empStore.loginInfo.emp_no},{headers:{"Content-Type":"application/json"}}),n.push(l)}const t=n.map(l=>`<li>${l.prd_nm} (${l.qty}ê°œ)</li>`).join("");await b.fire({title:"âœ… ê³„íš ë“±ë¡ ì™„ë£Œ!",html:`<ul style="text-align:left; padding-left:1.2rem; margin:0;">${t}</ul>`,icon:"success",confirmButtonText:"í™•ì¸"}),this.planRows=[{prd_no:"",prd_nm:"",qty:"",st_dt:"",end_dt:"",rmk:"",sts:"s1"}],this.getProdPlanList()}catch(n){console.error("ë“±ë¡ ì‹¤íŒ¨",n),await b.fire("âŒ ì‹¤íŒ¨","ê³„íš ë“±ë¡ ì‹¤íŒ¨","error")}},openProductModal(){h.get("/api/prodpln/prdList").then(n=>{this.prodList=n.data,this.showProductModal=!0}).catch(n=>{console.error("ì œí’ˆ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨",n)})},handleSelectedProducts(n){let t=[...this.planRows];const l=new Set(t.map(d=>d.prd_no));let r=0;for(let d=0;d<t.length&&r<n.length;d++){const o=t[d],i=n[r];!o.prd_no&&!l.has(i.prd_no)&&(o.prd_no=i.prd_no,o.prd_nm=i.prd_nm,l.add(i.prd_no),r++)}for(const d of n)l.has(d.prd_no)||(t.push({prd_no:d.prd_no,prd_nm:d.prd_nm,qty:"",st_dt:"",end_dt:"",rmk:"",crt_by:this.empStore.loginInfo.emp_no,status:"ê³„íšì™„ë£Œ"}),l.add(d.prd_no));this.planRows=t.filter(d=>d.prd_no&&n.some(o=>o.prd_no===d.prd_no)),this.showProductModal=!1},togglePlanSelection(n){const t=this.instructionStore.selectedPlans.findIndex(l=>l.pdn_pln_no===n.pdn_pln_no);t>=0?this.instructionStore.selectedPlans.splice(t,1):this.instructionStore.selectedPlans.push(n)},openInstructionModal(){if(this.instructionStore.selectedPlans.length===0){alert("ì§€ì‹œí•  ê³„íšì„ ì„ íƒí•´ì£¼ì„¸ìš”.");return}this.instructionStore.selectedPlans=this.instructionStore.selectedPlans.map(n=>({...n,prd_no:n.prd_no||n.prd.prd_no||"",pdn_pln_dtl_no:n.pdn_pln_dtl_no||""})),this.instructionStore.generateInstructionRows(),this.showInstructionModal=!0},async submitInstructions(){var l;const n=this.instructionStore.instructionRows,t={};for(const r of n){if(r.instruction_qty<=0||r.instruction_qty>r.qty){alert(`ì§€ì‹œìˆ˜ëŸ‰ ì˜¤ë¥˜ (ì œí’ˆ: ${r.prd_nm||r.prd_no})`);return}const d=r.pdn_pln_no;t[d]||(t[d]=[]),t[d].push({pdn_pln_dtl_no:r.pdn_pln_dtl_no,prd_no:r.prd_no,instruction_qty:r.instruction_qty,ord_sts:"s1",crt_by:this.empStore.loginInfo.emp_no,rmk:r.rmk})}try{for(const[d,o]of Object.entries(t)){const i={pdn_pln_no:d,details:o};await h.post("/api/prodinst",{...i,crt_by:this.empStore.loginInfo.emp_no},{headers:{"Content-Type":"application/json"}})}const r=n.map(d=>`<li>${d.prd_nm} : ${d.instruction_qty}ê°œ</li>`).join("");await b.fire({title:"ğŸ‰ ì§€ì‹œ ë“±ë¡ ì™„ë£Œ!",html:`<ul style="text-align:left; padding-left:1.2rem; margin:0;">${r}</ul>`,icon:"success",confirmButtonText:"í™•ì¸"}),this.showInstructionModal=!1,this.instructionStore.reset(),this.getProdPlanList()}catch(r){console.error("ì§€ì‹œ ë“±ë¡ ì‹¤íŒ¨",((l=r.response)==null?void 0:l.data)||r.message),await b.fire("âŒ ì‹¤íŒ¨","ì§€ì‹œ ë“±ë¡ ì¤‘ ì˜¤ë¥˜ ë°œìƒ","error")}},formatNumber(n){return n==null||isNaN(n)?"-":new Intl.NumberFormat().format(n)},onFormattedQtyInput(n,t){const l=n.target.value.replace(/[^\d]/g,""),r=Number(l);t.qty=Math.max(0,r)},getTodayDate(){const n=new Date,t=n.getFullYear(),l=String(n.getMonth()+1).padStart(2,"0"),r=String(n.getDate()).padStart(2,"0");return`${t}-${l}-${r}`}}},nt={class:"container mt-4"},st={class:"d-flex justify-content-between align-items-center mb-4"},ot={class:"d-flex gap-2"},lt={class:"mb-ï¼‘ d-flex justify-content"},rt={class:"table table-bordered text-center",style:{"min-width":"1200px"}},dt={class:"input-group"},it=["onUpdate:modelValue"],ut=["value","onInput"],at=["onUpdate:modelValue"],ct=["onUpdate:modelValue"],pt=["onUpdate:modelValue"],mt=["onClick"],_t=["onClick"],yt={class:"progress",style:{height:"22px"}};function ht(n,t,l,r,d,o){const i=x("ProductSelectModal"),y=x("InstructionModal");return a(),c("div",nt,[e("div",st,[t[8]||(t[8]=e("h2",{class:"mb-4"},"ìƒì‚° ê³„íš ê´€ë¦¬",-1)),e("div",ot,[e("div",lt,[m(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>d.statusFilter=s),class:"form-select w-auto"},t[7]||(t[7]=[e("option",{value:"ì „ì²´"},"ì „ì²´",-1),e("option",{value:"ë¯¸ì§€ì‹œ/ë¶€ë¶„ì§€ì‹œ"},"ë¯¸ì§€ì‹œ/ë¶€ë¶„ì§€ì‹œ",-1),e("option",{value:"ì§€ì‹œì™„ë£Œ"},"ì§€ì‹œì™„ë£Œ",-1),e("option",{value:"ìƒì‚°ì™„ë£Œ"},"ìƒì‚°ì™„ë£Œ",-1)]),512),[[C,d.statusFilter]])]),e("button",{class:"btn btn-warning text-white",onClick:t[1]||(t[1]=(...s)=>o.resetAll&&o.resetAll(...s))},"ì´ˆê¸°í™”"),e("button",{class:"btn btn-success text-white",onClick:t[2]||(t[2]=(...s)=>o.openProductModal&&o.openProductModal(...s))},"ì œí’ˆë“±ë¡"),e("button",{class:"btn btn-success text-white",onClick:t[3]||(t[3]=(...s)=>o.addPlan&&o.addPlan(...s))},"ê³„íšë“±ë¡"),e("button",{class:"btn btn-primary",onClick:t[4]||(t[4]=(...s)=>o.openInstructionModal&&o.openInstructionModal(...s))},"ê³„íšì§€ì‹œ")])]),e("table",rt,[t[14]||(t[14]=e("colgroup",null,[e("col",{style:{width:"80px"}}),e("col",{style:{width:"160px"}}),e("col",{style:{width:"100px"}}),e("col",{style:{width:"100px"}}),e("col",{style:{width:"140px"}}),e("col",{style:{width:"140px"}}),e("col",{style:{width:"100px"}}),e("col",{style:{width:"120px"}}),e("col",{style:{width:"120px"}}),e("col",{style:{width:"60px"}})],-1)),t[15]||(t[15]=e("thead",{class:"table-light"},[e("tr",null,[e("th",null,"ê³„íšë²ˆí˜¸"),e("th",null,"ì œí’ˆëª…"),e("th",null,"ê³„íšìˆ˜ëŸ‰"),e("th",null,"ëˆ„ì ì§€ì‹œëŸ‰"),e("th",null,"ê³„íšì‹œì‘ì¼ì"),e("th",null,"ê³„íšë§ˆê°ì¼ì"),e("th",null,"ì§„í–‰ë¥ "),e("th",null,"ìƒíƒœ"),e("th",null,"ë¹„ê³ "),e("th",null,"ì‚­ì œ")])],-1)),e("tbody",null,[(a(!0),c(f,null,g(d.planRows,(s,P)=>(a(),c("tr",{key:"new-"+P},[t[9]||(t[9]=e("td",null,"ì‹ ê·œ",-1)),e("td",null,[e("div",dt,[m(e("input",{"onUpdate:modelValue":p=>s.prd_nm=p,class:"form-control",placeholder:"ì œí’ˆ ì„ íƒ",readonly:""},null,8,it),[[_,s.prd_nm]])])]),e("td",null,[e("input",{type:"text",class:"form-control text-end",value:o.formatNumber(s.qty),onInput:p=>o.onFormattedQtyInput(p,s),placeholder:"ìˆ˜ëŸ‰",min:0},null,40,ut)]),t[10]||(t[10]=e("td",null,null,-1)),e("td",null,[m(e("input",{"onUpdate:modelValue":p=>s.st_dt=p,type:"date",class:"form-control"},null,8,at),[[_,s.st_dt]])]),e("td",null,[m(e("input",{"onUpdate:modelValue":p=>s.end_dt=p,type:"date",class:"form-control"},null,8,ct),[[_,s.end_dt]])]),t[11]||(t[11]=e("td",null,null,-1)),t[12]||(t[12]=e("td",null,null,-1)),e("td",null,[m(e("input",{"onUpdate:modelValue":p=>s.rmk=p,class:"form-control",placeholder:"ë¹„ê³  ì…ë ¥"},null,8,pt),[[_,s.rmk]])]),e("td",null,[d.planRows.length>0?(a(),c("button",{key:0,class:"btn btn-outline-danger btn-sm me-1",onClick:p=>o.removePlanRow(P)}," - ",8,mt)):S("",!0)])]))),128)),(a(!0),c(f,null,g(o.sortedProdPlanList,s=>(a(),c("tr",{key:s.pdn_pln_no,onClick:P=>!o.isFullyInstructed(s)&&o.togglePlanSelection(s),class:q([o.isSelected(s)?"table-primary":"",o.isFullyInstructed(s)?"text-muted":""]),style:I(o.isFullyInstructed(s)?"pointer-events: none; opacity: 0.6;":"cursor: pointer;")},[e("td",null,u(s.pdn_pln_no),1),e("td",null,u(s.prd_nm),1),e("td",null,u(o.formatNumber(s.qty)),1),e("td",null,u(o.formatNumber(s.ord_qty)),1),e("td",null,u(o.dateFormat(s.st_dt,"yyyy-MM-dd")),1),e("td",null,u(o.dateFormat(s.end_dt,"yyyy-MM-dd")),1),e("td",null,u(o.getProgress(s.qty,s.ord_qty))+"%",1),e("td",null,[e("div",yt,[e("div",{class:q(["progress-bar",o.getProgressBarClass(s.qty,s.ord_qty,s.sts)]),style:I({width:o.getProgress(s.qty,s.ord_qty)+"%"}),role:"progressbar"},u(o.getStatus(s.qty,s.ord_qty,s.sts)),7)])]),e("td",null,u(s.rmk),1),t[13]||(t[13]=e("td",null,null,-1))],14,_t))),128))])]),d.showProductModal?(a(),k(i,{key:0,prodList:d.prodList,selected:d.planRows,onSelectProduct:o.handleSelectedProducts,onClose:t[5]||(t[5]=s=>d.showProductModal=!1)},null,8,["prodList","selected","onSelectProduct"])):S("",!0),d.showInstructionModal?(a(),k(y,{key:1,onSubmit:o.submitInstructions,onClose:t[6]||(t[6]=s=>d.showInstructionModal=!1)},null,8,["onSubmit"])):S("",!0)])}const Pt=v(et,[["render",ht],["__scopeId","data-v-c072d742"]]);export{Pt as default};
//# sourceMappingURL=productionPlan-BLe1ioKA.js.map
========
import{_ as v,c,a as e,w as m,v as _,F as f,r as g,g as w,o as a,f as q,t as u,h as N,i as k,j as S,k as C,l as x,e as h,u as R,n as I}from"./index-DRp0-N0C.js";import{u as F}from"./useDates-UMs5Kxim.js";import{S as b}from"./sweetalert2.esm.all-DV3w3JmD.js";const L={props:{prodList:Array,selected:Array},data(){return{search:"",selectedProd:[]}},computed:{filteredProducts(){return this.prodList.filter(n=>{var t;return(t=n.prd_nm)==null?void 0:t.includes(this.search)})}},created(){this.selectedProd=[...this.selected]},methods:{toggleProdSelection(n){const t=this.selectedProd.findIndex(l=>l.prd_no===n.prd_no);t>=0?this.selectedProd.splice(t,1):this.selectedProd.push(n)},isSelected(n){return this.selectedProd.some(t=>t.prd_no===n.prd_no)}}},V={class:"modal-dialog modal-lg"},U={class:"modal-content"},$={class:"modal-header"},j={class:"modal-body"},D={class:"d-flex justify-content-between align-items-center mb-3"},B={class:"table table-sm table-bordered text-center",style:{"min-width":"600px"}},T=["onClick"];function A(n,t,l,r,d,o){return a(),c("div",{class:"modal fade show d-block",style:{background:"rgba(0,0,0,0.5)","z-index":"1051"},onClick:t[3]||(t[3]=w(i=>n.$emit("close"),["self"]))},[e("div",V,[e("div",U,[e("div",$,[t[4]||(t[4]=e("h5",{class:"modal-title mb-0 fw-bold"},"ì œí’ˆ ì„ íƒ",-1)),e("button",{type:"button",class:"btn-close",onClick:t[0]||(t[0]=i=>n.$emit("close"))})]),e("div",j,[e("div",D,[m(e("input",{type:"text",class:"form-control w-25",placeholder:"ì œí’ˆëª… ê²€ìƒ‰","onUpdate:modelValue":t[1]||(t[1]=i=>d.search=i)},null,512),[[_,d.search]]),e("button",{class:"btn btn-outline-secondary text-dark",onClick:t[2]||(t[2]=i=>n.$emit("select-product",d.selectedProd))}," ì œí’ˆ ë“±ë¡ ")]),e("table",B,[t[5]||(t[5]=e("thead",{class:"table-light"},[e("tr",null,[e("th",null,"ì œí’ˆë²ˆí˜¸"),e("th",null,"ì œí’ˆëª…"),e("th",null,"í˜„ì¬ê³ ëŸ‰"),e("th",null,"ìƒì‚°í•„ìš”ìˆ˜ëŸ‰")])],-1)),e("tbody",null,[(a(!0),c(f,null,g(o.filteredProducts,i=>(a(),c("tr",{key:i.prd_no,onClick:y=>o.toggleProdSelection(i),class:q({"table-primary":o.isSelected(i)}),style:{cursor:"pointer"}},[e("td",null,u(i.prd_no),1),e("td",null,u(i.prd_nm),1),e("td",null,u(i.í˜„ì¬ê³ ëŸ‰),1),e("td",null,u(i.ìƒì‚°í•„ìš”ìˆ˜ëŸ‰),1)],10,T))),128))])])])])])])}const z=v(L,[["render",A],["__scopeId","data-v-bb02b97a"]]),M=N("instruction",{state:()=>({selectedPlans:[],instructionRows:[]}),actions:{setSelectedPlans(n){this.selectedPlans=n},generateInstructionRows(){console.log("selectedPlans for instruction:",this.selectedPlans),this.instructionRows=this.selectedPlans.filter(n=>Number(n.qty)>0).map(n=>{const t={pdn_pln_no:n.pdn_pln_no,pdn_pln_dtl_no:n.pdn_pln_dtl_no,prd_no:n.prd_no,prd_nm:n.prd_nm,qty:n.qty,instruction_qty:n.instruction_qty||n.qty-n.ord_qty||0,ord_qty:n.ord_qty||0,rmk:n.rmk||""};return console.log("instructionRow ìƒì„±:",t),t})},reset(){this.selectedPlans=[],this.instructionRows=[]}}}),E={name:"InstructionModal",emits:["submit","close"],computed:{instructionStore(){return M()},rows(){return this.instructionStore.instructionRows}},methods:{handleInput(n){const t=this.instructionStore.instructionRows[n];t.instruction_qty>t.qty?t.instruction_qty=t.qty:(t.instruction_qty<0||isNaN(t.instruction_qty))&&(t.instruction_qty=0)},submit(){const n=this.instructionStore.instructionRows;console.log("ğŸ”¥ ì§€ì‹œ ë“±ë¡ emit ì‹¤í–‰ë¨!"),console.log("ì „ì†¡í•  rows:",n),this.$emit("submit")},formatNumber(n){return n==null||isNaN(n)?"-":new Intl.NumberFormat().format(n)}}},Q={class:"modal-dialog modal-lg"},O={class:"modal-content"},Y={class:"modal-header"},G={class:"modal-body"},H={class:"table table-sm table-bordered text-center"},J={style:{width:"100px"}},K=["onUpdate:modelValue","max","onInput"],W=["onUpdate:modelValue"],X={class:"modal-footer"};function Z(n,t,l,r,d,o){return a(),c("div",{class:"modal fade show d-block",style:{background:"rgba(0,0,0,0.5)","z-index":"1051"},onClick:t[3]||(t[3]=w(i=>n.$emit("close"),["self"]))},[e("div",Q,[e("div",O,[e("div",Y,[t[4]||(t[4]=e("h5",{class:"modal-title mb-0 fw-bold"},"ê³„íš ì§€ì‹œ",-1)),e("button",{type:"button",class:"btn-close",onClick:t[0]||(t[0]=i=>n.$emit("close"))})]),e("div",G,[t[7]||(t[7]=e("h6",{class:"fw-bold mb-2"},"ì§€ì‹œ ìƒì„¸ ì…ë ¥",-1)),e("table",H,[t[6]||(t[6]=e("thead",{class:"table-light"},[e("tr",null,[e("th",null,"ì œí’ˆëª…"),e("th",null,"ê³„íšìˆ˜ëŸ‰"),e("th",null,"ëˆ„ì ì§€ì‹œìˆ˜ëŸ‰"),e("th",null,"ë¯¸ì§€ì‹œìˆ˜ëŸ‰"),e("th",null,"ì§€ì‹œìˆ˜ëŸ‰"),e("th",null,"ì™„ë£Œìˆ˜ëŸ‰"),e("th",null,"ë¹„ê³ ")])],-1)),e("tbody",null,[(a(!0),c(f,null,g(o.instructionStore.instructionRows,(i,y)=>(a(),c("tr",{key:i.pdn_pln_dtl_no},[e("td",null,u(i.prd_nm),1),e("td",null,u(o.formatNumber(i.qty)),1),e("td",null,u(o.formatNumber(i.ord_qty)),1),e("td",null,u(o.formatNumber(i.qty-i.ord_qty-i.instruction_qty||0)),1),e("td",J,[m(e("input",{type:"number",class:"form-control","onUpdate:modelValue":s=>i.instruction_qty=s,min:"0",max:i.qty-i.ord_qty,onInput:s=>o.handleInput(y)},null,40,K),[[_,i.instruction_qty,void 0,{number:!0}]])]),t[5]||(t[5]=e("td",null,null,-1)),e("td",null,[m(e("input",{class:"form-control","onUpdate:modelValue":s=>i.rmk=s},null,8,W),[[_,i.rmk]])])]))),128))])])]),e("div",X,[e("button",{class:"btn btn-primary",onClick:t[1]||(t[1]=(...i)=>o.submit&&o.submit(...i))},"ì§€ì‹œ ë“±ë¡"),e("button",{class:"btn btn-outline-secondary text-dark",onClick:t[2]||(t[2]=i=>n.$emit("close"))},"ì·¨ì†Œ")])])])])}const tt=v(E,[["render",Z],["__scopeId","data-v-0241b949"]]),et={name:"ProductionPlan",components:{ProductSelectModal:z,InstructionModal:tt},data(){return{prodPlanList:[],planRows:[],showProductModal:!1,showInstructionModal:!1,prodList:[],empStore:R(),statusFilter:"ë¯¸ì§€ì‹œ/ë¶€ë¶„ì§€ì‹œ",today:this.getTodayDate()}},computed:{instructionStore(){return M()},employeeName(){return this.empStore.loginInfo.nm||""},employeeNo(){return this.empStore.loginInfo.emp_no||""},sortedProdPlanList(){return[...this.prodPlanList.filter(t=>{const l=this.getProgress(t.qty,t.ord_qty,t.sts),r=t.sts;return this.statusFilter==="ì „ì²´"?!0:this.statusFilter==="ë¯¸ì§€ì‹œ/ë¶€ë¶„ì§€ì‹œ"?l<100:this.statusFilter==="ì§€ì‹œì™„ë£Œ"?l>=100&&r!=="s3":this.statusFilter==="ìƒì‚°ì™„ë£Œ"?l>=100&&r==="s3":!0})].sort((t,l)=>{const r=Number(t.ord_qty||0)>=Number(t.qty||0),d=Number(l.ord_qty||0)>=Number(l.qty||0);return r-d})}},mounted(){this.getProdPlanList()},methods:{async getProdPlanList(){try{const n=await h.get("/api/prodpln");this.prodPlanList=n.data}catch(n){console.error("ê³„íš ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨",n)}},dateFormat(n,t){return F.dateFormat(n,t)},isFullyInstructed(n){return Number(n.ord_qty||0)>=Number(n.qty||0)},isSelected(n){return this.instructionStore.selectedPlans.some(t=>t.pdn_pln_dtl_no===n.pdn_pln_dtl_no)},getProgress(n,t){const l=Number(n||0),r=Number(t||0);return l===0?0:Math.round(r/l*100)},getStatus(n,t,l){const r=this.getProgress(n,t);return r===0?"ê³„íšì™„ë£Œ":r<100?"ë¶€ë¶„ì§€ì‹œ":r>=100?l==="s3"?"ìƒì‚°ì™„ë£Œ":"ì§€ì‹œì™„ë£Œ":"ì˜¤ë¥˜"},getProgressBarClass(n,t,l){const r=this.getProgress(n,t);return r===0?"bg-secondary":r<100?"bg-warning text-dark":l==="s3"?"bg-primary":"bg-success"},removePlanRow(n){this.planRows.splice(n,1)},resetAll(){confirm("ì •ë§ ì´ˆê¸°í™” í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì…ë ¥ê°’ì´ ëª¨ë‘ ì‚¬ë¼ì§‘ë‹ˆë‹¤.")&&(this.planRows=[{prd_no:"",prd_nm:"",qty:"",st_dt:"",end_dt:"",rmk:"",sts:"ê³„íšì™„ë£Œ"}],this.instructionStore.selectedPlans=[],this.instructionStore.generateInstructionRows(),this.showInstructionModal=!1)},async addPlan(){try{const n=[];for(let l of this.planRows){if(!l.prd_no||l.qty<=0||!l.st_dt||!l.end_dt){alert("ëª¨ë“  í•­ëª©ì„ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•˜ì„¸ìš”.");return}await h.post("/api/prodpln",{...l,crt_by:this.empStore.loginInfo.emp_no},{headers:{"Content-Type":"application/json"}}),n.push(l)}const t=n.map(l=>`<li>${l.prd_nm} (${l.qty}ê°œ)</li>`).join("");await b.fire({title:"âœ… ê³„íš ë“±ë¡ ì™„ë£Œ!",html:`<ul style="text-align:left; padding-left:1.2rem; margin:0;">${t}</ul>`,icon:"success",confirmButtonText:"í™•ì¸"}),this.planRows=[{prd_no:"",prd_nm:"",qty:"",st_dt:"",end_dt:"",rmk:"",sts:"s1"}],this.getProdPlanList()}catch(n){console.error("ë“±ë¡ ì‹¤íŒ¨",n),await b.fire("âŒ ì‹¤íŒ¨","ê³„íš ë“±ë¡ ì‹¤íŒ¨","error")}},openProductModal(){h.get("/api/prodpln/prdList").then(n=>{this.prodList=n.data,this.showProductModal=!0}).catch(n=>{console.error("ì œí’ˆ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨",n)})},handleSelectedProducts(n){let t=[...this.planRows];const l=new Set(t.map(d=>d.prd_no));let r=0;for(let d=0;d<t.length&&r<n.length;d++){const o=t[d],i=n[r];!o.prd_no&&!l.has(i.prd_no)&&(o.prd_no=i.prd_no,o.prd_nm=i.prd_nm,l.add(i.prd_no),r++)}for(const d of n)l.has(d.prd_no)||(t.push({prd_no:d.prd_no,prd_nm:d.prd_nm,qty:"",st_dt:"",end_dt:"",rmk:"",crt_by:this.empStore.loginInfo.emp_no,status:"ê³„íšì™„ë£Œ"}),l.add(d.prd_no));this.planRows=t.filter(d=>d.prd_no&&n.some(o=>o.prd_no===d.prd_no)),this.showProductModal=!1},togglePlanSelection(n){const t=this.instructionStore.selectedPlans.findIndex(l=>l.pdn_pln_no===n.pdn_pln_no);t>=0?this.instructionStore.selectedPlans.splice(t,1):this.instructionStore.selectedPlans.push(n)},openInstructionModal(){if(this.instructionStore.selectedPlans.length===0){alert("ì§€ì‹œí•  ê³„íšì„ ì„ íƒí•´ì£¼ì„¸ìš”.");return}this.instructionStore.selectedPlans=this.instructionStore.selectedPlans.map(n=>({...n,prd_no:n.prd_no||n.prd.prd_no||"",pdn_pln_dtl_no:n.pdn_pln_dtl_no||""})),this.instructionStore.generateInstructionRows(),this.showInstructionModal=!0},async submitInstructions(){var l;const n=this.instructionStore.instructionRows,t={};for(const r of n){if(r.instruction_qty<=0||r.instruction_qty>r.qty){alert(`ì§€ì‹œìˆ˜ëŸ‰ ì˜¤ë¥˜ (ì œí’ˆ: ${r.prd_nm||r.prd_no})`);return}const d=r.pdn_pln_no;t[d]||(t[d]=[]),t[d].push({pdn_pln_dtl_no:r.pdn_pln_dtl_no,prd_no:r.prd_no,instruction_qty:r.instruction_qty,ord_sts:"s1",crt_by:this.empStore.loginInfo.emp_no,rmk:r.rmk})}try{for(const[d,o]of Object.entries(t)){const i={pdn_pln_no:d,details:o};await h.post("/api/prodinst",{...i,crt_by:this.empStore.loginInfo.emp_no},{headers:{"Content-Type":"application/json"}})}const r=n.map(d=>`<li>${d.prd_nm} : ${d.instruction_qty}ê°œ</li>`).join("");await b.fire({title:"ğŸ‰ ì§€ì‹œ ë“±ë¡ ì™„ë£Œ!",html:`<ul style="text-align:left; padding-left:1.2rem; margin:0;">${r}</ul>`,icon:"success",confirmButtonText:"í™•ì¸"}),this.showInstructionModal=!1,this.instructionStore.reset(),this.getProdPlanList()}catch(r){console.error("ì§€ì‹œ ë“±ë¡ ì‹¤íŒ¨",((l=r.response)==null?void 0:l.data)||r.message),await b.fire("âŒ ì‹¤íŒ¨","ì§€ì‹œ ë“±ë¡ ì¤‘ ì˜¤ë¥˜ ë°œìƒ","error")}},formatNumber(n){return n==null||isNaN(n)?"-":new Intl.NumberFormat().format(n)},onFormattedQtyInput(n,t){const l=n.target.value.replace(/[^\d]/g,""),r=Number(l);t.qty=Math.max(0,r)},getTodayDate(){const n=new Date,t=n.getFullYear(),l=String(n.getMonth()+1).padStart(2,"0"),r=String(n.getDate()).padStart(2,"0");return`${t}-${l}-${r}`}}},nt={class:"container mt-4"},st={class:"d-flex justify-content-between align-items-center mb-4"},ot={class:"d-flex gap-2"},lt={class:"mb-ï¼‘ d-flex justify-content"},rt={class:"table table-bordered text-center",style:{"min-width":"1200px"}},dt={class:"input-group"},it=["onUpdate:modelValue"],ut=["value","onInput"],at=["onUpdate:modelValue"],ct=["onUpdate:modelValue"],pt=["onUpdate:modelValue"],mt=["onClick"],_t=["onClick"],yt={class:"progress",style:{height:"22px"}};function ht(n,t,l,r,d,o){const i=x("ProductSelectModal"),y=x("InstructionModal");return a(),c("div",nt,[e("div",st,[t[8]||(t[8]=e("h2",{class:"mb-4"},"ìƒì‚° ê³„íš ê´€ë¦¬",-1)),e("div",ot,[e("div",lt,[m(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>d.statusFilter=s),class:"form-select w-auto"},t[7]||(t[7]=[e("option",{value:"ì „ì²´"},"ì „ì²´",-1),e("option",{value:"ë¯¸ì§€ì‹œ/ë¶€ë¶„ì§€ì‹œ"},"ë¯¸ì§€ì‹œ/ë¶€ë¶„ì§€ì‹œ",-1),e("option",{value:"ì§€ì‹œì™„ë£Œ"},"ì§€ì‹œì™„ë£Œ",-1),e("option",{value:"ìƒì‚°ì™„ë£Œ"},"ìƒì‚°ì™„ë£Œ",-1)]),512),[[C,d.statusFilter]])]),e("button",{class:"btn btn-warning text-white",onClick:t[1]||(t[1]=(...s)=>o.resetAll&&o.resetAll(...s))},"ì´ˆê¸°í™”"),e("button",{class:"btn btn-success text-white",onClick:t[2]||(t[2]=(...s)=>o.openProductModal&&o.openProductModal(...s))},"ì œí’ˆë“±ë¡"),e("button",{class:"btn btn-success text-white",onClick:t[3]||(t[3]=(...s)=>o.addPlan&&o.addPlan(...s))},"ê³„íšë“±ë¡"),e("button",{class:"btn btn-primary",onClick:t[4]||(t[4]=(...s)=>o.openInstructionModal&&o.openInstructionModal(...s))},"ê³„íšì§€ì‹œ")])]),e("table",rt,[t[14]||(t[14]=e("colgroup",null,[e("col",{style:{width:"80px"}}),e("col",{style:{width:"160px"}}),e("col",{style:{width:"100px"}}),e("col",{style:{width:"100px"}}),e("col",{style:{width:"140px"}}),e("col",{style:{width:"140px"}}),e("col",{style:{width:"100px"}}),e("col",{style:{width:"120px"}}),e("col",{style:{width:"120px"}}),e("col",{style:{width:"60px"}})],-1)),t[15]||(t[15]=e("thead",{class:"table-light"},[e("tr",null,[e("th",null,"ê³„íšë²ˆí˜¸"),e("th",null,"ì œí’ˆëª…"),e("th",null,"ê³„íšìˆ˜ëŸ‰"),e("th",null,"ëˆ„ì ì§€ì‹œëŸ‰"),e("th",null,"ê³„íšì‹œì‘ì¼ì"),e("th",null,"ê³„íšë§ˆê°ì¼ì"),e("th",null,"ì§„í–‰ë¥ "),e("th",null,"ìƒíƒœ"),e("th",null,"ë¹„ê³ "),e("th",null,"ì‚­ì œ")])],-1)),e("tbody",null,[(a(!0),c(f,null,g(d.planRows,(s,P)=>(a(),c("tr",{key:"new-"+P},[t[9]||(t[9]=e("td",null,"ì‹ ê·œ",-1)),e("td",null,[e("div",dt,[m(e("input",{"onUpdate:modelValue":p=>s.prd_nm=p,class:"form-control",placeholder:"ì œí’ˆ ì„ íƒ",readonly:""},null,8,it),[[_,s.prd_nm]])])]),e("td",null,[e("input",{type:"text",class:"form-control text-end",value:o.formatNumber(s.qty),onInput:p=>o.onFormattedQtyInput(p,s),placeholder:"ìˆ˜ëŸ‰",min:0},null,40,ut)]),t[10]||(t[10]=e("td",null,null,-1)),e("td",null,[m(e("input",{"onUpdate:modelValue":p=>s.st_dt=p,type:"date",class:"form-control"},null,8,at),[[_,s.st_dt]])]),e("td",null,[m(e("input",{"onUpdate:modelValue":p=>s.end_dt=p,type:"date",class:"form-control"},null,8,ct),[[_,s.end_dt]])]),t[11]||(t[11]=e("td",null,null,-1)),t[12]||(t[12]=e("td",null,null,-1)),e("td",null,[m(e("input",{"onUpdate:modelValue":p=>s.rmk=p,class:"form-control",placeholder:"ë¹„ê³  ì…ë ¥"},null,8,pt),[[_,s.rmk]])]),e("td",null,[d.planRows.length>0?(a(),c("button",{key:0,class:"btn btn-outline-danger btn-sm me-1",onClick:p=>o.removePlanRow(P)}," - ",8,mt)):S("",!0)])]))),128)),(a(!0),c(f,null,g(o.sortedProdPlanList,s=>(a(),c("tr",{key:s.pdn_pln_no,onClick:P=>!o.isFullyInstructed(s)&&o.togglePlanSelection(s),class:q([o.isSelected(s)?"table-primary":"",o.isFullyInstructed(s)?"text-muted":""]),style:I(o.isFullyInstructed(s)?"pointer-events: none; opacity: 0.6;":"cursor: pointer;")},[e("td",null,u(s.pdn_pln_no),1),e("td",null,u(s.prd_nm),1),e("td",null,u(o.formatNumber(s.qty)),1),e("td",null,u(o.formatNumber(s.ord_qty)),1),e("td",null,u(o.dateFormat(s.st_dt,"yyyy-MM-dd")),1),e("td",null,u(o.dateFormat(s.end_dt,"yyyy-MM-dd")),1),e("td",null,u(o.getProgress(s.qty,s.ord_qty))+"%",1),e("td",null,[e("div",yt,[e("div",{class:q(["progress-bar",o.getProgressBarClass(s.qty,s.ord_qty,s.sts)]),style:I({width:o.getProgress(s.qty,s.ord_qty)+"%"}),role:"progressbar"},u(o.getStatus(s.qty,s.ord_qty,s.sts)),7)])]),e("td",null,u(s.rmk),1),t[13]||(t[13]=e("td",null,null,-1))],14,_t))),128))])]),d.showProductModal?(a(),k(i,{key:0,prodList:d.prodList,selected:d.planRows,onSelectProduct:o.handleSelectedProducts,onClose:t[5]||(t[5]=s=>d.showProductModal=!1)},null,8,["prodList","selected","onSelectProduct"])):S("",!0),d.showInstructionModal?(a(),k(y,{key:1,onSubmit:o.submitInstructions,onClose:t[6]||(t[6]=s=>d.showInstructionModal=!1)},null,8,["onSubmit"])):S("",!0)])}const Pt=v(et,[["render",ht],["__scopeId","data-v-c072d742"]]);export{Pt as default};
//# sourceMappingURL=productionPlan-B1QBOxIF.js.map
>>>>>>>> ea6bb99274547af08d1a7bb06d0e67c21cc213ef:server/public/assets/productionPlan-B1QBOxIF.js
=======
import{_ as v,c,a as e,w as m,v as _,F as f,r as g,g as w,o as a,f as q,t as u,h as N,i as k,j as S,k as C,l as x,e as h,u as R,n as I}from"./index-DRp0-N0C.js";import{u as F}from"./useDates-UMs5Kxim.js";import{S as b}from"./sweetalert2.esm.all-DV3w3JmD.js";const L={props:{prodList:Array,selected:Array},data(){return{search:"",selectedProd:[]}},computed:{filteredProducts(){return this.prodList.filter(n=>{var t;return(t=n.prd_nm)==null?void 0:t.includes(this.search)})}},created(){this.selectedProd=[...this.selected]},methods:{toggleProdSelection(n){const t=this.selectedProd.findIndex(l=>l.prd_no===n.prd_no);t>=0?this.selectedProd.splice(t,1):this.selectedProd.push(n)},isSelected(n){return this.selectedProd.some(t=>t.prd_no===n.prd_no)}}},V={class:"modal-dialog modal-lg"},U={class:"modal-content"},$={class:"modal-header"},j={class:"modal-body"},D={class:"d-flex justify-content-between align-items-center mb-3"},B={class:"table table-sm table-bordered text-center",style:{"min-width":"600px"}},T=["onClick"];function A(n,t,l,r,d,o){return a(),c("div",{class:"modal fade show d-block",style:{background:"rgba(0,0,0,0.5)","z-index":"1051"},onClick:t[3]||(t[3]=w(i=>n.$emit("close"),["self"]))},[e("div",V,[e("div",U,[e("div",$,[t[4]||(t[4]=e("h5",{class:"modal-title mb-0 fw-bold"},"ì œí’ˆ ì„ íƒ",-1)),e("button",{type:"button",class:"btn-close",onClick:t[0]||(t[0]=i=>n.$emit("close"))})]),e("div",j,[e("div",D,[m(e("input",{type:"text",class:"form-control w-25",placeholder:"ì œí’ˆëª… ê²€ìƒ‰","onUpdate:modelValue":t[1]||(t[1]=i=>d.search=i)},null,512),[[_,d.search]]),e("button",{class:"btn btn-outline-secondary text-dark",onClick:t[2]||(t[2]=i=>n.$emit("select-product",d.selectedProd))}," ì œí’ˆ ë“±ë¡ ")]),e("table",B,[t[5]||(t[5]=e("thead",{class:"table-light"},[e("tr",null,[e("th",null,"ì œí’ˆë²ˆí˜¸"),e("th",null,"ì œí’ˆëª…"),e("th",null,"í˜„ì¬ê³ ëŸ‰"),e("th",null,"ìƒì‚°í•„ìš”ìˆ˜ëŸ‰")])],-1)),e("tbody",null,[(a(!0),c(f,null,g(o.filteredProducts,i=>(a(),c("tr",{key:i.prd_no,onClick:y=>o.toggleProdSelection(i),class:q({"table-primary":o.isSelected(i)}),style:{cursor:"pointer"}},[e("td",null,u(i.prd_no),1),e("td",null,u(i.prd_nm),1),e("td",null,u(i.í˜„ì¬ê³ ëŸ‰),1),e("td",null,u(i.ìƒì‚°í•„ìš”ìˆ˜ëŸ‰),1)],10,T))),128))])])])])])])}const z=v(L,[["render",A],["__scopeId","data-v-bb02b97a"]]),M=N("instruction",{state:()=>({selectedPlans:[],instructionRows:[]}),actions:{setSelectedPlans(n){this.selectedPlans=n},generateInstructionRows(){console.log("selectedPlans for instruction:",this.selectedPlans),this.instructionRows=this.selectedPlans.filter(n=>Number(n.qty)>0).map(n=>{const t={pdn_pln_no:n.pdn_pln_no,pdn_pln_dtl_no:n.pdn_pln_dtl_no,prd_no:n.prd_no,prd_nm:n.prd_nm,qty:n.qty,instruction_qty:n.instruction_qty||n.qty-n.ord_qty||0,ord_qty:n.ord_qty||0,rmk:n.rmk||""};return console.log("instructionRow ìƒì„±:",t),t})},reset(){this.selectedPlans=[],this.instructionRows=[]}}}),E={name:"InstructionModal",emits:["submit","close"],computed:{instructionStore(){return M()},rows(){return this.instructionStore.instructionRows}},methods:{handleInput(n){const t=this.instructionStore.instructionRows[n];t.instruction_qty>t.qty?t.instruction_qty=t.qty:(t.instruction_qty<0||isNaN(t.instruction_qty))&&(t.instruction_qty=0)},submit(){const n=this.instructionStore.instructionRows;console.log("ğŸ”¥ ì§€ì‹œ ë“±ë¡ emit ì‹¤í–‰ë¨!"),console.log("ì „ì†¡í•  rows:",n),this.$emit("submit")},formatNumber(n){return n==null||isNaN(n)?"-":new Intl.NumberFormat().format(n)}}},Q={class:"modal-dialog modal-lg"},O={class:"modal-content"},Y={class:"modal-header"},G={class:"modal-body"},H={class:"table table-sm table-bordered text-center"},J={style:{width:"100px"}},K=["onUpdate:modelValue","max","onInput"],W=["onUpdate:modelValue"],X={class:"modal-footer"};function Z(n,t,l,r,d,o){return a(),c("div",{class:"modal fade show d-block",style:{background:"rgba(0,0,0,0.5)","z-index":"1051"},onClick:t[3]||(t[3]=w(i=>n.$emit("close"),["self"]))},[e("div",Q,[e("div",O,[e("div",Y,[t[4]||(t[4]=e("h5",{class:"modal-title mb-0 fw-bold"},"ê³„íš ì§€ì‹œ",-1)),e("button",{type:"button",class:"btn-close",onClick:t[0]||(t[0]=i=>n.$emit("close"))})]),e("div",G,[t[7]||(t[7]=e("h6",{class:"fw-bold mb-2"},"ì§€ì‹œ ìƒì„¸ ì…ë ¥",-1)),e("table",H,[t[6]||(t[6]=e("thead",{class:"table-light"},[e("tr",null,[e("th",null,"ì œí’ˆëª…"),e("th",null,"ê³„íšìˆ˜ëŸ‰"),e("th",null,"ëˆ„ì ì§€ì‹œìˆ˜ëŸ‰"),e("th",null,"ë¯¸ì§€ì‹œìˆ˜ëŸ‰"),e("th",null,"ì§€ì‹œìˆ˜ëŸ‰"),e("th",null,"ì™„ë£Œìˆ˜ëŸ‰"),e("th",null,"ë¹„ê³ ")])],-1)),e("tbody",null,[(a(!0),c(f,null,g(o.instructionStore.instructionRows,(i,y)=>(a(),c("tr",{key:i.pdn_pln_dtl_no},[e("td",null,u(i.prd_nm),1),e("td",null,u(o.formatNumber(i.qty)),1),e("td",null,u(o.formatNumber(i.ord_qty)),1),e("td",null,u(o.formatNumber(i.qty-i.ord_qty-i.instruction_qty||0)),1),e("td",J,[m(e("input",{type:"number",class:"form-control","onUpdate:modelValue":s=>i.instruction_qty=s,min:"0",max:i.qty-i.ord_qty,onInput:s=>o.handleInput(y)},null,40,K),[[_,i.instruction_qty,void 0,{number:!0}]])]),t[5]||(t[5]=e("td",null,null,-1)),e("td",null,[m(e("input",{class:"form-control","onUpdate:modelValue":s=>i.rmk=s},null,8,W),[[_,i.rmk]])])]))),128))])])]),e("div",X,[e("button",{class:"btn btn-primary",onClick:t[1]||(t[1]=(...i)=>o.submit&&o.submit(...i))},"ì§€ì‹œ ë“±ë¡"),e("button",{class:"btn btn-outline-secondary text-dark",onClick:t[2]||(t[2]=i=>n.$emit("close"))},"ì·¨ì†Œ")])])])])}const tt=v(E,[["render",Z],["__scopeId","data-v-0241b949"]]),et={name:"ProductionPlan",components:{ProductSelectModal:z,InstructionModal:tt},data(){return{prodPlanList:[],planRows:[],showProductModal:!1,showInstructionModal:!1,prodList:[],empStore:R(),statusFilter:"ë¯¸ì§€ì‹œ/ë¶€ë¶„ì§€ì‹œ",today:this.getTodayDate()}},computed:{instructionStore(){return M()},employeeName(){return this.empStore.loginInfo.nm||""},employeeNo(){return this.empStore.loginInfo.emp_no||""},sortedProdPlanList(){return[...this.prodPlanList.filter(t=>{const l=this.getProgress(t.qty,t.ord_qty,t.sts),r=t.sts;return this.statusFilter==="ì „ì²´"?!0:this.statusFilter==="ë¯¸ì§€ì‹œ/ë¶€ë¶„ì§€ì‹œ"?l<100:this.statusFilter==="ì§€ì‹œì™„ë£Œ"?l>=100&&r!=="s3":this.statusFilter==="ìƒì‚°ì™„ë£Œ"?l>=100&&r==="s3":!0})].sort((t,l)=>{const r=Number(t.ord_qty||0)>=Number(t.qty||0),d=Number(l.ord_qty||0)>=Number(l.qty||0);return r-d})}},mounted(){this.getProdPlanList()},methods:{async getProdPlanList(){try{const n=await h.get("/api/prodpln");this.prodPlanList=n.data}catch(n){console.error("ê³„íš ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨",n)}},dateFormat(n,t){return F.dateFormat(n,t)},isFullyInstructed(n){return Number(n.ord_qty||0)>=Number(n.qty||0)},isSelected(n){return this.instructionStore.selectedPlans.some(t=>t.pdn_pln_dtl_no===n.pdn_pln_dtl_no)},getProgress(n,t){const l=Number(n||0),r=Number(t||0);return l===0?0:Math.round(r/l*100)},getStatus(n,t,l){const r=this.getProgress(n,t);return r===0?"ê³„íšì™„ë£Œ":r<100?"ë¶€ë¶„ì§€ì‹œ":r>=100?l==="s3"?"ìƒì‚°ì™„ë£Œ":"ì§€ì‹œì™„ë£Œ":"ì˜¤ë¥˜"},getProgressBarClass(n,t,l){const r=this.getProgress(n,t);return r===0?"bg-secondary":r<100?"bg-warning text-dark":l==="s3"?"bg-primary":"bg-success"},removePlanRow(n){this.planRows.splice(n,1)},resetAll(){confirm("ì •ë§ ì´ˆê¸°í™” í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì…ë ¥ê°’ì´ ëª¨ë‘ ì‚¬ë¼ì§‘ë‹ˆë‹¤.")&&(this.planRows=[{prd_no:"",prd_nm:"",qty:"",st_dt:"",end_dt:"",rmk:"",sts:"ê³„íšì™„ë£Œ"}],this.instructionStore.selectedPlans=[],this.instructionStore.generateInstructionRows(),this.showInstructionModal=!1)},async addPlan(){try{const n=[];for(let l of this.planRows){if(!l.prd_no||l.qty<=0||!l.st_dt||!l.end_dt){alert("ëª¨ë“  í•­ëª©ì„ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•˜ì„¸ìš”.");return}await h.post("/api/prodpln",{...l,crt_by:this.empStore.loginInfo.emp_no},{headers:{"Content-Type":"application/json"}}),n.push(l)}const t=n.map(l=>`<li>${l.prd_nm} (${l.qty}ê°œ)</li>`).join("");await b.fire({title:"âœ… ê³„íš ë“±ë¡ ì™„ë£Œ!",html:`<ul style="text-align:left; padding-left:1.2rem; margin:0;">${t}</ul>`,icon:"success",confirmButtonText:"í™•ì¸"}),this.planRows=[{prd_no:"",prd_nm:"",qty:"",st_dt:"",end_dt:"",rmk:"",sts:"s1"}],this.getProdPlanList()}catch(n){console.error("ë“±ë¡ ì‹¤íŒ¨",n),await b.fire("âŒ ì‹¤íŒ¨","ê³„íš ë“±ë¡ ì‹¤íŒ¨","error")}},openProductModal(){h.get("/api/prodpln/prdList").then(n=>{this.prodList=n.data,this.showProductModal=!0}).catch(n=>{console.error("ì œí’ˆ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨",n)})},handleSelectedProducts(n){let t=[...this.planRows];const l=new Set(t.map(d=>d.prd_no));let r=0;for(let d=0;d<t.length&&r<n.length;d++){const o=t[d],i=n[r];!o.prd_no&&!l.has(i.prd_no)&&(o.prd_no=i.prd_no,o.prd_nm=i.prd_nm,l.add(i.prd_no),r++)}for(const d of n)l.has(d.prd_no)||(t.push({prd_no:d.prd_no,prd_nm:d.prd_nm,qty:"",st_dt:"",end_dt:"",rmk:"",crt_by:this.empStore.loginInfo.emp_no,status:"ê³„íšì™„ë£Œ"}),l.add(d.prd_no));this.planRows=t.filter(d=>d.prd_no&&n.some(o=>o.prd_no===d.prd_no)),this.showProductModal=!1},togglePlanSelection(n){const t=this.instructionStore.selectedPlans.findIndex(l=>l.pdn_pln_no===n.pdn_pln_no);t>=0?this.instructionStore.selectedPlans.splice(t,1):this.instructionStore.selectedPlans.push(n)},openInstructionModal(){if(this.instructionStore.selectedPlans.length===0){alert("ì§€ì‹œí•  ê³„íšì„ ì„ íƒí•´ì£¼ì„¸ìš”.");return}this.instructionStore.selectedPlans=this.instructionStore.selectedPlans.map(n=>({...n,prd_no:n.prd_no||n.prd.prd_no||"",pdn_pln_dtl_no:n.pdn_pln_dtl_no||""})),this.instructionStore.generateInstructionRows(),this.showInstructionModal=!0},async submitInstructions(){var l;const n=this.instructionStore.instructionRows,t={};for(const r of n){if(r.instruction_qty<=0||r.instruction_qty>r.qty){alert(`ì§€ì‹œìˆ˜ëŸ‰ ì˜¤ë¥˜ (ì œí’ˆ: ${r.prd_nm||r.prd_no})`);return}const d=r.pdn_pln_no;t[d]||(t[d]=[]),t[d].push({pdn_pln_dtl_no:r.pdn_pln_dtl_no,prd_no:r.prd_no,instruction_qty:r.instruction_qty,ord_sts:"s1",crt_by:this.empStore.loginInfo.emp_no,rmk:r.rmk})}try{for(const[d,o]of Object.entries(t)){const i={pdn_pln_no:d,details:o};await h.post("/api/prodinst",{...i,crt_by:this.empStore.loginInfo.emp_no},{headers:{"Content-Type":"application/json"}})}const r=n.map(d=>`<li>${d.prd_nm} : ${d.instruction_qty}ê°œ</li>`).join("");await b.fire({title:"ğŸ‰ ì§€ì‹œ ë“±ë¡ ì™„ë£Œ!",html:`<ul style="text-align:left; padding-left:1.2rem; margin:0;">${r}</ul>`,icon:"success",confirmButtonText:"í™•ì¸"}),this.showInstructionModal=!1,this.instructionStore.reset(),this.getProdPlanList()}catch(r){console.error("ì§€ì‹œ ë“±ë¡ ì‹¤íŒ¨",((l=r.response)==null?void 0:l.data)||r.message),await b.fire("âŒ ì‹¤íŒ¨","ì§€ì‹œ ë“±ë¡ ì¤‘ ì˜¤ë¥˜ ë°œìƒ","error")}},formatNumber(n){return n==null||isNaN(n)?"-":new Intl.NumberFormat().format(n)},onFormattedQtyInput(n,t){const l=n.target.value.replace(/[^\d]/g,""),r=Number(l);t.qty=Math.max(0,r)},getTodayDate(){const n=new Date,t=n.getFullYear(),l=String(n.getMonth()+1).padStart(2,"0"),r=String(n.getDate()).padStart(2,"0");return`${t}-${l}-${r}`}}},nt={class:"container mt-4"},st={class:"d-flex justify-content-between align-items-center mb-4"},ot={class:"d-flex gap-2"},lt={class:"mb-ï¼‘ d-flex justify-content"},rt={class:"table table-bordered text-center",style:{"min-width":"1200px"}},dt={class:"input-group"},it=["onUpdate:modelValue"],ut=["value","onInput"],at=["onUpdate:modelValue"],ct=["onUpdate:modelValue"],pt=["onUpdate:modelValue"],mt=["onClick"],_t=["onClick"],yt={class:"progress",style:{height:"22px"}};function ht(n,t,l,r,d,o){const i=x("ProductSelectModal"),y=x("InstructionModal");return a(),c("div",nt,[e("div",st,[t[8]||(t[8]=e("h2",{class:"mb-4"},"ìƒì‚° ê³„íš ê´€ë¦¬",-1)),e("div",ot,[e("div",lt,[m(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>d.statusFilter=s),class:"form-select w-auto"},t[7]||(t[7]=[e("option",{value:"ì „ì²´"},"ì „ì²´",-1),e("option",{value:"ë¯¸ì§€ì‹œ/ë¶€ë¶„ì§€ì‹œ"},"ë¯¸ì§€ì‹œ/ë¶€ë¶„ì§€ì‹œ",-1),e("option",{value:"ì§€ì‹œì™„ë£Œ"},"ì§€ì‹œì™„ë£Œ",-1),e("option",{value:"ìƒì‚°ì™„ë£Œ"},"ìƒì‚°ì™„ë£Œ",-1)]),512),[[C,d.statusFilter]])]),e("button",{class:"btn btn-warning text-white",onClick:t[1]||(t[1]=(...s)=>o.resetAll&&o.resetAll(...s))},"ì´ˆê¸°í™”"),e("button",{class:"btn btn-success text-white",onClick:t[2]||(t[2]=(...s)=>o.openProductModal&&o.openProductModal(...s))},"ì œí’ˆë“±ë¡"),e("button",{class:"btn btn-success text-white",onClick:t[3]||(t[3]=(...s)=>o.addPlan&&o.addPlan(...s))},"ê³„íšë“±ë¡"),e("button",{class:"btn btn-primary",onClick:t[4]||(t[4]=(...s)=>o.openInstructionModal&&o.openInstructionModal(...s))},"ê³„íšì§€ì‹œ")])]),e("table",rt,[t[14]||(t[14]=e("colgroup",null,[e("col",{style:{width:"80px"}}),e("col",{style:{width:"160px"}}),e("col",{style:{width:"100px"}}),e("col",{style:{width:"100px"}}),e("col",{style:{width:"140px"}}),e("col",{style:{width:"140px"}}),e("col",{style:{width:"100px"}}),e("col",{style:{width:"120px"}}),e("col",{style:{width:"120px"}}),e("col",{style:{width:"60px"}})],-1)),t[15]||(t[15]=e("thead",{class:"table-light"},[e("tr",null,[e("th",null,"ê³„íšë²ˆí˜¸"),e("th",null,"ì œí’ˆëª…"),e("th",null,"ê³„íšìˆ˜ëŸ‰"),e("th",null,"ëˆ„ì ì§€ì‹œëŸ‰"),e("th",null,"ê³„íšì‹œì‘ì¼ì"),e("th",null,"ê³„íšë§ˆê°ì¼ì"),e("th",null,"ì§„í–‰ë¥ "),e("th",null,"ìƒíƒœ"),e("th",null,"ë¹„ê³ "),e("th",null,"ì‚­ì œ")])],-1)),e("tbody",null,[(a(!0),c(f,null,g(d.planRows,(s,P)=>(a(),c("tr",{key:"new-"+P},[t[9]||(t[9]=e("td",null,"ì‹ ê·œ",-1)),e("td",null,[e("div",dt,[m(e("input",{"onUpdate:modelValue":p=>s.prd_nm=p,class:"form-control",placeholder:"ì œí’ˆ ì„ íƒ",readonly:""},null,8,it),[[_,s.prd_nm]])])]),e("td",null,[e("input",{type:"text",class:"form-control text-end",value:o.formatNumber(s.qty),onInput:p=>o.onFormattedQtyInput(p,s),placeholder:"ìˆ˜ëŸ‰",min:0},null,40,ut)]),t[10]||(t[10]=e("td",null,null,-1)),e("td",null,[m(e("input",{"onUpdate:modelValue":p=>s.st_dt=p,type:"date",class:"form-control"},null,8,at),[[_,s.st_dt]])]),e("td",null,[m(e("input",{"onUpdate:modelValue":p=>s.end_dt=p,type:"date",class:"form-control"},null,8,ct),[[_,s.end_dt]])]),t[11]||(t[11]=e("td",null,null,-1)),t[12]||(t[12]=e("td",null,null,-1)),e("td",null,[m(e("input",{"onUpdate:modelValue":p=>s.rmk=p,class:"form-control",placeholder:"ë¹„ê³  ì…ë ¥"},null,8,pt),[[_,s.rmk]])]),e("td",null,[d.planRows.length>0?(a(),c("button",{key:0,class:"btn btn-outline-danger btn-sm me-1",onClick:p=>o.removePlanRow(P)}," - ",8,mt)):S("",!0)])]))),128)),(a(!0),c(f,null,g(o.sortedProdPlanList,s=>(a(),c("tr",{key:s.pdn_pln_no,onClick:P=>!o.isFullyInstructed(s)&&o.togglePlanSelection(s),class:q([o.isSelected(s)?"table-primary":"",o.isFullyInstructed(s)?"text-muted":""]),style:I(o.isFullyInstructed(s)?"pointer-events: none; opacity: 0.6;":"cursor: pointer;")},[e("td",null,u(s.pdn_pln_no),1),e("td",null,u(s.prd_nm),1),e("td",null,u(o.formatNumber(s.qty)),1),e("td",null,u(o.formatNumber(s.ord_qty)),1),e("td",null,u(o.dateFormat(s.st_dt,"yyyy-MM-dd")),1),e("td",null,u(o.dateFormat(s.end_dt,"yyyy-MM-dd")),1),e("td",null,u(o.getProgress(s.qty,s.ord_qty))+"%",1),e("td",null,[e("div",yt,[e("div",{class:q(["progress-bar",o.getProgressBarClass(s.qty,s.ord_qty,s.sts)]),style:I({width:o.getProgress(s.qty,s.ord_qty)+"%"}),role:"progressbar"},u(o.getStatus(s.qty,s.ord_qty,s.sts)),7)])]),e("td",null,u(s.rmk),1),t[13]||(t[13]=e("td",null,null,-1))],14,_t))),128))])]),d.showProductModal?(a(),k(i,{key:0,prodList:d.prodList,selected:d.planRows,onSelectProduct:o.handleSelectedProducts,onClose:t[5]||(t[5]=s=>d.showProductModal=!1)},null,8,["prodList","selected","onSelectProduct"])):S("",!0),d.showInstructionModal?(a(),k(y,{key:1,onSubmit:o.submitInstructions,onClose:t[6]||(t[6]=s=>d.showInstructionModal=!1)},null,8,["onSubmit"])):S("",!0)])}const Pt=v(et,[["render",ht],["__scopeId","data-v-c072d742"]]);export{Pt as default};
//# sourceMappingURL=productionPlan-B1QBOxIF.js.map
>>>>>>> 6a9aee91f1b003d56d62a2dc3d9a1abb2695e08b
