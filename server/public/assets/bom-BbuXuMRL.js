import{d as S}from"./useCommonCode-DKmraWxZ.js";import{_ as v,c as b,a as t,w as r,v as u,F as g,r as k,g as R,o as i,f as B,t as f,e as _,i as M,j as y,k as x,l as w}from"./index-BjdZvEQ0.js";import{p as C}from"./prdSelectModal-BikHd3_U.js";const V={props:{matList:Array,selected:Array},data(){return{search:"",selectedMat:[]}},computed:{filteredMats(){return this.matList?this.matList.filter(o=>{var e;return(e=o.mat_nm)==null?void 0:e.includes(this.search)}):[]}},created(){this.selectedMat=[...this.selected]},methods:{toggleMatSelection(o){const e=this.selectedMat.findIndex(m=>m.mat_no===o.mat_no);e>=0?this.selectedMat.splice(e,1):this.selectedMat.push(o)},isSelected(o){return this.selectedMat.some(e=>e.mat_no===o.mat_no)}}},U={class:"modal-dialog modal-lg"},L={class:"modal-content"},F={class:"modal-header"},N={class:"modal-body"},O={class:"d-flex justify-content-between align-items-center mb-2"},$={class:"table-container"},P={class:"table table-sm table-bordered text-center"},j=["onClick"],T={class:"w-10"},A={class:"w-30"};function q(o,e,m,s,l,a){return i(),b("div",{class:"modal fade show d-block",style:{background:"rgba(0,0,0,0.5)","z-index":"1051"},onClick:e[3]||(e[3]=R(c=>o.$emit("close"),["self"]))},[t("div",U,[t("div",L,[t("div",F,[e[4]||(e[4]=t("h5",{class:"modal-title"},"자재 선택",-1)),t("button",{type:"button",class:"btn-close",onClick:e[0]||(e[0]=c=>o.$emit("close"))})]),t("div",N,[t("div",O,[r(t("input",{type:"text",class:"form-control w-25",placeholder:"자재명 검색","onUpdate:modelValue":e[1]||(e[1]=c=>l.search=c)},null,512),[[u,l.search]]),t("button",{class:"btn btn-sm btn-primary",onClick:e[2]||(e[2]=c=>o.$emit("select-mat",l.selectedMat))},"자재 등록")]),t("div",$,[t("table",P,[e[5]||(e[5]=t("thead",{class:"table-light"},[t("tr",null,[t("th",{class:"w-10"},"자재번호"),t("th",{class:"w-30"},"자재명")])],-1)),t("tbody",null,[(i(!0),b(g,null,k(a.filteredMats,c=>(i(),b("tr",{key:c.mat_no,onClick:d=>a.toggleMatSelection(c),class:B({"table-primary":a.isSelected(c)}),style:{cursor:"pointer"}},[t("td",T,f(c.mat_no),1),t("td",A,f(c.mat_nm),1)],10,j))),128))])])])])])])])}const I=v(V,[["render",q],["__scopeId","data-v-81a0a408"]]),G={props:{bom:Object},components:{matSelectModal:I},data(){return{bom_no:"",prd_no:"",prd_nm:"",use_yn:"",bomMatInfo:[],showMatModal:!1,matList:[]}},watch:{bom:{handler(o){o?this.getBomMatInfo(o.bom_no):(this.bomMatInfo=[],this.bom_no="",this.prd_no="",this.prd_nm="",this.use_yn="")},immediate:!0}},methods:{async getBomMatInfo(o){let e=await _.get(`/api/bomMat/${o}`).catch(m=>console.log(m));this.bomMatInfo=e.data,this.bom_no=e.data[0].bom_no,this.prd_no=e.data[0].prd_no,this.prd_nm=e.data[0].prd_nm,this.use_yn=e.data[0].use_yn},async bomUpdate(){if(this.bomMatInfo.length===0){alert("자재를 추가해주세요.");return}for(const s of this.bomMatInfo)if(!s.cap||s.cap<=0){alert(`${s.mat_nm}의 용량을 입력해주세요.`);return}if(!this.use_yn){alert("사용여부를 선택해주세요.");return}let o={use_yn:this.use_yn},e=[];for(let s=0;s<this.bomMatInfo.length;s++)e[s]={bom_no:this.bom_no,mat_no:this.bomMatInfo[s].mat_no,cap:this.bomMatInfo[s].cap,unit:this.bomMatInfo[s].unit,rmk:this.bomMatInfo[s].rmk};(await _.put(`/api/bomAndBomMat/${this.bom_no}`,[o,e]).catch(s=>console.log(s))).data.message=="수정 완료"?(alert("수정되었습니다."),this.$emit("bom-reload"),this.getBomMatInfo(this.bomMatInfo[0].bom_no)):alert(`수정되지 않았습니다.
데이터를 확인해보세요.`)},saveBom(){confirm(`정말로 수정하시겠습니까?
변경된 내용은 즉시 적용됩니다.`)&&this.bomUpdate()},addBom(){this.$emit("goToForm",!1)},async deleteBom(o){o>0?confirm(`정말로 삭제하시겠습니까?
삭제된 데이터는 복구할 수 없습니다.`)&&((await _.delete(`/api/bom/${o}`).catch(l=>console.log(l))).data.affectedRows>0?(alert("정상적으로 삭제되었습니다."),this.$emit("bom-reload"),this.bomMatInfo=[],this.bom_no="",this.prd_no="",this.prd_nm="",this.use_yn="",this.$emit("clear-selection")):alert("삭제되지 않았습니다.")):alert("삭제할 BOM을 선택하세요")},resetForm(){this.getBomMatInfo(this.bomMatInfo[0].bom_no)},removeMatRow(o){this.bomMatInfo.splice(o,1)},openMatModal(){_.get("/api/mat").then(o=>{this.matList=o.data,this.showMatModal=!0}).catch(o=>{console.error("자재 목록 불러오기 실패",o)})},handleSelectedMats(o){let e=[...this.bomMatInfo];const m=new Set(e.map(s=>s.mat_no));e=this.appendSelectedMats(e,o,m),this.bomMatInfo=this.filterOnlySelectedRows(e,o),this.showMatModal=!1},appendSelectedMats(o,e,m){for(const s of e)m.has(s.mat_no)||(o.push({mat_no:s.mat_no,mat_nm:s.mat_nm,cap:"",unit:s.unit,rmk:""}),m.add(s.mat_no));return o},filterOnlySelectedRows(o,e){return o.filter(m=>m.mat_no&&e.some(s=>s.mat_no===m.mat_no))}}},Q={class:"col-md-7"},X={class:"d-flex justify-content-between mb-3"},Y={class:"card p-3"},z={key:0},D={class:"row mb-4"},E={class:"col-md-6 mb-3"},H={class:"d-flex align-items-center"},J={class:"col-md-6 mb-3"},K={class:"d-flex align-items-center"},W={class:"col-md-12 mb-3"},Z={class:"d-flex align-items-center"},tt={class:"d-flex align-items-center"},et={class:"table table-bordered text-center"},ot=["onUpdate:modelValue"],st=["onUpdate:modelValue"],lt=["onUpdate:modelValue"],nt=["onUpdate:modelValue"],at=["onUpdate:modelValue"],dt=["onClick"],mt={key:1},it={key:1};function rt(o,e,m,s,l,a){const c=w("matSelectModal");return i(),b("div",Q,[t("div",X,[t("div",null,[t("button",{class:"btn btn-primary me-2",onClick:e[0]||(e[0]=(...d)=>a.addBom&&a.addBom(...d))},"등록"),t("button",{class:"btn btn-danger",onClick:e[1]||(e[1]=d=>a.deleteBom(l.bomMatInfo[0].bom_no))},"삭제")]),t("div",null,[t("button",{class:"btn btn-warning me-2",onClick:e[2]||(e[2]=(...d)=>a.resetForm&&a.resetForm(...d))},"초기화"),t("button",{class:"btn btn-success",onClick:e[3]||(e[3]=(...d)=>a.saveBom&&a.saveBom(...d))},"저장")])]),t("div",Y,[e[16]||(e[16]=t("h4",null,"상세 보기",-1)),m.bom?(i(),b("div",z,[t("div",null,[t("div",D,[t("div",E,[t("div",H,[e[9]||(e[9]=t("label",{for:"bomNo",class:"form-label me-3",style:{"min-width":"100px"}},"BOM번호",-1)),r(t("input",{id:"bomNo",type:"text",class:"form-control","onUpdate:modelValue":e[4]||(e[4]=d=>l.bom_no=d),readonly:"",disabled:""},null,512),[[u,l.bom_no]])])]),t("div",J,[t("div",K,[e[11]||(e[11]=t("label",{for:"useYn",class:"form-label me-3",style:{"min-width":"100px"}},"사용여부",-1)),r(t("select",{id:"useYn",class:"form-select form-control","onUpdate:modelValue":e[5]||(e[5]=d=>l.use_yn=d)},e[10]||(e[10]=[t("option",{value:"f1"},"여",-1),t("option",{value:"f2"},"부",-1)]),512),[[x,l.use_yn]])])]),t("div",W,[t("div",Z,[e[12]||(e[12]=t("label",{for:"prdNm",class:"form-label me-3",style:{"min-width":"100px"}},"제품명",-1)),r(t("input",{id:"prdNm",type:"text",class:"form-control","onUpdate:modelValue":e[6]||(e[6]=d=>l.prd_nm=d),readonly:"",disabled:""},null,512),[[u,l.prd_nm]])])]),t("div",tt,[t("button",{class:"btn btn-outline-secondary align-items-center",style:{width:"100%"},onClick:e[7]||(e[7]=(...d)=>a.openMatModal&&a.openMatModal(...d))},"자재추가")])]),t("table",et,[e[14]||(e[14]=t("thead",{class:"table-light"},[t("tr",null,[t("th",{style:{"font-weight":"normal"}},"자재번호"),t("th",{style:{"font-weight":"normal"}},"자재명"),t("th",{style:{"font-weight":"normal"}},"용량"),t("th",{style:{"font-weight":"normal"}},"단위"),t("th",{style:{"font-weight":"normal"}},"비고"),t("th",{style:{"font-weight":"normal"}},"X")])],-1)),t("tbody",null,[l.bomMatInfo.length>0?(i(!0),b(g,{key:0},k(l.bomMatInfo,(d,n)=>(i(),b("tr",{key:"new-"+n},[t("td",null,[r(t("input",{"onUpdate:modelValue":p=>d.mat_no=p,type:"text",class:"form-control text-center",readonly:"",disabled:""},null,8,ot),[[u,d.mat_no]])]),t("td",null,[r(t("input",{"onUpdate:modelValue":p=>d.mat_nm=p,type:"text",class:"form-control",readonly:"",disabled:""},null,8,st),[[u,d.mat_nm]])]),t("td",null,[r(t("input",{"onUpdate:modelValue":p=>d.cap=p,type:"number",class:"form-control text-end"},null,8,lt),[[u,d.cap,void 0,{number:!0}]])]),t("td",null,[r(t("input",{"onUpdate:modelValue":p=>d.unit=p,type:"text",class:"form-control",readonly:"",disabled:""},null,8,nt),[[u,d.unit]])]),t("td",null,[r(t("input",{"onUpdate:modelValue":p=>d.rmk=p,type:"text",class:"form-control"},null,8,at),[[u,d.rmk]])]),t("td",null,[t("button",{class:"btn btn-outline-danger me-1",onClick:p=>a.removeMatRow(n)}," X ",8,dt)])]))),128)):(i(),b("tr",mt,e[13]||(e[13]=[t("td",{colspan:"6"},"자재추가 버튼을 눌러 자재를 추가해주세요.",-1)])))])]),l.showMatModal?(i(),M(c,{key:0,matList:l.matList,selected:l.bomMatInfo,onSelectMat:a.handleSelectedMats,onClose:e[8]||(e[8]=d=>l.showMatModal=!1)},null,8,["matList","selected","onSelectMat"])):y("",!0)])])):(i(),b("div",it,e[15]||(e[15]=[t("p",null,"BOM을 선택하세요!",-1)])))])])}const ct=v(G,[["render",rt],["__scopeId","data-v-25171c78"]]),ut={components:{matSelectModal:I,prdSelectModal:C},data(){return{bom_No:"",prd_no:"",prd_nm:"",bomRows:[{mat_no:"",mat_nm:"",cap:"",unit:"",rmk:""}],showMatModal:!1,showPrdModal:!1,matList:[],prdList:[]}},created(){this.getBomNo()},methods:{async getBomNo(){let o=await _.get("/api/bomNo").catch(e=>console.log(e));this.bom_No=o.data[0].addBomNo},resetForm(){this.bomRows=[{mat_no:"",mat_nm:"",cap:"",unit:"",rmk:""}],this.prd_no="",this.prd_nm=""},async bomInsert(){if(!this.prd_no){alert("제품을 선택해주세요.");return}if(!this.bomRows||this.bomRows.length===0||this.bomRows[0].mat_no===""){alert("자재를 추가해주세요.");return}for(let s=0;s<this.bomRows.length;s++){const l=this.bomRows[s];if(!l.cap||l.cap<=0){alert(`${l.mat_nm}의 용량을 입력해주세요.`);return}}this.bomRows=this.bomRows.map(s=>{var l;return{...s,rmk:((l=s.rmk)==null?void 0:l.trim())||""}});let o={prd_no:this.prd_no},e=[];for(let s=0;s<this.bomRows.length;s++)e[s]={bom_no:this.bom_No,mat_no:this.bomRows[s].mat_no,cap:this.bomRows[s].cap,unit:this.bomRows[s].unit,rmk:this.bomRows[s].rmk};(await _.post("/api/bomAndBomMat",[o,e]).catch(s=>console.log(s))).data.message=="등록 완료"?(alert("등록되었습니다."),this.$emit("bom-reload")):alert(`등록되지 않았습니다.
데이터를 확인해보세요.`),this.$emit("goToInfo",!0)},removeMatRow(o){this.bomRows.splice(o,1)},openMatModal(){_.get("/api/mat").then(o=>{this.matList=o.data,this.showMatModal=!0}).catch(o=>{console.error("자재 목록 불러오기 실패",o)})},handleSelectedMats(o){let e=[...this.bomRows];const m=new Set(e.map(s=>s.mat_no));e=this.appendSelectedMats(e,o,m),this.bomRows=this.filterOnlySelectedRows(e,o),this.showMatModal=!1},appendSelectedMats(o,e,m){for(const s of e)m.has(s.mat_no)||(o.push({mat_no:s.mat_no,mat_nm:s.mat_nm,cap:"",unit:s.unit,rmk:""}),m.add(s.mat_no));return o},filterOnlySelectedRows(o,e){return o.filter(m=>m.mat_no&&e.some(s=>s.mat_no===m.mat_no))},openPrdModal(){_.get("/api/prd").then(o=>{this.prdList=o.data,this.showPrdModal=!0}).catch(o=>{console.error("제품 목록 불러오기 실패",o)})},handleSelectedPrd(o){this.prd_no=o.prd_no,this.prd_nm=o.prd_nm,this.showPrdModal=!1}}},bt={class:"col-md-7"},pt={class:"d-flex justify-content-between mb-3"},ht={class:"card p-3"},_t={class:"row mb-4"},ft={class:"col-md-6 mb-3"},Mt={class:"d-flex align-items-center"},yt={class:"col-md-12 mb-3"},wt={class:"d-flex align-items-center"},vt={class:"input-group"},gt={class:"d-flex align-items-center"},kt={class:"table table-bordered text-center"},Bt={key:0},xt=["onUpdate:modelValue"],It=["onUpdate:modelValue"],St=["onUpdate:modelValue"],Rt=["onUpdate:modelValue"],Ct=["onUpdate:modelValue"],Vt=["onClick"];function Ut(o,e,m,s,l,a){const c=w("matSelectModal"),d=w("prdSelectModal");return i(),b("div",bt,[t("div",pt,[e[8]||(e[8]=t("div",null,null,-1)),t("div",null,[t("button",{class:"btn btn-warning me-2",onClick:e[0]||(e[0]=(...n)=>a.resetForm&&a.resetForm(...n))},"초기화"),t("button",{class:"btn btn-success",onClick:e[1]||(e[1]=(...n)=>a.bomInsert&&a.bomInsert(...n))},"저장")])]),t("div",ht,[e[14]||(e[14]=t("h4",null,"BOM 등록",-1)),t("div",null,[t("div",null,[t("div",_t,[t("div",ft,[t("div",Mt,[e[9]||(e[9]=t("label",{for:"bomNo",class:"form-label me-3",style:{"min-width":"100px"}},"BOM번호",-1)),r(t("input",{id:"bomNo",type:"text",class:"form-control","onUpdate:modelValue":e[2]||(e[2]=n=>l.bom_No=n),readonly:"",disabled:""},null,512),[[u,l.bom_No]])])]),e[11]||(e[11]=t("div",{class:"col-md-6 mb-3"},[t("div",{class:"d-flex align-items-center"},[t("label",{for:"useYn",class:"form-label me-3",style:{"min-width":"100px"}},"사용여부"),t("input",{id:"useYn",type:"text",class:"form-control",value:"여",readonly:"",disabled:""})])],-1)),t("div",yt,[t("div",wt,[e[10]||(e[10]=t("label",{for:"prdNm",class:"form-label me-3",style:{"min-width":"100px"}},"제품명",-1)),t("div",vt,[r(t("input",{id:"prdNm",type:"text",class:"form-control","onUpdate:modelValue":e[3]||(e[3]=n=>l.prd_nm=n),placeholder:"제품을 선택해주세요.",readonly:""},null,512),[[u,l.prd_nm]]),t("button",{class:"btn btn-outline-secondary",onClick:e[4]||(e[4]=(...n)=>a.openPrdModal&&a.openPrdModal(...n))},"제품검색")])])]),t("div",gt,[t("button",{class:"btn btn-outline-secondary align-items-center",style:{width:"100%"},onClick:e[5]||(e[5]=(...n)=>a.openMatModal&&a.openMatModal(...n))},"자재추가")])]),t("table",kt,[e[13]||(e[13]=t("thead",{class:"table-light"},[t("tr",null,[t("th",{style:{"font-weight":"normal"}},"자재번호"),t("th",{style:{"font-weight":"normal"}},"자재명"),t("th",{style:{"font-weight":"normal"}},"용량"),t("th",{style:{"font-weight":"normal"}},"단위"),t("th",{style:{"font-weight":"normal"}},"비고"),t("th",{style:{"font-weight":"normal"}},"X")])],-1)),t("tbody",null,[l.bomRows[0].mat_no===""?(i(),b("tr",Bt,e[12]||(e[12]=[t("td",{colspan:"6"},"자재추가 버튼을 눌러 자재를 추가해주세요.",-1)]))):(i(!0),b(g,{key:1},k(l.bomRows,(n,p)=>(i(),b("tr",{key:"new-"+p},[t("td",null,[r(t("input",{"onUpdate:modelValue":h=>n.mat_no=h,type:"text",class:"form-control text-center",readonly:"",disabled:""},null,8,xt),[[u,n.mat_no]])]),t("td",null,[r(t("input",{"onUpdate:modelValue":h=>n.mat_nm=h,type:"text",class:"form-control",readonly:"",disabled:""},null,8,It),[[u,n.mat_nm]])]),t("td",null,[r(t("input",{"onUpdate:modelValue":h=>n.cap=h,type:"number",class:"form-control text-end"},null,8,St),[[u,n.cap,void 0,{number:!0}]])]),t("td",null,[r(t("input",{"onUpdate:modelValue":h=>n.unit=h,type:"text",class:"form-control",readonly:"",disabled:""},null,8,Rt),[[u,n.unit]])]),t("td",null,[r(t("input",{"onUpdate:modelValue":h=>n.rmk=h,type:"text",class:"form-control"},null,8,Ct),[[u,n.rmk]])]),t("td",null,[t("button",{class:"btn btn-outline-danger me-1",onClick:h=>a.removeMatRow(p)}," X ",8,Vt)])]))),128))])]),l.showMatModal?(i(),M(c,{key:0,matList:l.matList,selected:l.bomRows,onSelectMat:a.handleSelectedMats,onClose:e[6]||(e[6]=n=>l.showMatModal=!1)},null,8,["matList","selected","onSelectMat"])):y("",!0),l.showPrdModal?(i(),M(d,{key:1,prdList:l.prdList,selected:l.prd_no,onSelectPrd:a.handleSelectedPrd,onClose:e[7]||(e[7]=n=>l.showPrdModal=!1)},null,8,["prdList","selected","onSelectPrd"])):y("",!0)])])])])}const Lt=v(ut,[["render",Ut],["__scopeId","data-v-887538c9"]]),Ft={components:{bomInfo:ct,bomForm:Lt},data(){return{searchQuery:"",selectedFilter:"",selectedBom:null,bomList:[],InfoView:!0}},computed:{filteredBomList(){return this.bomList.filter(o=>o.prd_nm.toLowerCase().includes(this.searchQuery.toLowerCase())&&(this.selectedFilter===""||o.use_yn===this.selectedFilter))}},created(){this.getBomList()},methods:{CommonCodeFormat(o){return S.CommonCodeFormat(o)},async getBomList(){let o=await _.get("/api/bom").catch(e=>console.log(e));this.bomList=o.data},async selectBom(o){try{const e=this.bomList.find(m=>m.bom_no===o);this.InfoView=!0,await this.$nextTick(),this.selectedBom=e}catch(e){console.error("BOM 선택 중 오류 발생:",e)}},msg(o){this.InfoView=o,o||(this.selectedBom=null)},clearSelection(){this.selectedBom=null}}},Nt={class:"container mt-4"},Ot={class:"row"},$t={class:"col-md-5"},Pt={class:"d-flex justify-content-between mb-3"},jt={class:"card p-3"},Tt={class:"table-container"},At={class:"table table-bordered"},qt=["onClick"],Gt={class:"w-10"},Qt={class:"w-30"},Xt={class:"w-10"};function Yt(o,e,m,s,l,a){const c=w("bomInfo"),d=w("bomForm");return i(),b("div",Nt,[t("div",Ot,[e[5]||(e[5]=t("h1",null,"BOM관리",-1)),t("div",$t,[t("div",Pt,[r(t("input",{type:"text",class:"form-control w-50",placeholder:"제품명 검색...","onUpdate:modelValue":e[0]||(e[0]=n=>l.searchQuery=n)},null,512),[[u,l.searchQuery]]),r(t("select",{class:"form-select w-25","onUpdate:modelValue":e[1]||(e[1]=n=>l.selectedFilter=n)},e[2]||(e[2]=[t("option",{value:""},"전체",-1),t("option",{value:"f1"},"여",-1),t("option",{value:"f2"},"부",-1)]),512),[[x,l.selectedFilter]])]),t("div",jt,[e[4]||(e[4]=t("h4",null,"BOM 목록",-1)),t("div",Tt,[t("table",At,[e[3]||(e[3]=t("thead",null,[t("tr",null,[t("th",{class:"w-10"},"BOM번호"),t("th",{class:"w-30"},"제품명 "),t("th",{class:"w-10"},"사용여부")])],-1)),t("tbody",null,[(i(!0),b(g,null,k(a.filteredBomList,n=>(i(),b("tr",{key:n.bom_no,onClick:p=>a.selectBom(n.bom_no),class:B([{"table-primary":l.selectedBom&&l.selectedBom.bom_no===n.bom_no},"table-hover"])},[t("td",Gt,f(n.bom_no),1),t("td",Qt,f(n.prd_nm),1),t("td",Xt,f(a.CommonCodeFormat(n.use_yn)),1)],10,qt))),128))])])])])]),l.InfoView?(i(),M(c,{key:0,bom:l.selectedBom,onGoToForm:a.msg,onBomReload:a.getBomList,onClearSelection:a.clearSelection},null,8,["bom","onGoToForm","onBomReload","onClearSelection"])):y("",!0),l.InfoView?y("",!0):(i(),M(d,{key:1,onGoToInfo:a.msg,onBomReload:a.getBomList},null,8,["onGoToInfo","onBomReload"]))])])}const Ht=v(Ft,[["render",Yt],["__scopeId","data-v-651914fe"]]);export{Ht as default};
//# sourceMappingURL=bom-BbuXuMRL.js.map
