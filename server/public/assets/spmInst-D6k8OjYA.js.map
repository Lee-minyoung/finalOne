{"version":3,"file":"spmInst-D6k8OjYA.js","sources":["../../../client/src/views/sales/spmInst.vue"],"sourcesContent":["<template>\n  \n  <div class=\"col-md-10 p-4\">\n    <h4 class=\"mb-4\">출하지시</h4>\n    <!-- 출하지시 입력 폼 -->\n    <div class=\"row mb-3 g-3\">\n      <div class=\"col-md-3\">\n        <label class=\"form-label\">출하일자</label>\n        <input v-model=\"spmDate\" type=\"date\" class=\"form-control\">\n      </div>\n      <div class=\"col-md-3\">\n        <label class=\"form-label\">담당자</label>\n        <input type=\"text\" class=\"form-control\">\n      </div>\n\n    \n       <div  class=\"col-md-3\">\n        <label class=\"form-label\">거래처</label>\n        <input v-model=\"selectCpyNm.cpy_nm\" type=\"text\" class=\"form-control\" readonly >\n      </div>\n\n      <!-- <div v-else class=\"col-md-3\">\n            <label class=\"form-label\">거래처</label>\n            <input  v-model=\"checkOrd[0].cpy_nm\" type=\"text\" class=\"form-control\">\n</div> -->\n      <!--거래처변경  -->\n      <div v-if=\"selectVdr.vdr_no > 0\" class=\"col-md-3\">\n        <label class=\"form-label\">거래처코드</label>\n        <input v-model=\"selectVdr.vdr_no\" type=\"number\" class=\"form-control\" readonly>\n      </div>\n      <div v-else class=\"col-md-3\">\n        <label class=\"form-label\">거래처코드</label>\n        <input v-model=\"selectVdr\" type=\"number\" class=\"form-control\" readonly>\n      </div>\n      <div class=\"col-md-3\">\n        <label class=\"form-label\">수주번호</label>\n        <input v-model=\"ordNo\" type=\"number\" class=\"form-control\">\n      </div>\n      <div class=\"col-md-3\">\n        <label class=\"form-label\">배송지</label>\n        <input v-model=\"deliver\" type=\"text\" class=\"form-control\">\n      </div>\n      <div class=\"col-md-3\">\n        <label class=\"form-label\">비고</label>\n        <input v-model=\"memo\" type=\"text\" class=\"form-control\">\n      </div>\n    </div>\n  \n    <table class=\"table table-bordered text-center mt-4\">\n      <thead class=\"table-light\">\n        <tr>\n          <th><input type=\"checkbox\" /></th>\n          <th>주문ID</th>\n          <th>거래처ID</th>\n          <th>거래처명</th>\n          <th>제품ID</th>\n          <th>제품명</th>\n          <th>요청수량</th>\n          <th>lot재고량</th>\n          <th>납기일자</th>\n          <th>상태</th>\n        </tr>\n      </thead>\n      <tbody>\n        <tr v-for=\"item in ords\" :key=\"item.ord_no\">\n          <td><input type=\"checkbox\" :value=\"item\" v-model=\"checkOrd\" @change=\"handleCheckChange\" /></td>\n          <td>{{ item.ord_no }}</td>\n          <td>{{ item.vdr_no }}</td>\n          <td>{{ item.cpy_nm }}</td>\n          <td>{{ item.prd_no }}</td>\n          <td>{{ item.prd_nm }}</td>\n          <td>{{ item['요청수량'] }}</td>\n          <td v-if=\"item['lot수량']<=0\" >0</td>\n           <td v-else-if=\"item['lot수량']>0\" >{{ item['lot수량'] }}</td>\n          <td>{{ item['납기예정'] }}</td>\n          <td v-if=\"item['요청수량'] < item['lot수량']\">\n           <span class=\"badge text-bg-primary\">출하가능</span>\n          </td>\n          <td v-else>\n           <span class=\"badge text-bg-danger\">출하불가</span>\n          </td>\n        </tr>\n\n      </tbody>\n    </table>\n\n    <!-- 출하지시 버튼 -->\n    <div class=\"d-flex justify-content-end mt-3\">\n      <button class=\"btn btn-primary\" @click=\"saveSpm\">출하지시</button>\n    </div>\n  </div>\n</template>\n\n<script>\nimport axios from 'axios';\nimport vdrSelectModal from '@/views/modal/vdrSelectModal.vue';\n\n\nexport default {\n  name: 'SpmInst',\n  components: {\n    vdrSelectModal\n  },\n  data() {\n    return {\n      mode: 'basic',\n      spmDate: '', //출하일자\n      ordNo: 0,    //수주번호\n      vdr: [], //거래처목록\n      selectVdr: {},  //선택한 거래처  \n      selectCpyNm: {},                 \n      showVdrModal: false, // \n      deliver: '',\n      qty: 0,  //수량\n      unitPrc: 0, //단가\n      prdNo: '', //제품번호 \n      ords: [],\n      checkOrd: [], //체크한 수주번호 건에 대해서   \n      lotQty:0,\n      memo: '', //비고 \n\n    };\n  },\n  async created() {\n    const vdrs = await axios.get('/api/vdrList');\n    const ords = await axios.get('/api/ord');\n    this.ords = ords.data;\n    console.log(this.ords);\n    this.vdr = vdrs.data;\n  },\n  computed: {\n  selectedOrder() {\n    return this.checkOrd.length > 0 ? this.checkOrd[0] : null;\n  }\n},\n\n\n  methods: {\n    //모달에서 vdr 다루기 \n    handleVdrSelect(selectedVdr) {\n      this.selectVdr = selectedVdr;\n      this.showVdrModal = false;\n    },\n\n    //발주메소드 가져온건데 출하지시도 비슷하게하기 \n    async saveSpm() {\n      const payload = {\n        //vdr_no: this.selectVdr?.vdr_no??1000, 수주번호알면 알아서 받음 \n        //       // 거래처번호 하나?? 일단보류..\n        ord_no: this.ordNo,                     //수주번호  \n        dlv_addr: this.deliver,                 //배송지 \n        spm_dt: this.spmDate,\n        vdr_no: this.selectVdr //거래처번호        //출하일자                                             \n      };\n     // const lotInfo\n      const lotInfo={\n      lot_no: this.checkOrd[0].lot_no, //lot번호 \n      prd_no: this.checkOrd[0].prd_no,// 제품번호\n      lot_qty: this.lotQty,   //lot재고량 \n      memo:this.memo, //비고\n      }; \n      if(this.checkOrd[0]['요청수량']>this.checkOrd[0]['lot수량']){\n        alert('출하할수 없습니다'); \n        return; \n      }  \n\n      try {\n        await axios.post('/api/addSpm', payload);\n        console.log('초기화전', this.selectVdr);\n        this.selectVdr = null;\n        alert('수주 저장 완료!');\n        console.log('초기화후', this.selectVdr);\n\n       await axios.post('/api/updateLot', lotInfo);\n        //수주저장 완료시킨후 거래처변경값 다시초기화 시킴   \n      } catch (err) {\n        console.error('저장 실패:', err);\n        alert('에러발생');\n        console.log('payLoad', payload);\n      }\n    },\n    handleCheckChange() {\n      if (this.checkOrd.length === 1) {\n        const item = this.checkOrd[0];\n        this.mode = 'checked';\n        this.ordNo = item.ord_no;\n        this.selectVdr = item.vdr_no; // 거래처번호\n        this.selectCpyNm = item.cpy_nm; // 거래처명\n        this.lotQty=item['요청수량']; \n        this.deliver=item.ofc_addr; //배송지     \n      } else {\n        this.mode = 'basic';\n        alert('하나의 수주만 선택하세요');\n        return;\n      }\n    }\n\n\n  },\n};\n\n</script>"],"names":["_sfc_main","vdrSelectModal","vdrs","axios","ords","selectedVdr","payload","lotInfo","err","item","_hoisted_1","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","_hoisted_11","_hoisted_16","_openBlock","_createElementBlock","_cache","_createElementVNode","$event","$data","_vModelText","_hoisted_5","_hoisted_6","_Fragment","_renderList","$options","args","_toDisplayString","_hoisted_12","_hoisted_13","_createCommentVNode","_hoisted_14","_hoisted_15"],"mappings":"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"}