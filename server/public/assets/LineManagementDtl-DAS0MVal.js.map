{"version":3,"file":"LineManagementDtl-DAS0MVal.js","sources":["../../../client/src/views/production/line/LineManagementDtl.vue"],"sourcesContent":["<template>\n  <!-- ✅ 배경 클릭 시 닫힘 -->\n  <div class=\"modal fade show d-block\" style=\"background: rgba(0,0,0,0.5); z-index: 1051;\" @click.self=\"$emit('close')\">\n    <div class=\"modal-dialog modal-xl\">\n      <div class=\"modal-content\">\n\n        <!-- ✅ 모달 헤더 -->\n        <div class=\"modal-header\">\n          <h5 class=\"modal-title fw-bold mb-0\">{{ lineNo }} 라인 상세 정보</h5>\n          <button type=\"button\" class=\"btn-close\" @click=\"$emit('close')\"></button>\n        </div>\n\n        <!-- ✅ 모달 바디 -->\n        <div class=\"modal-body\">\n          <div class=\"container mt-4\">\n            <h2 class=\"mb-4\">{{ lineNo }} 라인 관리 상세</h2>\n            <table class=\"table table-bordered text-center align-middle\">\n              <thead class=\"table-light\">\n                <tr>\n                  <th>순서</th>\n                  <th>공정명</th>\n                  <th>설비명</th>\n                  <th>시작시간</th>\n                  <th>종료시간</th>\n                  <th>투입량</th>\n                  <th>불량량</th>\n                  <th>생산량</th>\n                  <th>상태</th>\n                </tr>\n              </thead>\n              <tbody>\n                <tr v-for=\"(row, index) in processDetailList\" :key=\"row.seq\">\n                  <td>{{ row.seq }}</td>\n                  <td>{{ row.proc_code_nm }}</td>\n                  <td>{{ row.proc_nm }}</td>\n                  <td>{{ dateFormat(row.st_tm, 'hh시 mm분') }}</td>\n                  <td>{{ dateFormat(row.end_tm, 'hh시 mm분') }}</td>\n                  <td>{{ formatNumber(row.ord_qty) }}</td>\n                  <td>\n                    <input\n                      v-if=\"row.eqp_sts === 'h5'\"\n                      type=\"number\"\n                      class=\"form-control form-control-sm text-end\"\n                      v-model.number=\"row.dft_qty\"\n                      @input=\"updatePdnQty(row)\"\n                      :max=\"row.ord_qty\"\n                      :min=\"0\"\n                      @keyup.enter=\"startLine(row, index)\"\n                    />\n                    <span v-else>{{ formatNumber(row.dft_qty) }}</span>\n                  </td>\n                  <td>{{ formatNumber(row.pdn_qty) }}</td>\n                  <td>\n                    <span v-if=\"row.eqp_sts === 'h1'\">정상</span>\n                    <span v-else-if=\"row.eqp_sts === 'h2'\">수리중</span>\n                    <span v-else-if=\"row.eqp_sts === 'h3'\">점검중</span>\n                    <span v-else-if=\"row.eqp_sts === 'h4'\">\n                      <button class=\"btn btn-sm btn-secondary\" disabled>작업대기</button>\n                    </span>\n                    <span v-else-if=\"row.eqp_sts === 'h5'\">\n                      <button\n                        class=\"btn btn-sm btn-primary\"\n                        @click=\"startLine(row, index)\"\n                        :disabled=\"row.dft_qty === null || row.dft_qty === undefined || row.dft_qty === ''\">\n                        공정진행\n                      </button>\n                    </span>\n                    <span v-else-if=\"row.eqp_sts === 'h6'\">\n                      <button class=\"btn btn-sm btn-danger\" @click=\"repair(row, index)\">작업완료</button>\n                    </span>\n                    <span v-else>미정</span>\n                  </td>\n                </tr>\n              </tbody>\n\n              <!-- ✅ 하단 요약 정보 -->\n              <tfoot class=\"table-light\">\n                <tr>\n                  <td>{{ lineNo }}</td>\n                  <td>{{ lineInfo.ln_nm }}</td>\n                  <td>{{ lineInfo.prd_nm }}</td>\n                  <td>{{ dateFormat(lineInfo.st_tm, 'hh시 mm분 ss초') }}</td>\n                  <td>{{ dateFormat(lineInfo.end_tm, 'hh시 mm분 ss초') }}</td>\n                  <td>{{ lineInfo.ord_qty }}</td>\n                  <td >{{ lineInfo.dft_qty }}</td>\n                  <td>{{ lineInfo.pdn_qty }}</td>\n                  <td>\n                    <button class=\"btn btn-sm btn-primary\" @click=\"handleConfirm\">확인</button>\n                  </td>\n                </tr>\n              </tfoot>\n            </table>\n          </div>\n        </div>\n\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport axios from 'axios'\nimport useDateUtils from '@/utils/useDates.js'\n\nexport default {\n  name: 'LineManagementDtl',\n  props: {\n    details: Array,\n    lineNo: String,\n    lineInfo: Object\n  },\n  emits: ['close', 'reload'],\n  data() {\n    return {\n      processDetailList: []\n    };\n  },\n  watch: {\n    details: {\n      immediate: true,\n      handler(newVal) {\n        this.processDetailList = Array.isArray(newVal)\n          ? newVal.map(row => {\n              const dft = typeof row.dft_qty === 'number' ? row.dft_qty : 0;\n              const ord = Number(row.ord_qty || 0);\n              return {\n                ...row,\n                dft_qty: dft,\n                pdn_qty: Math.max(ord - dft, 0)\n              };\n            })\n          : [];\n      }\n    }\n  },\n  methods: {\n    updatePdnQty(row) {\n      const dft = Number(row.dft_qty || 0);\n      const ord = Number(row.ord_qty || 0);\n      row.pdn_qty = Math.max(ord - dft, 0);\n    },\n    async startLine(item) {\n      if (item.dft_qty === null || item.dft_qty === undefined || item.dft_qty === '') {\n        alert(\"⚠️ 불량량을 입력해주세요.\");\n        return;\n      }\n\n      const payload = {\n        p_ln_opr_no: item.ln_opr_no,\n        p_ln_opr_dtl_no: item.ln_opr_dtl_no,\n        p_seq: item.seq,\n        p_dft_qty: item.dft_qty,\n        p_pdn_qty: item.pdn_qty\n      };\n\n      try {\n        await axios.post('/api/lineOperation', payload);\n        this.$emit('reload', {\n          line_no: this.lineNo,\n          pdn_ord_dtl_no: item.pdn_ord_dtl_no\n        });\n        alert('공정 완료!');\n      } catch (err) {\n        console.error(\"❌ 지시 실패:\", err);\n        alert('지시 중 오류가 발생했습니다.');\n      }\n    },\n    repair(item) {\n      alert(`공정 ${item.seq} 완료 처리함`);\n    },\n    dateFormat(value, format) {\n      return useDateUtils.dateFormat(value, format)\n    },\n    handleConfirm() {\n      this.$emit('close');\n      this.$emit('reload', {\n        line_no: this.lineNo,\n        forceUpdate: true\n      });\n    },\n              formatNumber(n) {\n      if (n == null || isNaN(n)) return '-'\n      return new Intl.NumberFormat().format(n)\n    },\n        handleInput(index) {\n      const row = this.instructionStore.instructionRows[index]\n      if (row.instruction_qty > row.qty) {\n        row.instruction_qty = row.qty\n      } else if (row.instruction_qty < 0 || isNaN(row.instruction_qty)) {\n        row.instruction_qty = 0\n      }\n    },\n  }\n}\n</script>\n\n<style scoped>\nth,\ntd {\n  vertical-align: middle;\n}\n</style>"],"names":["_sfc_main","newVal","row","dft","ord","item","payload","axios","err","value","format","useDateUtils","n","index","_hoisted_1","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_hoisted_6","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_16","_hoisted_18","_hoisted_20","_createElementBlock","_cache","_withModifiers","_ctx","_createElementVNode","_toDisplayString","$props","_openBlock","_Fragment","_renderList","$data","$options","$event","_withKeys","_hoisted_10","_hoisted_11","_hoisted_12","_hoisted_13","_hoisted_14","_hoisted_15","_hoisted_17","_hoisted_19","args"],"mappings":"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"}