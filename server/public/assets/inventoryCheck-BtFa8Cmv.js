import{_ as P,c as o,a as t,F as p,r as g,e as h,o as a,j as _,b,t as r,g as f}from"./index-DRp0-N0C.js";const k={name:"InventoryCheck",data(){return{inventoryStatus:[],allPurPlan:[],inventoryPurPlan:[],filteredPurPlan:[],min:"",rawData:[],expandedReqNos:[],proPlnData:[],reqClickedList:[],lotMinusDoneReqNo:[],plnToOrdNo:[]}},async created(){await this.fetchInventoryStatus(),await this.fetchInventoryPurPlan(),await this.filteredPurPlanList()},computed:{groupedInventory(){const l={};this.inventoryStatus.forEach(c=>{const u=c.계획ID;l[u]||(l[u]=[]),l[u].push(c)});const s={};for(const c in l){const u=l[c];s[c]=u}return s}},methods:{async fetchInventoryStatus(){try{const l=await h.get("/api/inventory/mtStatus");this.inventoryStatus=l.data,console.log("자재현황조회 성공",this.inventoryStatus)}catch(l){console.error("자재출고요청 실패",l)}},async fetchInventoryPurPlan(){try{const l=await h.get("/api/getPurPlnChecked");this.allPurPlan=l.data;const s=await h.get("/api/PlnToOrd");this.plnToOrdNo=s.data.map(c=>c.계획ID),console.log("allpurPlan",this.allPurPlan),console.log(this.plnToOrdNo),this.inventoryPurPlan=this.allPurPlan.filter(c=>!this.plnToOrdNo.includes(c.계획ID))}catch(l){console.log("자재구매계획 실패",l)}},async filteredPurPlanList(){const l=this.inventoryPurPlan;console.log("필터링전 rawdata",l);const s=[];for(const c of l){const u=c.자재ID;await this.getMinOrdqty(u)}this.filteredPurPlan=s},async addPurOrdByPlnNo(l){try{const s=await h.post("/api/inventory/purOrd",{params:{purPlnNo:l}});return console.log("발주버튼클릭"),console.log(l),console.log("add",s),await this.fetchInventoryPurPlan(),s}catch(s){console.log(s)}},toggleAccordion(l){const s=this.expandedReqNos.indexOf(l);s>=0?this.expandedReqNos.splice(s,1):this.expandedReqNos.push(l)},isExpanded(l){return this.expandedReqNos.includes(l)},async minCheckAndPurOrd(l,s,c){const d=(await this.getMinOrdqty(l)).min_ord_qty;console.log("최소수량",d),s>=d?(await this.addPurOrdByPlnNo(c),alert("발주가 완료 되었습니다")):alert("최소수량을 넘기지 못해 주문할수 없습니다")},async fetchPrdPlanByMatId(l){try{const s=await h.get("/api/inventory/prdPlan",{params:{matId:l}});this.proPlnData=s.data,console.log("생산계획조회",this.proPlnData)}catch(s){console.log("생산계획조회 실패",s)}},async checkMat(l){const s=this.groupedInventory[l];console.log("matList",s);const c=s.filter(d=>d.부족수량<=0);try{const d=c.map(i=>({mat_no:i.자재ID,req_qty:i.총필요량,pln_id:i.계획ID}));console.log("payload",d);const n=await h.get("/api/MatStatus",{params:{reqId:d.pln_id,matId:d.mat_no}});console.log("matsts",n),await h.post("/api/inventory/lotMinusList",d)}catch(d){d.response&&d.response.status===400?alert(d.response.data.message):alert("서버오류가 부족합니다")}if(console.log("availableMats",c),!s.every(d=>{const n=parseFloat(d.총필요량);return parseFloat(d.현재재고)>=n})){alert("일부 자재의 재고가 부족합니다.");return}console.log("matList",s)},goToReqPage(l){console.log("자재요청item",l),this.$router.push({name:"MatReq",query:{matId:l.자재ID,matNm:l.자재명}})},async addPurOrd(l){console.log("자재요청item",l);try{const s=await h.post("/api/inventory/purOrdByClickButton",{matId:l.자재ID,vdrNo:l.대표거래처번호,vdrNm:l.거래처명,prc:l.단가,qty:l.부족수량,check:"check",reqId:l.계획ID});console.log("자재요청성공",s),this.reqClickedList.push(l.계획ID+l.자재명),alert("자재요청이 완료 되었습니다");const c=await h.get("/api/PlnToOrd");this.plnToOrdNo=c.data.map(u=>u.계획ID),console.log("allpurPlan",this.allPurPlan),console.log(this.plnToOrdNo),this.inventoryPurPlan=this.allPurPlan.filter(u=>!this.plnToOrdNo.includes(u.계획ID))}catch(s){console.log("자재요청실패",s)}},formatNumber(l){return l==null||isNaN(l)?"-":new Intl.NumberFormat().format(l)}}},m={class:"table-responsive",style:{"max-width":"1150px"}},x={class:"table table-bordered text-center"},v=["onClick"],N={colspan:"6",class:"text-start"},w={class:"d-flex justify-content-between align-items-center w-100"},I=["onClick"],D={class:"align-middle"},O={key:0,class:"align-middle"},q={key:1,class:"align-middle"},C={key:2,class:"align-middle"},L={key:3,class:"align-middle"},A={key:4,class:"align-middle"},M={key:5,class:"align-middle"},E={key:6,class:"align-middle"},T={key:7,class:"align-middle"},S={key:8,class:"align-middle"},B={key:9,class:"align-middle"},R={key:10,class:"align-middle"},F={key:11,class:"align-middle"},Q={class:"align-middle"},V={key:0,class:"btn btn-primary rounded-pill px-2 py-1",disabled:""},j={key:1,class:"btn btn-info rounded-pill px-2 py-1",disabled:""},G=["onClick"],z={class:"table table-bordered text-center",style:{"max-width":"1150px"}},H={class:"align-middle"},J={class:"text-end pe-4"},K={class:"text-end pe-4"},U=["onClick"];function W(l,s,c,u,d,n){return a(),o(p,null,[s[6]||(s[6]=t("h3",null,"자재현황파악",-1)),t("div",m,[t("table",x,[s[3]||(s[3]=t("colgroup",null,[t("col",{style:{width:"200px"}}),t("col",{style:{width:"200px"}}),t("col",{style:{width:"200px"}}),t("col",{style:{width:"200px"}}),t("col",{style:{width:"100px"}})],-1)),t("tbody",null,[(a(!0),o(p,null,g(n.groupedInventory,(i,y)=>(a(),o(p,{key:y},[t("tr",{class:"table-primary",style:{cursor:"pointer"},onClick:e=>n.toggleAccordion(y)},[t("td",N,[t("span",w,[t("span",null,[t("b",null,r(n.isExpanded(y)?"▼":"▶"),1),s[0]||(s[0]=b(" 출고요청번호: ")),t("b",null,r(y),1),b(" (자재 "+r(i.length)+"건) | 지시번호 : ",1),t("b",null,r(i[0].생산지시번호),1),s[1]||(s[1]=b(" | 제품명 : ")),t("b",null,r(i[0].제품명),1)]),t("button",{class:"btn btn-success rounded-pill px-2 py-1 me-2",onClick:f(e=>n.checkMat(y),["stop"]),type:"button"}," 자재출고 ",8,I)])])],8,v),n.isExpanded(y)?(a(),o(p,{key:0},[s[2]||(s[2]=t("tr",{class:"table-light"},[t("th",null,"자재명"),t("th",null,"총필요량"),t("th",null,"현재고"),t("th",null,"부족수량"),t("th",null,"자재출고")],-1)),(a(!0),o(p,null,g(i,e=>(a(),o("tr",{key:e.mat_req_no},[t("td",D,r(e.자재명),1),e.단위=="g"?(a(),o("td",O,r(n.formatNumber(e.총필요량/1e3))+"kg",1)):e.단위=="EA"?(a(),o("td",q,r(n.formatNumber(e.총필요량))+"EA",1)):e.단위=="ml"?(a(),o("td",C,r(n.formatNumber(e.총필요량/1e3))+"L",1)):(a(),o("td",L,r(n.formatNumber(e.총필요량)),1)),e.단위=="g"?(a(),o("td",A,r(n.formatNumber(e.현재재고/1e3))+"kg",1)):e.단위=="EA"?(a(),o("td",M,r(n.formatNumber(e.현재재고))+"EA",1)):e.단위=="ml"?(a(),o("td",E,r(n.formatNumber(e.현재재고/1e3))+"L",1)):(a(),o("td",T,r(n.formatNumber(e.현재재고)),1)),e.단위=="g"?(a(),o("td",S,r(n.formatNumber(e.부족수량>0?e.부족수량/1e3:0))+"kg",1)):e.단위=="EA"?(a(),o("td",B,r(n.formatNumber(e.부족수량>0?e.부족수량:0))+"EA",1)):e.단위=="ml"?(a(),o("td",R,r(n.formatNumber(e.부족수량>0?e.부족수량/1e3:0))+"L",1)):(a(),o("td",F,r(n.formatNumber(e.부족수량>0?e.부족수량:0)),1)),t("td",Q,[e.부족수량<=0?(a(),o("button",V,"출고완료")):e.자재처리결과=="c3"||d.reqClickedList.includes(e.계획ID+e.자재명)?(a(),o("button",j,"요청완료")):e.부족수량>0&&e.자재처리결과!="c3"&&!d.reqClickedList.includes(e.계획ID+e.자재명)?(a(),o("button",{key:2,class:"btn btn-success rounded-pill px-2 py-1",onClick:X=>n.addPurOrd(e),type:"button"},"자재요청",8,G)):_("",!0)])]))),128))],64)):_("",!0)],64))),128))])])]),s[7]||(s[7]=t("h3",null,"자재구매계획 ",-1)),t("table",z,[s[4]||(s[4]=t("colgroup",null,[t("col",{style:{width:"100px"}}),t("col",{style:{width:"190px"}}),t("col",{style:{width:"150px"}}),t("col",{style:{width:"180px"}}),t("col",{style:{width:"200px"}}),t("col",{style:{width:"100px"}})],-1)),s[5]||(s[5]=t("thead",null,[t("tr",null,[t("th",{scope:"col"},"자재ID"),t("th",{scope:"col"},"자재명"),t("th",{scope:"col"},"수량"),t("th",{scope:"col"},"총가격"),t("th",{scope:"col"},"거래처"),t("th",{scope:"col"},"발주")])],-1)),t("tbody",H,[(a(!0),o(p,null,g(d.inventoryPurPlan,(i,y)=>(a(),o("tr",{key:y},[t("td",null,r(i.자재번호),1),t("td",null,r(i.자재명),1),t("td",J,r(n.formatNumber(i.총합)),1),t("td",K,r(n.formatNumber(i.총가격))+"원",1),t("td",null,r(i.거래처명),1),t("td",null,[t("button",{class:"btn btn-success rounded-pill px-2 py-1",onClick:e=>n.minCheckAndPurOrd(i.자재번호,i.총합,i.계획ID),type:"button"},"발주하기",8,U)])]))),128))])])],64)}const Z=P(k,[["render",W]]);export{Z as default};
//# sourceMappingURL=inventoryCheck-BtFa8Cmv.js.map
